import{j as e,A as N,m as o}from"./vendor-animation-0o8UKZ_1.js";import{r as x}from"./vendor-react-Drj8qL0h.js";import"./vendor-math-p018AHG0.js";import"./index-AFVnRdFv.js";import{L as z}from"./LessonLayout-DKGN2TA5.js";import{I as s,M as l}from"./MathBlock-uz1iP4cD.js";import{D as u,E as y,C as j}from"./Callout-4_WMx_B8.js";import"./vendor-firebase-core-BXWtuYvb.js";import"./quizMap-B3IzoTDS.js";function P({className:S=""}){var p,b,g,f,k,v;const[t,d]=x.useState("setup"),[r,c]=x.useState(0),[h,w]=x.useState(!1),a=x.useMemo(()=>({privateKey:"d",publicKey:"Q = dG",message:"m",messageHash:"z = H(m)",nonce:"k",R:"R = kG",r:"r = x(R) mod n",s:"s = kâ»Â¹(z + rd) mod n",signature:"(r, s)"}),[]),C=[{title:"Private Key",value:a.privateKey,desc:"Random 256-bit integer in [1, n-1]"},{title:"Public Key",value:a.publicKey,desc:"Scalar multiply private key by generator G"}],A=[{title:"Hash Message",value:a.messageHash,desc:"Compute SHA-256 hash of the message"},{title:"Generate Nonce",value:a.nonce,desc:"CRITICAL: Must be random and unique!",isWarning:!0},{title:"Compute R",value:a.R,desc:"Scalar multiply nonce by generator G"},{title:"Extract r",value:a.r,desc:"Take x-coordinate of R, reduce mod n"},{title:"Compute s",value:a.s,desc:"Combine hash, r, private key with nonce inverse"},{title:"Signature",value:a.signature,desc:"The pair (r, s) is the ECDSA signature"}],i=t==="setup"?C:t==="sign"?A:[{title:"Compute uâ‚",value:"uâ‚ = z Â· sâ»Â¹ mod n",desc:"Scale message hash by s inverse"},{title:"Compute uâ‚‚",value:"uâ‚‚ = r Â· sâ»Â¹ mod n",desc:"Scale r by s inverse"},{title:"Compute Point",value:"P = uâ‚G + uâ‚‚Q",desc:"Linear combination of G and public key"},{title:"Verify",value:"x(P) â‰Ÿ r",desc:"Check if x-coordinate equals r"}],_=()=>{r<i.length-1?c(r+1):t==="setup"?(d("sign"),c(0)):t==="sign"?(d("verify"),c(0)):d("complete")},R=()=>{d("setup"),c(0)};return e.jsxs("div",{className:`p-6 rounded-2xl bg-dark-800/50 border border-dark-700/50 ${S}`,children:[e.jsx("h3",{className:"text-xl font-bold text-dark-100 mb-2",children:"ECDSA Signing Flow"}),e.jsx("p",{className:"text-dark-400 text-sm mb-4",children:"Step through the signing and verification process interactively."}),e.jsx("div",{className:"flex gap-2 mb-6",children:["setup","sign","verify"].map((n,m)=>e.jsx("div",{className:`flex-1 p-3 rounded-lg text-center transition-colors ${t===n?n==="setup"?"bg-blue-500/20 border border-blue-500/30":n==="sign"?"bg-amber-500/20 border border-amber-500/30":"bg-emerald-500/20 border border-emerald-500/30":t==="complete"||t==="verify"&&m<2||t==="sign"&&m<1?"bg-dark-700/30 border border-dark-600/30 opacity-50":"bg-dark-700/30 border border-dark-600/30"}`,children:e.jsxs("p",{className:`text-sm font-medium ${t===n?n==="setup"?"text-blue-400":n==="sign"?"text-amber-400":"text-emerald-400":"text-dark-400"}`,children:[m+1,". ",n.charAt(0).toUpperCase()+n.slice(1)]})},n))}),e.jsx(N,{mode:"wait",children:t!=="complete"?e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-6",children:e.jsxs("div",{className:`p-6 rounded-xl ${(p=i[r])!=null&&p.isWarning?"bg-red-500/10 border border-red-500/30":"bg-dark-700/50 border border-dark-600/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:`text-lg font-semibold ${(b=i[r])!=null&&b.isWarning?"text-red-400":"text-dark-200"}`,children:(g=i[r])==null?void 0:g.title}),e.jsxs("span",{className:"text-dark-500 text-sm",children:["Step ",r+1,"/",i.length]})]}),e.jsx("div",{className:"p-4 rounded-lg bg-dark-800/50 mb-3",children:e.jsx("p",{className:"text-xl font-mono text-amber-400",children:(f=i[r])==null?void 0:f.value})}),e.jsx("p",{className:`text-sm ${(k=i[r])!=null&&k.isWarning?"text-red-300":"text-dark-400"}`,children:(v=i[r])==null?void 0:v.desc})]})},`${t}-${r}`):e.jsxs(o.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"mb-6 p-6 rounded-xl bg-emerald-500/10 border border-emerald-500/30 text-center",children:[e.jsx("p",{className:"text-4xl mb-2",children:"âœ“"}),e.jsx("h4",{className:"text-lg font-semibold text-emerald-400",children:"Signature Verified!"}),e.jsx("p",{className:"text-dark-400 text-sm mt-2",children:"The signature (r, s) is valid for message m under public key Q"})]})}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:R,className:"px-4 py-2 rounded-lg bg-dark-700 text-dark-300 hover:bg-dark-600 text-sm",children:"Reset"}),e.jsx("div",{className:"flex-1"}),t!=="complete"&&e.jsx("button",{onClick:_,className:"px-6 py-2 rounded-lg bg-amber-500/20 text-amber-400 border border-amber-500/30 hover:bg-amber-500/30 font-medium",children:r===i.length-1?t==="verify"?"Complete":"Next Phase":"Next Step"})]}),e.jsxs("div",{className:"border-t border-dark-700/50 pt-4",children:[e.jsxs("button",{onClick:()=>w(!h),className:"flex items-center gap-2 w-full text-left",children:[e.jsx("span",{className:"text-red-400",children:"âš "}),e.jsx("span",{className:"text-dark-300 text-sm font-medium",children:"The Nonce Catastrophe"}),e.jsx(o.span,{className:"text-dark-500 ml-auto",animate:{rotate:h?180:0},children:"â–¼"})]}),e.jsx(N,{children:h&&e.jsx(o.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"mt-4 p-4 rounded-xl bg-red-500/10 border border-red-500/30",children:[e.jsx("p",{className:"text-red-300 text-sm mb-3",children:e.jsx("strong",{children:"If you reuse a nonce k for two different messages:"})}),e.jsxs("div",{className:"space-y-2 font-mono text-sm",children:[e.jsxs("p",{className:"text-dark-300",children:["s",e.jsx("sub",{children:"1"})," = k",e.jsx("sup",{children:"-1"}),"(z",e.jsx("sub",{children:"1"})," + rd) mod n"]}),e.jsxs("p",{className:"text-dark-300",children:["s",e.jsx("sub",{children:"2"})," = k",e.jsx("sup",{children:"-1"}),"(z",e.jsx("sub",{children:"2"})," + rd) mod n"]}),e.jsx("div",{className:"my-3 border-t border-red-500/30"}),e.jsxs("p",{className:"text-red-400",children:["k = (z",e.jsx("sub",{children:"1"})," - z",e.jsx("sub",{children:"2"}),") / (s",e.jsx("sub",{children:"1"})," - s",e.jsx("sub",{children:"2"}),") mod n"]}),e.jsxs("p",{className:"text-red-400 font-bold",children:["d = (s",e.jsx("sub",{children:"1"}),"k - z",e.jsx("sub",{children:"1"}),") / r mod n"]})]}),e.jsxs("p",{className:"text-dark-400 text-xs mt-3",children:[e.jsx("strong",{children:"Private key leaked!"})," This happened to PlayStation 3 (2010), Android Bitcoin wallets (2013), and others."]})]})})})]}),e.jsxs("div",{className:"mt-4 p-4 rounded-xl bg-dark-700/30",children:[e.jsx("p",{className:"text-dark-500 text-xs mb-3",children:"ECDSA Overview"}),e.jsxs("div",{className:"flex items-center justify-between text-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 text-xl",children:"ðŸ”’"}),e.jsx("p",{className:"text-xs text-dark-400 mt-1",children:"Private Key d"})]}),e.jsx("div",{className:"text-dark-600",children:"â†’"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-amber-500/20 flex items-center justify-center text-amber-400 text-xl",children:"âœŽ"}),e.jsx("p",{className:"text-xs text-dark-400 mt-1",children:"Sign (r, s)"})]}),e.jsx("div",{className:"text-dark-600",children:"â†’"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-400 text-xl",children:"âœ“"}),e.jsx("p",{className:"text-xs text-dark-400 mt-1",children:"Verify with Q"})]})]})]})]})}function Q(){return e.jsxs(z,{sectionId:5,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"ECDSA Signatures"}),e.jsx("p",{className:"mb-4",children:"The Elliptic Curve Digital Signature Algorithm (ECDSA) is how Bitcoin proves ownership. A signature proves you know the private key without revealing itâ€”the fundamental mechanism for spending Bitcoin."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Signature Problem"}),e.jsxs("p",{className:"mb-4",children:["Alice wants to prove she owns the private key ",e.jsx(s,{children:"d"})," corresponding to public key ",e.jsx(s,{children:"Q"}),", without revealing ",e.jsx(s,{children:"d"}),". The signature must be:"]}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mb-6",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Authentic:"})," Only someone with ",e.jsx(s,{children:"d"})," can produce it"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unforgeable:"})," Cannot be created without ",e.jsx(s,{children:"d"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bound to message:"})," Cannot be transferred to different messages"]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"ECDSA Signing Algorithm"}),e.jsxs(u,{title:"ECDSA Signature Generation",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Input:"})," Message ",e.jsx(s,{children:"m"}),", private key ",e.jsx(s,{children:"d"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 mt-3 font-mono text-sm",children:[e.jsxs("p",{children:["1: ",e.jsx(s,{children:"z \\leftarrow H(m)"})," (hash the message)"]}),e.jsxs("p",{children:["2: ",e.jsxs(s,{children:["k \\leftarrow \\text","{random}"," \\in [1, n-1]"]})," (nonce)"]}),e.jsxs("p",{children:["3: ",e.jsx(s,{children:"R = kG"})," (ephemeral point)"]}),e.jsxs("p",{children:["4: ",e.jsx(s,{children:"r = x_R \\mod n"})," (x-coordinate of R)"]}),e.jsxs("p",{children:["5: ",e.jsxs(s,{children:["s = k^","{-1}","(z + rd) \\mod n"]})]}),e.jsxs("p",{children:["6: Return ",e.jsx(s,{children:"(r, s)"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"ECDSA Verification Algorithm"}),e.jsxs(u,{title:"ECDSA Signature Verification",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Input:"})," Message ",e.jsx(s,{children:"m"}),", signature ",e.jsx(s,{children:"(r, s)"}),", public key ",e.jsx(s,{children:"Q"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 mt-3 font-mono text-sm",children:[e.jsxs("p",{children:["1: ",e.jsx(s,{children:"z \\leftarrow H(m)"})]}),e.jsxs("p",{children:["2: ",e.jsxs(s,{children:["w = s^","{-1}"," \\mod n"]})]}),e.jsxs("p",{children:["3: ",e.jsx(s,{children:"u_1 = zw \\mod n"})]}),e.jsxs("p",{children:["4: ",e.jsx(s,{children:"u_2 = rw \\mod n"})]}),e.jsxs("p",{children:["5: ",e.jsx(s,{children:"P = u_1 G + u_2 Q"})]}),e.jsxs("p",{children:["6: Accept if ",e.jsx(s,{children:"x_P \\equiv r \\pmod n"})]})]})]}),e.jsx(P,{className:"my-8"}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why Verification Works"}),e.jsxs(y,{title:"Mathematical Justification",children:[e.jsx("p",{children:"Starting from the signature equation:"}),e.jsx(l,{children:"s = k^{-1}(z + rd) \\mod n"}),e.jsx("p",{className:"mt-2",children:"Rearranging:"}),e.jsx(l,{children:"k = s^{-1}(z + rd) = s^{-1}z + s^{-1}rd = wz + wrd = u_1 + u_2 d"}),e.jsx("p",{className:"mt-2",children:"Therefore:"}),e.jsx(l,{children:"R = kG = (u_1 + u_2 d)G = u_1 G + u_2 dG = u_1 G + u_2 Q = P"}),e.jsxs("p",{className:"mt-2",children:["So ",e.jsx(s,{children:"P = R"}),", and ",e.jsx(s,{children:"x_P = x_R = r"})," âœ“"]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"THE NONCE CATASTROPHE"}),e.jsxs(j,{type:"danger",title:"Critical Security Warning",children:[e.jsxs("p",{className:"font-bold text-lg",children:["Never reuse the nonce ",e.jsx(s,{children:"k"}),"!"]}),e.jsxs("p",{className:"mt-2",children:["If the same ",e.jsx(s,{children:"k"})," is used for two different messages, an attacker can extract the private key. This has caused real-world losses."]})]}),e.jsxs(y,{title:"Nonce Reuse Attack",children:[e.jsxs("p",{children:["Suppose Alice signs two messages with the same ",e.jsx(s,{children:"k"}),":"]}),e.jsx(l,{children:"s_1 = k^{-1}(z_1 + rd) \\quad s_2 = k^{-1}(z_2 + rd)"}),e.jsx("p",{className:"mt-2",children:"Subtracting:"}),e.jsx(l,{children:"s_1 - s_2 = k^{-1}(z_1 - z_2)"}),e.jsxs("p",{className:"mt-2",children:["Solving for ",e.jsx(s,{children:"k"}),":"]}),e.jsx(l,{children:"k = (z_1 - z_2)(s_1 - s_2)^{-1}"}),e.jsx("p",{className:"mt-2",children:"Then the private key:"}),e.jsx(l,{children:"d = r^{-1}(sk - z)"}),e.jsxs("p",{className:"mt-3 text-rose-400",children:[e.jsx("strong",{children:"Game over."})," The attacker has the private key."]})]}),e.jsx("h4",{className:"text-lg font-semibold text-dark-100 mt-6 mb-3",children:"Real-World Disasters"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mb-6",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"PlayStation 3 (2010):"})," Sony used the same ",e.jsx(s,{children:"k"})," for all game signatures. Hackers extracted the private key, enabling piracy."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Android Bitcoin wallets (2013):"})," Weak RNG caused nonce collisions. Attackers drained wallets."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Blockchain.info (2014):"})," A bug caused nonce reuse. Funds were stolen."]})]}),e.jsxs(j,{type:"success",title:"The Solution: RFC 6979",children:[e.jsxs("p",{children:["RFC 6979 defines ",e.jsx("strong",{children:"deterministic nonces"}),":"]}),e.jsx(l,{children:"k = \\text{HMAC-SHA256}(d, z)"}),e.jsxs("p",{className:"mt-2",children:["The nonce is derived deterministically from the private key and message. Same inputs = same ",e.jsx(s,{children:"k"}),". Different messages = different ",e.jsx(s,{children:"k"}),". No randomness required, no reuse possible."]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Signature Malleability"}),e.jsxs("p",{className:"mb-4",children:["Given a valid signature ",e.jsx(s,{children:"(r, s)"}),", there's always another valid signature for the same message: ",e.jsx(s,{children:"(r, n - s)"}),"."]}),e.jsxs(u,{title:"Malleability Problem",children:[e.jsxs("p",{children:["Why does ",e.jsx(s,{children:"(r, -s)"})," also verify?"]}),e.jsxs("p",{className:"mt-2",children:["In the verification equation, negating ",e.jsx(s,{children:"s"})," negates"," ",e.jsx(s,{children:"u_1"})," and ",e.jsx(s,{children:"u_2"}),", but the point"," ",e.jsx(s,{children:"-P"})," has the same x-coordinate as ",e.jsx(s,{children:"P"}),", so the check still passes."]})]}),e.jsx("p",{className:"mb-4",children:"This was a problem for Bitcoin because it allowed changing transaction IDs without invalidating signatures. The solution:"}),e.jsx(j,{type:"info",title:"Low-s Requirement (BIP 62)",children:e.jsxs("p",{children:["Bitcoin requires ",e.jsx(s,{children:"s \\leq n/2"}),". If a signature has high-s, it must be converted to low-s. This is enforced since 2014."]})})]})}export{Q as default};
