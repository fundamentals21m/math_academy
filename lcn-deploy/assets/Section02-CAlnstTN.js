import{j as e,m as r,A as p}from"./vendor-animation-0o8UKZ_1.js";import{r as j}from"./vendor-react-Drj8qL0h.js";import"./vendor-math-p018AHG0.js";import"./index-0SKjYqk6.js";import{L as k,D as P,T as w,E as C}from"./ContentBlocks-B8Bxhv2f.js";import{I as i,M as g}from"./MathBlock-uz1iP4cD.js";import{C as G}from"./Callout-Dt8juvZK.js";import"./vendor-firebase-core-BXWtuYvb.js";import"./quizMap-Bnq9ppQi.js";function N({className:u=""}){const[s,c]=j.useState(0),[d,y]=j.useState(!1),[m,f]=j.useState("script_root");j.useEffect(()=>{if(!d)return;const a=setTimeout(()=>{s<3?c(s+1):y(!1)},2e3);return()=>clearTimeout(a)},[d,s]);const h=[{title:"Original Public Key P",description:"Start with an original public key P = sk·G on the elliptic curve.",color:"#f97316"},{title:"Compute Hash t = H(P, m)",description:"Hash the public key P together with the message m to get tweak scalar t.",color:"#8b5cf6"},{title:"Compute Tweak Point t·G",description:"Multiply the generator G by the tweak scalar t to get a point on the curve.",color:"#06b6d4"},{title:"Final Key Q = P + t·G",description:"Add the tweak point to the original key to get the committed public key Q.",color:"#10b981"}],x=500,b=320,n=x/2,l=b/2,t={G:{x:n-150,y:l+50},P:{x:n-80,y:l-40},tG:{x:n+60,y:l+30},Q:{x:n+120,y:l-60}};return e.jsxs("div",{className:`p-6 rounded-2xl bg-dark-800/50 border border-dark-700/50 ${u}`,children:[e.jsx("h3",{className:"text-xl font-bold text-dark-100 mb-2",children:"Pay-to-Contract Key Tweaking"}),e.jsx("p",{className:"text-dark-400 text-sm mb-4",children:"See how Taproot commits to a message by tweaking an elliptic curve public key."}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-dark-300 text-sm mb-2",children:["Message to commit: ",e.jsx("span",{className:"text-purple-400 font-mono",children:m})]}),e.jsx("input",{type:"text",value:m,onChange:a=>f(a.target.value),className:"w-full px-4 py-2 rounded-xl bg-dark-700 border border-dark-600 text-dark-100 font-mono text-sm focus:outline-none focus:border-primary-500",placeholder:"Enter message..."})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(r.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>c(Math.max(0,s-1)),disabled:s===0,className:"px-3 py-1.5 rounded-lg bg-dark-600 hover:bg-dark-500 disabled:opacity-30 text-dark-200 text-sm",children:"← Prev"}),e.jsx(r.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{d?y(!1):(c(0),y(!0))},className:`px-4 py-1.5 rounded-lg text-sm font-medium ${d?"bg-amber-500 hover:bg-amber-600 text-white":"bg-primary-500 hover:bg-primary-600 text-white"}`,children:d?"Pause":"Play"}),e.jsx(r.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>c(Math.min(3,s+1)),disabled:s===3,className:"px-3 py-1.5 rounded-lg bg-dark-600 hover:bg-dark-500 disabled:opacity-30 text-dark-200 text-sm",children:"Next →"}),e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"flex gap-1",children:[0,1,2,3].map(a=>e.jsx("button",{onClick:()=>c(a),className:`w-8 h-8 rounded-lg text-sm font-medium transition-colors ${s===a?"bg-primary-500 text-white":"bg-dark-700 text-dark-400 hover:bg-dark-600"}`,children:a+1},a))})]}),e.jsxs("svg",{viewBox:`0 0 ${x} ${b}`,className:"w-full h-auto bg-dark-900/50 rounded-xl mb-4",children:[Array.from({length:9}).map((a,o)=>e.jsx("line",{x1:50+o*50,y1:"20",x2:50+o*50,y2:b-20,stroke:"#374151",strokeWidth:"1",strokeDasharray:"2,4"},`v${o}`)),Array.from({length:6}).map((a,o)=>e.jsx("line",{x1:"20",y1:30+o*50,x2:x-20,y2:30+o*50,stroke:"#374151",strokeWidth:"1",strokeDasharray:"2,4"},`h${o}`)),e.jsx("path",{d:`M 50 ${l+80} Q ${n} ${l-100} ${x-50} ${l+80}`,fill:"none",stroke:"#4b5563",strokeWidth:"2",strokeDasharray:"8,4"}),e.jsx("text",{x:x-80,y:l+100,fill:"#6b7280",fontSize:"10",children:"Elliptic Curve"}),e.jsxs(r.g,{initial:{opacity:0},animate:{opacity:1},children:[e.jsx("circle",{cx:t.G.x,cy:t.G.y,r:"8",fill:"#6b7280"}),e.jsx("text",{x:t.G.x,y:t.G.y+25,fill:"#9ca3af",fontSize:"12",textAnchor:"middle",children:"G (generator)"})]}),e.jsx(p,{children:s>=0&&e.jsxs(r.g,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{duration:.5},children:[e.jsx("circle",{cx:t.P.x,cy:t.P.y,r:"10",fill:"#f97316"}),e.jsx("text",{x:t.P.x,y:t.P.y-18,fill:"#f97316",fontSize:"12",fontWeight:"bold",textAnchor:"middle",children:"P = sk·G"})]})}),e.jsx(p,{children:s>=1&&e.jsxs(r.g,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[e.jsx("rect",{x:n-60,y:"20",width:"120",height:"40",rx:"8",fill:"#8b5cf6",fillOpacity:"0.2",stroke:"#8b5cf6",strokeWidth:"2"}),e.jsxs("text",{x:n,y:"38",fill:"#8b5cf6",fontSize:"10",textAnchor:"middle",children:['H(P, "',m.slice(0,10),m.length>10?"...":"",'")']}),e.jsx("text",{x:n,y:"52",fill:"#c4b5fd",fontSize:"11",fontWeight:"bold",textAnchor:"middle",children:"= t"}),e.jsx(r.path,{d:`M ${t.P.x} ${t.P.y-30} Q ${t.P.x+30} 45 ${n-60} 40`,fill:"none",stroke:"#8b5cf6",strokeWidth:"2",strokeDasharray:"4,2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.5}})]})}),e.jsx(p,{children:s>=2&&e.jsxs(r.g,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{duration:.5},children:[e.jsx("circle",{cx:t.tG.x,cy:t.tG.y,r:"10",fill:"#06b6d4"}),e.jsx("text",{x:t.tG.x,y:t.tG.y+25,fill:"#06b6d4",fontSize:"12",fontWeight:"bold",textAnchor:"middle",children:"t·G"}),e.jsx(r.line,{x1:t.G.x+10,y1:t.G.y,x2:t.tG.x-12,y2:t.tG.y,stroke:"#06b6d4",strokeWidth:"2",markerEnd:"url(#arrowCyan)",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.5}})]})}),e.jsx(p,{children:s>=3&&e.jsxs(r.g,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{duration:.5},children:[e.jsx("circle",{cx:t.Q.x,cy:t.Q.y,r:"12",fill:"#10b981",stroke:"#10b981",strokeWidth:"3"}),e.jsx("text",{x:t.Q.x,y:t.Q.y-20,fill:"#10b981",fontSize:"13",fontWeight:"bold",textAnchor:"middle",children:"Q = P + t·G"}),e.jsx(r.path,{d:`M ${t.P.x+10} ${t.P.y} Q ${(t.P.x+t.Q.x)/2} ${t.P.y-40} ${t.Q.x-10} ${t.Q.y}`,fill:"none",stroke:"#10b981",strokeWidth:"2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.5}}),e.jsx(r.path,{d:`M ${t.tG.x} ${t.tG.y-10} Q ${(t.tG.x+t.Q.x)/2} ${t.tG.y-50} ${t.Q.x} ${t.Q.y+10}`,fill:"none",stroke:"#10b981",strokeWidth:"2",strokeDasharray:"4,2",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.5,delay:.2}})]})}),e.jsx("defs",{children:e.jsx("marker",{id:"arrowCyan",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#06b6d4"})})})]}),e.jsxs(r.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"p-4 rounded-xl border",style:{backgroundColor:`${h[s].color}10`,borderColor:`${h[s].color}30`},children:[e.jsxs("h4",{className:"font-bold mb-1",style:{color:h[s].color},children:["Step ",s+1,": ",h[s].title]}),e.jsx("p",{className:"text-dark-300 text-sm",children:h[s].description})]},s),e.jsxs("div",{className:"mt-4 p-4 rounded-xl bg-amber-500/10 border border-amber-500/20",children:[e.jsx("h4",{className:"text-amber-400 font-medium text-sm mb-1",children:"Bitcoin Taproot Application"}),e.jsxs("p",{className:"text-dark-400 text-xs",children:["In Taproot, the message ",e.jsx("code",{className:"text-purple-400",children:"m"})," is the Merkle root of a script tree. The tweaked key ",e.jsx("code",{className:"text-emerald-400",children:"Q"})," can be spent either by signing with the tweaked secret key ",e.jsx("code",{className:"text-orange-400",children:"(sk + t)"}),", or by revealing the script and proving it hashes to ",e.jsx("code",{className:"text-purple-400",children:"m"}),"."]})]})]})}function L(){return e.jsxs(k,{sectionId:2,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Pay-to-Contract"}),e.jsxs("p",{className:"mb-4",children:["Pay-to-Contract (P2C) is a commitment scheme where the commitment is a group element in ",e.jsxs(i,{children:["\\mathbb","{G}"]}),". This scheme is particularly important in Bitcoin because it enables Taproot functionality."]}),e.jsxs(P,{title:"Pay-to-Contract Commitment",children:[e.jsxs("p",{children:["Given a generator ",e.jsx(i,{children:"G"})," of ",e.jsxs(i,{children:["\\mathbb","{G}"]}),", a hash function ",e.jsxs(i,{children:["H_","P2C"]}),", a message"," ",e.jsx(i,{children:"m \\in \\{0,1\\}^*"}),", and a group element"," ",e.jsxs(i,{children:["P \\in \\mathbb","{G}"]}),", the commitment algorithm is:"]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 mt-4 font-mono text-sm",children:[e.jsxs("p",{className:"text-indigo-400 font-bold mb-2",children:["P2C",e.jsx("sub",{children:"Commit"}),"(m; P)"]}),e.jsxs("p",{children:["1: ",e.jsxs(i,{children:["t \\leftarrow H_","{P2C}","(P, m)"]})]}),e.jsxs("p",{children:["2: ",e.jsx("strong",{children:"return"})," ",e.jsx(i,{children:"P + t \\cdot G"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Key Feature: Tweaking Secret Keys"}),e.jsxs("p",{className:"mb-4",children:["The main feature of Pay-to-Contract is that knowledge of a scalar"," ",e.jsx(i,{children:"sk \\in \\mathbb{Z}_p"})," such that"," ",e.jsx(i,{children:"sk \\cdot G = P"})," allows computing the discrete logarithm of the commitment:"]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 mt-4 font-mono text-sm mb-6",children:[e.jsxs("p",{className:"text-indigo-400 font-bold mb-2",children:["P2C",e.jsx("sub",{children:"TweakSeckey"}),"(m, sk)"]}),e.jsxs("p",{children:["1: ",e.jsxs(i,{children:["t \\leftarrow H_","{P2C}","(sk \\cdot G, m)"]})]}),e.jsxs("p",{children:["2: ",e.jsx("strong",{children:"return"})," ",e.jsx(i,{children:"sk + t \\mod p"})]})]}),e.jsx(G,{type:"success",title:"Taproot Application",children:e.jsxs("p",{children:["This feature is used in Bitcoin's Taproot to allow creating Schnorr signatures for a Pay-to-Contract commitment. The public key can commit to a script (the message"," ",e.jsx(i,{children:"m"}),"), and the owner can still sign with the tweaked secret key."]})}),e.jsx(w,{title:"Lemma 1: Pay-to-Contract is Binding",proof:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{children:["1. Let ",e.jsxs(i,{children:["\\mathcal","{A}"]})," be a PPT adversary against the binding property of the Pay-to-Contract commitment scheme."]}),e.jsxs("p",{children:["2. Let ",e.jsx(i,{children:"q"})," denote the number of queries the adversary makes to the random oracle ",e.jsxs(i,{children:["H_","{P2C}"]}),". Since the adversary is PPT,"," ",e.jsx(i,{children:"q \\in \\text{poly}(\\lambda)"}),"."]}),e.jsxs("p",{children:["3. There are at most ",e.jsx(i,{children:"q(q-1) \\leq q^2"})," distinct pairs of queries to ",e.jsxs(i,{children:["H_","{P2C}"]}),"."]}),e.jsxs("p",{children:["4. For any pair of distinct queries ",e.jsx(i,{children:"(P, m)"})," and"," ",e.jsx(i,{children:"(P', m')"}),", the probability that:"]}),e.jsx(g,{children:"P - P' = H_{\\text{P2C}}(P, m)G - H_{\\text{P2C}}(P', m')G"}),e.jsxs("p",{children:["is ",e.jsx(i,{children:"1/p"}),". Therefore, the probability that"," ",e.jsx(i,{children:"\\text{P2C}_{\\text{Commit}}(m; P) = \\text{P2C}_{\\text{Commit}}(m'; P')"})," ","is ",e.jsx(i,{children:"1/p"}),"."]}),e.jsxs("p",{children:["5. By the union bound, the probability that the adversary queried distinct"," ",e.jsx(i,{children:"(P, m)"})," and ",e.jsx(i,{children:"(P', m')"})," such that their commitments collide is ",e.jsx(i,{children:"\\leq q^2/p"}),"."]}),e.jsxs("p",{children:["6. Hence, ",e.jsx(i,{children:"\\mu(\\lambda) = q^2/p"})," which is a negligible function (since ",e.jsx(i,{children:"p"})," is exponential in ",e.jsx(i,{children:"\\lambda"})," ","and ",e.jsx(i,{children:"q"})," is polynomial)."]})]}),children:e.jsx("p",{children:"Pay-to-Contract is a binding commitment scheme in the random oracle model."})}),e.jsxs(C,{title:"Taproot Key Commitment",children:[e.jsxs("p",{children:["In Taproot, a user with key pair ",e.jsx(i,{children:"(sk, P = sk \\cdot G)"})," can commit to a script tree ",e.jsx(i,{children:"m"}),":"]}),e.jsx(g,{children:"Q = P + H_{\\text{P2C}}(P, m) \\cdot G"}),e.jsxs("p",{className:"mt-2",children:["The public key ",e.jsx(i,{children:"Q"})," is published on-chain. To spend:"]}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Key path:"})," Sign with ",e.jsxs(i,{children:["sk' = sk + H_","{P2C}","(P, m)"]})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Script path:"})," Reveal ",e.jsx(i,{children:"P"})," and ",e.jsx(i,{children:"m"}),", execute script"]})]})]}),e.jsx(N,{className:"my-8"})]})}export{L as default};
