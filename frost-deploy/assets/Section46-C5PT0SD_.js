import{j as e}from"./vendor-animation-0o8UKZ_1.js";import{L as l}from"./LessonLayout-sKo1Ukyt.js";import{D as t,T as a,E as r,C as n}from"./Callout-D6GJ8KQY.js";import{M as i,I as s}from"./MathBlock-uz1iP4cD.js";import"./vendor-react-Drj8qL0h.js";import"./index-LWQys88K.js";import"./vendor-math-p018AHG0.js";import"./vendor-firebase-core-BXWtuYvb.js";import"./quizMap-ySXQbKre.js";function g(){return e.jsxs(l,{sectionId:46,children:[e.jsx("h2",{children:"Bitcoin Taproot Integration"}),e.jsx("p",{children:"Bitcoin's Taproot upgrade (activated November 2021) provides native support for Schnorr signatures. FROST integrates seamlessly with Taproot, enabling threshold signatures that are indistinguishable from single-party spending."}),e.jsx("h3",{children:"Taproot Structure"}),e.jsxs(t,{title:"Taproot Output",children:[e.jsx("p",{children:"A Taproot output commits to:"}),e.jsx(i,{children:"P = Y + [t]G"}),e.jsx("p",{className:"mt-3",children:"where:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[e.jsxs("li",{children:[e.jsx(s,{children:"Y"})," is the internal public key (can be FROST key)"]}),e.jsxs("li",{children:[e.jsx(s,{children:"t = H(Y || \\text{merkle\\_root})"})," is the tweak"]}),e.jsxs("li",{children:[e.jsx(s,{children:"\\text{merkle\\_root}"})," commits to optional script paths"]})]})]}),e.jsx("h3",{children:"FROST as Key Path"}),e.jsxs(t,{title:"Key Path Spending",children:[e.jsx("p",{children:"The most common spending method:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[e.jsxs("li",{children:["Set internal key ",e.jsx(s,{children:"Y = Y_{\\text{FROST}}"})," (the FROST public key)"]}),e.jsxs("li",{children:["Compute tweaked key: ",e.jsx(s,{children:"P = Y + [t]G"})]}),e.jsxs("li",{children:["Spend by providing a Schnorr signature valid for ",e.jsx(s,{children:"P"})]})]}),e.jsx("p",{className:"mt-3",children:"From the blockchain's perspective, this looks like any other Taproot spend - a single signature for a single key."})]}),e.jsx("h3",{children:"Tweaked Key Signing"}),e.jsxs(a,{title:"Adjusting FROST Shares for Tweak",children:[e.jsxs("p",{children:["To sign for the tweaked key ",e.jsx(s,{children:"P = Y + [t]G"}),", each participant adjusts their share:"]}),e.jsx(i,{children:"s'_i = s_i + \\lambda_i \\cdot t"}),e.jsxs("p",{className:"mt-3",children:["The effective secret for the tweaked key is"," ",e.jsx(s,{children:"s' = s + t"}),", and it satisfies"," ",e.jsx(s,{children:"P = [s']G"}),"."]})]}),e.jsxs(r,{title:"Why This Works",children:[e.jsx("p",{children:"Consider the tweaked secret:"}),e.jsx(i,{children:"s' = s + t"}),e.jsx("p",{className:"mt-3",children:"With Shamir-shared original secret:"}),e.jsx(i,{children:"s = \\sum_{i \\in S} \\lambda_i \\cdot s_i"}),e.jsx("p",{className:"mt-3",children:"The tweak is public, so we can distribute it using Lagrange coefficients:"}),e.jsx(i,{children:"t = t \\cdot 1 = t \\cdot \\sum_{i \\in S} \\lambda_i = \\sum_{i \\in S} \\lambda_i \\cdot t"}),e.jsx("p",{className:"mt-3",children:"Therefore:"}),e.jsx(i,{children:"s' = \\sum_{i \\in S} \\lambda_i \\cdot s_i + \\sum_{i \\in S} \\lambda_i \\cdot t = \\sum_{i \\in S} \\lambda_i \\cdot (s_i + t)"}),e.jsx("p",{className:"mt-3",children:"Hmm, that's not quite right. Let's be more careful."})]}),e.jsxs(n,{type:"info",children:[e.jsx("strong",{children:"Correct Tweak Application:"}),e.jsxs("p",{className:"mt-2",children:["Actually, each participant computes ",e.jsx(s,{children:"s'_i = s_i"})," (unchanged share) and adds the tweak to the final signature response:"]}),e.jsx(i,{children:"z_i = k_i + (s_i \\cdot \\lambda_i + t) \\cdot c"}),e.jsx("p",{className:"mt-2",children:"Wait, that's also not right. Let me clarify the correct approach."})]}),e.jsxs(t,{title:"Correct Tweak Handling",children:[e.jsxs("p",{children:["The tweak ",e.jsx(s,{children:"t"})," needs to be added exactly once. Options:"]}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"One participant adds it:"})," Designate one participant to add"," ",e.jsx(s,{children:"t"})," to their share"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Distributed addition:"})," Each participant adds"," ",e.jsx(s,{children:"t / |S|"})," (requires knowing ",e.jsx(s,{children:"|S|"}),")"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Coordinator adds it:"})," Add ",e.jsx(s,{children:"t \\cdot c"})," to the aggregated ",e.jsx(s,{children:"z"})]})]})]}),e.jsxs(r,{title:"Coordinator Method",children:[e.jsx("p",{children:"The simplest approach is for the coordinator to handle the tweak:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 mt-2",children:[e.jsxs("li",{children:["Run standard FROST signing for internal key ",e.jsx(s,{children:"Y"})]}),e.jsxs("li",{children:["Get aggregated signature ",e.jsx(s,{children:"(R, z)"})," valid for"," ",e.jsx(s,{children:"Y"})]}),e.jsxs("li",{children:["Compute tweaked signature: ",e.jsx(s,{children:"z' = z + t \\cdot c"})]}),e.jsxs("li",{children:["Final signature ",e.jsx(s,{children:"(R, z')"})," is valid for"," ",e.jsx(s,{children:"P"})]})]})]}),e.jsx("h3",{children:"Script Path Fallback"}),e.jsxs(t,{title:"Script Paths",children:[e.jsx("p",{children:"Taproot allows optional script paths for complex spending conditions:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Key path (primary):"})," FROST threshold signature"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Script path (fallback):"})," e.g., timelocked recovery"]})]}),e.jsx("p",{className:"mt-3",children:"Example: 2-of-3 FROST, with 90-day timelock recovery to a backup key."})]}),e.jsx(r,{title:"Practical Taproot Structure",children:e.jsx("pre",{className:"bg-gray-800 p-4 rounded mt-2 text-sm",children:`Internal Key: FROST 2-of-3 public key Y

Script Tree:
  - Leaf 1: <90 days> OP_CHECKSEQUENCEVERIFY OP_DROP <recovery_key> OP_CHECKSIG

Tweaked Key: P = Y + H(Y || merkle_root) * G

Normal spending: FROST signature (looks like single-sig)
Recovery: Reveal script, provide recovery signature after 90 days`})}),e.jsx("h3",{children:"Privacy Benefits"}),e.jsxs(n,{type:"success",children:[e.jsx("strong",{children:"What Observers See:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Key path spend:"})," Single public key, single 64-byte signature"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"No indication of:"})," Threshold structure, number of participants, which subset signed"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Script paths:"})," Hidden unless used (MAST)"]})]})]}),e.jsx("h3",{children:"On-Chain Efficiency"}),e.jsxs(t,{title:"Transaction Size Comparison",children:[e.jsxs("table",{className:"w-full mt-4 text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-600",children:[e.jsx("th",{className:"text-left py-2",children:"Method"}),e.jsx("th",{className:"text-left py-2",children:"Witness Size"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"py-2",children:"FROST + Taproot"}),e.jsx("td",{className:"py-2",children:"64 bytes (signature only)"})]}),e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"py-2",children:"2-of-3 P2WSH Multisig"}),e.jsx("td",{className:"py-2",children:"~220 bytes"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2",children:"3-of-5 P2WSH Multisig"}),e.jsx("td",{className:"py-2",children:"~340 bytes"})]})]})]}),e.jsx("p",{className:"mt-3",children:"FROST with Taproot uses ~70-80% less block space than traditional multisig!"})]}),e.jsx("h3",{children:"Implementation Considerations"}),e.jsxs(t,{title:"BIP 340 Compliance",children:[e.jsx("p",{children:"Bitcoin's Schnorr signature standard (BIP 340) requires:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"x-only public keys:"})," 32 bytes, implicitly even y-coordinate"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Signature format:"})," ",e.jsx(s,{children:"(r, s)"})," where"," ",e.jsx(s,{children:"r"})," is x-coordinate of ",e.jsx(s,{children:"R"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Tagged hashes:"})," Domain separation for different hash uses"]})]}),e.jsx("p",{className:"mt-3",children:"FROST implementations for Bitcoin must handle y-coordinate parity correctly."})]}),e.jsx("p",{children:"Taproot integration makes FROST a practical reality for Bitcoin. The threshold security of FROST combined with the privacy and efficiency of Taproot creates an ideal solution for secure Bitcoin custody."})]})}export{g as default};
