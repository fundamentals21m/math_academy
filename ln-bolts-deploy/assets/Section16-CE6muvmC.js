import{j as e}from"./vendor-animation-0o8UKZ_1.js";import"./vendor-react-Drj8qL0h.js";import"./vendor-math-p018AHG0.js";import"./index-BbBpzejs.js";import{L as t}from"./LessonLayout-Bq4tucEw.js";import{D as s,T as n,C as i,E as r}from"./Callout-BvJhqaqq.js";import"./vendor-firebase-core-BXWtuYvb.js";import"./quizMap-C4dST7Re.js";function j(){return e.jsxs(t,{sectionId:16,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BOLT #7: Network Topology"}),e.jsx("p",{className:"mb-4",children:"BOLT #7 defines the gossip protocol that Lightning nodes use to discover each other and learn about the network topology. This enables decentralized routing without relying on central servers."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Gossip Message Types"}),e.jsx("p",{className:"mb-4",children:"The gossip protocol uses three main message types to share network information:"}),e.jsxs(s,{title:"channel_announcement (type 256)",children:["Announces a new channel to the network. Requires signatures from both nodes and proof of the funding transaction:",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"node_signature_1, node_signature_2:"})," Signatures from both nodes"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"bitcoin_signature_1, bitcoin_signature_2:"})," Funding key signatures"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"short_channel_id:"})," Compact channel identifier"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"node_id_1, node_id_2:"})," Public keys of both nodes"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"bitcoin_key_1, bitcoin_key_2:"})," Funding pubkeys"]})]})]}),e.jsxs(s,{title:"node_announcement (type 257)",children:["Announces node metadata such as alias, color, and connection addresses:",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"signature:"})," Signature from the node"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"timestamp:"})," Unix timestamp (newer replaces older)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"node_id:"})," Node's public key"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"rgb_color:"})," 3 bytes for node color"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"alias:"})," 32-byte UTF-8 node name"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"addresses:"})," How to connect (IPv4, IPv6, Tor, etc.)"]})]})]}),e.jsxs(s,{title:"channel_update (type 258)",children:["Updates channel routing parameters (one per direction):",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"signature:"})," Signature from the announcing node"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"short_channel_id:"})," Which channel this updates"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"timestamp:"})," For determining freshness"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"channel_flags:"})," Direction and disabled status"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"cltv_expiry_delta:"})," Timelock delta for forwarding"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"htlc_minimum_msat:"})," Minimum HTLC size"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"fee_base_msat:"})," Base routing fee"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"fee_proportional_millionths:"})," Per-satoshi fee rate"]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Short Channel ID"}),e.jsx("p",{className:"mb-4",children:"The short_channel_id is a compact 8-byte identifier for channels:"}),e.jsxs(n,{title:"Short Channel ID Format",children:[e.jsx("div",{className:"font-mono text-sm bg-dark-800 p-3 rounded mt-2",children:"block_height (3 bytes) || tx_index (3 bytes) || output_index (2 bytes)"}),e.jsxs("p",{className:"mt-2",children:["Human-readable format: block_height x tx_index x output_index",e.jsx("br",{}),"Example: 539268x845x1"]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Announcement Signatures"}),e.jsx("p",{className:"mb-4",children:"Before a channel can be announced, both peers must exchange signatures:"}),e.jsxs(s,{title:"announcement_signatures (type 259)",children:["Exchanged directly between peers (not gossiped):",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"channel_id:"})," The channel being announced"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"short_channel_id:"})," Derived from funding tx location"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"node_signature:"})," Peer's signature for announcement"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"bitcoin_signature:"})," Signature with funding key"]})]})]}),e.jsx(i,{type:"info",title:"Confirmation Requirement",children:"Channels can only be announced after 6 confirmations of the funding transaction. This prevents announcement of channels that might be reorganized away."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Address Types"}),e.jsx("p",{className:"mb-4",children:"Node announcements can include multiple address types:"}),e.jsx(r,{title:"Supported Address Types",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-2",children:"Type"}),e.jsx("th",{className:"text-left py-2",children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"1"}),e.jsx("td",{className:"py-2",children:"IPv4 (4 bytes + 2 byte port)"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"2"}),e.jsx("td",{className:"py-2",children:"IPv6 (16 bytes + 2 byte port)"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"4"}),e.jsx("td",{className:"py-2",children:"Tor v3 onion (35 bytes + 2 byte port)"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 font-mono",children:"5"}),e.jsx("td",{className:"py-2",children:"DNS hostname (variable + 2 byte port)"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Gossip Propagation"}),e.jsx("p",{className:"mb-4",children:"Nodes share gossip messages with their peers, who forward to their peers:"}),e.jsx(n,{title:"Gossip Rules",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Rate Limiting:"})," Nodes should flush outgoing gossip every 60 seconds"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Deduplication:"})," Don't forward messages already sent to a peer"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Validation:"})," Verify signatures before forwarding"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Freshness:"})," Only accept channel_updates with newer timestamps"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Channel Pruning"}),e.jsx("p",{className:"mb-4",children:"Stale channels are removed from the network view:"}),e.jsx(i,{type:"warning",title:"Pruning Rules",children:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"No updates:"})," Channels with no channel_update in 2 weeks are pruned"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Closed on-chain:"})," Channels closed on-chain (72+ blocks) are pruned"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Invalid funding:"})," Funding tx not found or spent = prune"]})]})})]})}export{j as default};
