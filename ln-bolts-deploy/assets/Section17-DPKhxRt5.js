import{j as e}from"./vendor-animation-0o8UKZ_1.js";import"./vendor-react-Drj8qL0h.js";import"./vendor-math-p018AHG0.js";import"./index-DFrfwBbR.js";import{L as n,D as i,E as s,C as t,T as a}from"./Callout-DlDYJSPr.js";import{M as l}from"./MathBlock-BfkVbDlQ.js";import"./vendor-firebase-core-BXWtuYvb.js";import"./quizMap-C4dST7Re.js";function j(){return e.jsxs(n,{sectionId:17,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Channel Updates"}),e.jsx("p",{className:"mb-4",children:"Channel updates announce the routing parameters for a specific channel direction. Each channel has two channel_update messages—one from each endpoint—describing fees and policies for forwarding in that direction."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Fee Structure"}),e.jsx("p",{className:"mb-4",children:"Lightning routing fees have two components:"}),e.jsxs(i,{title:"Routing Fee Formula",children:[e.jsx(l,{children:"\\text{fee} = \\text{fee\\_base\\_msat} + \\frac{\\text{amount\\_msat} \\times \\text{fee\\_proportional\\_millionths}}{1{,}000{,}000}"}),e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"fee_base_msat:"})," Flat fee per forwarded HTLC"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"fee_proportional_millionths:"})," Rate per million satoshis"]})]})]}),e.jsxs(s,{title:"Fee Calculation",children:[e.jsx("p",{className:"mb-2",children:"For a 1,000,000 msat (1000 sat) payment through a node with:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsx("li",{children:"fee_base_msat = 1000 (1 sat base fee)"}),e.jsx("li",{children:"fee_proportional_millionths = 100 (0.01% = 100 ppm)"})]}),e.jsx(l,{children:"\\text{fee} = 1000 + \\frac{1{,}000{,}000 \\times 100}{1{,}000{,}000} = 1000 + 100 = 1100 \\text{ msat}"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"CLTV Expiry Delta"}),e.jsx("p",{className:"mb-4",children:"The cltv_expiry_delta specifies how much timelock buffer a node requires:"}),e.jsxs(i,{title:"CLTV Delta Purpose",children:["When forwarding a payment:",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Incoming HTLC has CLTV expiry T"}),e.jsx("li",{children:"Outgoing HTLC must have CLTV expiry at most T - cltv_expiry_delta"}),e.jsx("li",{children:"This buffer ensures time to claim incoming HTLC if outgoing is claimed on-chain"})]})]}),e.jsx(t,{type:"warning",title:"Security Implications",children:"Too small a delta risks funds: if the outgoing HTLC is claimed on-chain, you need enough blocks to extract the preimage and claim the incoming HTLC. Typical values are 40-144 blocks."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Channel Flags"}),e.jsx("p",{className:"mb-4",children:"The channel_flags field indicates direction and status:"}),e.jsx(s,{title:"Channel Flags",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-2",children:"Bit"}),e.jsx("th",{className:"text-left py-2",children:"Meaning"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"0"}),e.jsx("td",{className:"py-2",children:"Direction: 0 = node_id_1 → node_id_2, 1 = reverse"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 font-mono",children:"1"}),e.jsx("td",{className:"py-2",children:"Disabled: 1 = channel temporarily disabled"})]})]})]})}),e.jsxs(i,{title:"Channel Direction",children:["In a channel_announcement, nodes are ordered lexicographically (node_id_1 ","<"," node_id_2). The direction bit indicates which way this update applies:",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Bit 0 = 0:"})," For payments from node_id_1 to node_id_2"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bit 0 = 1:"})," For payments from node_id_2 to node_id_1"]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"HTLC Limits"}),e.jsx("p",{className:"mb-4",children:"Channel updates can specify limits on HTLCs:"}),e.jsx(s,{title:"HTLC Constraints",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-2",children:"Field"}),e.jsx("th",{className:"text-left py-2",children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"htlc_minimum_msat"}),e.jsx("td",{className:"py-2",children:"Smallest HTLC this node will forward"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 font-mono",children:"htlc_maximum_msat"}),e.jsx("td",{className:"py-2",children:"Largest HTLC this node will forward (optional)"})]})]})]})}),e.jsx(t,{type:"info",title:"Why Set Limits?",children:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Minimum:"})," Avoid routing tiny payments that aren't worth the fee"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Maximum:"})," Reserve capacity for multiple payments or avoid risk"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Timestamp and Freshness"}),e.jsx("p",{className:"mb-4",children:"Channel updates use timestamps to determine which version is current:"}),e.jsx(a,{title:"Update Replacement Rules",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[e.jsx("li",{children:"Updates with newer timestamps replace older ones"}),e.jsx("li",{children:"Updates within the same second: accept if signature differs"}),e.jsx("li",{children:"Nodes should update at least every 2 weeks to avoid pruning"}),e.jsx("li",{children:"Don't accept updates with future timestamps (clock skew tolerance)"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Disabling Channels"}),e.jsx("p",{className:"mb-4",children:"Nodes can temporarily disable a channel direction without closing the channel:"}),e.jsx(s,{title:"Reasons to Disable",children:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Peer is offline"}),e.jsx("li",{children:"Maintenance or upgrades"}),e.jsx("li",{children:"Insufficient liquidity in that direction"}),e.jsx("li",{children:"Rate limiting due to high traffic"})]})}),e.jsxs(t,{type:"success",title:"Dynamic Fee Adjustment",children:["Sophisticated routing nodes dynamically adjust their fees based on:",e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Channel balance (higher fees when liquidity is scarce)"}),e.jsx("li",{children:"Demand patterns (higher fees during peak times)"}),e.jsx("li",{children:"Rebalancing needs (lower fees to attract inbound)"})]})]})]})}export{j as default};
