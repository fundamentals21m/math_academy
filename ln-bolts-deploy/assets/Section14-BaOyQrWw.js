import{j as e}from"./vendor-animation-0o8UKZ_1.js";import"./vendor-react-Drj8qL0h.js";import"./vendor-math-p018AHG0.js";import"./index-DFrfwBbR.js";import{L as r,E as t,D as i,C as s,T as l}from"./Callout-DlDYJSPr.js";import"./vendor-firebase-core-BXWtuYvb.js";import"./quizMap-C4dST7Re.js";function x(){return e.jsxs(r,{sectionId:14,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Unilateral Close"}),e.jsx("p",{className:"mb-4",children:"A unilateral close occurs when one party broadcasts their commitment transaction without cooperation from the other party. This is the fallback when mutual close is not possible."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"When to Unilaterally Close"}),e.jsx(t,{title:"Unilateral Close Triggers",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Peer Unresponsive:"})," Cannot reach peer to negotiate mutual close"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"HTLC Expiring:"})," Must claim HTLC on-chain before timeout"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Protocol Violation:"})," Peer sent invalid messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Dispute:"})," Disagreement about channel state"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Emergency:"})," Need funds immediately"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Broadcasting the Commitment"}),e.jsx("p",{className:"mb-4",children:"When you broadcast your commitment transaction, you're committing to the current channel state. Several outputs may need further transactions to resolve."}),e.jsxs(i,{title:"Outputs to Resolve",children:["After broadcasting your commitment transaction:",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"to_local:"})," Wait for to_self_delay, then spend"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"to_remote:"})," Immediately spendable by counterparty"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Offered HTLCs:"})," Wait for timeout, use HTLC-timeout tx"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Received HTLCs:"})," Claim with preimage via HTLC-success tx"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Anchors:"})," May use for CPFP fee bumping"]})]})]}),e.jsx(s,{type:"warning",title:"The CSV Delay",children:"Your to_local output cannot be spent until to_self_delay blocks after the commitment transaction confirms. This delay (typically 144 blocks / ~1 day) gives the counterparty time to submit a penalty if you broadcast a revoked commitment."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Handling Local Commitment"}),e.jsx("p",{className:"mb-4",children:"When YOU broadcast your commitment transaction:"}),e.jsx(l,{title:"Local Commitment Resolution",children:e.jsxs("ol",{className:"list-decimal list-inside space-y-2 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"to_local:"})," Wait for commitment to confirm, then wait to_self_delay blocks, then spend using your delayed_payment key."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Offered HTLCs:"})," If no preimage, wait for CLTV expiry, broadcast HTLC-timeout transaction, wait to_self_delay, spend the output."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Received HTLCs:"})," If you have the preimage, broadcast HTLC-success transaction immediately, wait to_self_delay, spend the output."]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Handling Remote Commitment"}),e.jsx("p",{className:"mb-4",children:"When your PEER broadcasts their commitment transaction:"}),e.jsx(l,{title:"Remote Commitment Resolution",children:e.jsxs("ol",{className:"list-decimal list-inside space-y-2 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"to_remote (your output):"})," Immediately spendable with your payment key. No delay!"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Their Offered HTLCs (to you):"})," If you have the preimage, spend directly from the commitment transaction using the preimage path."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Your Offered HTLCs (to them):"})," Monitor for preimage revelation. If they claim, extract preimage. If not, the value was already yours."]})]})}),e.jsxs(t,{title:"Preimage Extraction",children:[e.jsx("p",{className:"mb-2 text-sm",children:"If the counterparty claims an HTLC you offered them, you MUST extract the preimage from their transaction:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsx("li",{children:"The preimage is in the witness data"}),e.jsx("li",{children:"Use it to claim corresponding upstream HTLCs"}),e.jsx("li",{children:"This is critical for multi-hop payment security"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"HTLC Deadlines"}),e.jsx("p",{className:"mb-4",children:"HTLCs have strict timing requirements to maintain security:"}),e.jsxs(i,{title:"CLTV Expiry Delta",children:["For forwarded payments, you must ensure your outgoing HTLC's CLTV is at least cltv_expiry_delta blocks before your incoming HTLC's CLTV. This provides time to:",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Detect the outgoing HTLC being claimed on-chain"}),e.jsx("li",{children:"Extract the preimage from the transaction"}),e.jsx("li",{children:"Use the preimage to claim the incoming HTLC"})]})]}),e.jsxs(s,{type:"danger",title:"HTLC Timeout Risk",children:["If you don't claim an HTLC before its CLTV expiry, the sender can reclaim it. For forwarded payments, you could lose money if:",e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"The downstream HTLC is claimed (you paid out)"}),e.jsx("li",{children:"But you fail to claim the upstream HTLC (you didn't receive)"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Transaction Confirmation"}),e.jsx("p",{className:"mb-4",children:"Nodes must monitor for confirmation of all on-chain transactions:"}),e.jsx(t,{title:"Confirmation Depth Requirements",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-2",children:"Transaction"}),e.jsx("th",{className:"text-left py-2",children:"Required Depth"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"Commitment"}),e.jsx("td",{className:"py-2",children:"1 (then wait CSV delay)"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"HTLC-success/timeout"}),e.jsx("td",{className:"py-2",children:"1 (then wait CSV delay)"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2",children:"Final resolution"}),e.jsx("td",{className:"py-2",children:"100 (irrevocably resolved)"})]})]})]})}),e.jsxs(s,{type:"info",title:"Reorg Handling",children:["If a blockchain reorganization occurs:",e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Transactions may become unconfirmed"}),e.jsx("li",{children:"Re-broadcast if necessary"}),e.jsx("li",{children:"Adjust for new CLTV deadlines"}),e.jsx("li",{children:"Continue monitoring until depth 100"})]})]})]})}export{x as default};
