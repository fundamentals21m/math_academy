import{j as e,A as w,m as h}from"./vendor-animation-0o8UKZ_1.js";import{r as p}from"./vendor-react-Drj8qL0h.js";import"./vendor-math-p018AHG0.js";import"./index-BbBpzejs.js";import{L as T}from"./LessonLayout-Bq4tucEw.js";import{D as x,E as b,C as g,T as q}from"./Callout-BvJhqaqq.js";import"./vendor-firebase-core-BXWtuYvb.js";import"./quizMap-C4dST7Re.js";const N=o=>{if(!o.toLowerCase().startsWith("ln"))return null;const a=o.slice(0,4).toLowerCase();let l="unknown";a.includes("bc")?l="mainnet":a.includes("tb")?l="testnet":a.includes("bcrt")&&(l="regtest");const s=o.match(/ln[a-z]+(\d+)([munp]?)/i);let d;if(s){const n=parseInt(s[1]),c=s[2]||"";let t=n,r="BTC";switch(c.toLowerCase()){case"m":t=n*1e5,r="mBTC";break;case"u":t=n*100,r="Î¼BTC";break;case"n":t=Math.floor(n/10),r="nBTC";break;case"p":t=Math.floor(n/1e4),r="pBTC";break}d={value:n,unit:r,sats:t}}return{prefix:a,network:l,amount:d,timestamp:Math.floor(Date.now()/1e3)-Math.floor(Math.random()*3600),paymentHash:Array.from({length:64},()=>"0123456789abcdef"[Math.floor(Math.random()*16)]).join(""),description:"Payment for coffee â˜•",expiry:3600,minFinalCltvExpiry:18,routeHints:[],features:["var_onion_optin","payment_secret"],signature:Array.from({length:64},()=>"0123456789abcdef"[Math.floor(Math.random()*16)]).join("")}},f={paymentHash:{description:"SHA256 hash of the preimage. Proves payment was made."},description:{description:"UTF-8 description of the purpose of payment."},features:{description:"Required and supported features for this payment."}};function S({className:o=""}){const[a,l]=p.useState(""),[s,d]=p.useState(null),[n,c]=p.useState(""),[t,r]=p.useState(null),k=()=>{if(!a.trim()){c("Please enter a Lightning invoice"),d(null);return}const i=N(a.trim());i?(d(i),c("")):(c('Invalid invoice format. Must start with "ln"'),d(null))},j=i=>{const y={simple:"lnbc100n",withDescription:"lnbc1m",withRouteHints:"lnbc500u"}[i]+"1"+Array.from({length:200},()=>"0123456789abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*36)]).join("");l(y);const u=N(y);u&&(i==="withRouteHints"&&(u.routeHints=["03abc...â†’03def...","03ghi...â†’03jkl..."]),d(u),c(""))},v=i=>new Date(i*1e3).toLocaleString();return e.jsxs("div",{className:`bg-dark-900 rounded-2xl p-6 ${o}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h3",{className:"text-xl font-bold text-dark-100",children:"BOLT #11 Invoice Decoder"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-dark-400 text-sm mb-2",children:"Paste a Lightning Invoice"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:i=>l(i.target.value),placeholder:"lnbc...",className:"flex-1 bg-dark-800 border border-dark-700 rounded-lg px-4 py-2 text-dark-200 font-mono text-sm focus:outline-none focus:border-amber-500"}),e.jsx("button",{onClick:k,className:"px-4 py-2 bg-amber-500 hover:bg-amber-400 text-dark-900 font-medium rounded-lg transition-colors",children:"Decode"})]}),n&&e.jsx("p",{className:"text-red-400 text-sm mt-2",children:n})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("span",{className:"text-dark-500 text-sm",children:"Try sample:"}),e.jsx("button",{onClick:()=>j("simple"),className:"px-2 py-1 text-xs bg-dark-800 hover:bg-dark-700 text-dark-300 rounded transition-colors",children:"Simple"}),e.jsx("button",{onClick:()=>j("withDescription"),className:"px-2 py-1 text-xs bg-dark-800 hover:bg-dark-700 text-dark-300 rounded transition-colors",children:"With Memo"}),e.jsx("button",{onClick:()=>j("withRouteHints"),className:"px-2 py-1 text-xs bg-dark-800 hover:bg-dark-700 text-dark-300 rounded transition-colors",children:"Route Hints"})]}),e.jsx(w,{mode:"wait",children:s&&e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-dark-500 text-xs mb-1",children:"Network"}),e.jsx("div",{className:`text-lg font-bold ${s.network==="mainnet"?"text-amber-400":s.network==="testnet"?"text-blue-400":"text-dark-300"}`,children:s.network})]}),e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-dark-500 text-xs mb-1",children:"Amount"}),e.jsx("div",{className:"text-lg font-bold text-green-400",children:s.amount?`${s.amount.sats.toLocaleString()} sats`:"Any"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-dark-500 text-xs mb-1",children:"Expires In"}),e.jsxs("div",{className:"text-lg font-bold text-dark-200",children:[Math.floor(s.expiry/60)," min"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:`bg-dark-800 rounded-xl p-4 cursor-pointer transition-colors ${t==="paymentHash"?"ring-2 ring-amber-500":"hover:bg-dark-750"}`,onClick:()=>r(t==="paymentHash"?null:"paymentHash"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-purple-400 font-semibold text-sm",children:"Payment Hash (p)"}),e.jsx("span",{className:"text-dark-500 text-xs",children:"32 bytes"})]}),e.jsx("div",{className:"font-mono text-xs text-dark-300 mt-1 break-all",children:s.paymentHash}),t==="paymentHash"&&e.jsx(h.p,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"text-dark-400 text-xs mt-2",children:f.paymentHash.description})]}),s.description&&e.jsxs("div",{className:`bg-dark-800 rounded-xl p-4 cursor-pointer transition-colors ${t==="description"?"ring-2 ring-amber-500":"hover:bg-dark-750"}`,onClick:()=>r(t==="description"?null:"description"),children:[e.jsx("span",{className:"text-blue-400 font-semibold text-sm",children:"Description (d)"}),e.jsx("div",{className:"text-dark-200 mt-1",children:s.description}),t==="description"&&e.jsx(h.p,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"text-dark-400 text-xs mt-2",children:f.description.description})]}),e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4",children:[e.jsx("span",{className:"text-green-400 font-semibold text-sm",children:"Timestamp"}),e.jsxs("div",{className:"text-dark-300 mt-1 text-sm",children:[v(s.timestamp)," (Unix: ",s.timestamp,")"]})]}),e.jsxs("div",{className:`bg-dark-800 rounded-xl p-4 cursor-pointer transition-colors ${t==="features"?"ring-2 ring-amber-500":"hover:bg-dark-750"}`,onClick:()=>r(t==="features"?null:"features"),children:[e.jsx("span",{className:"text-amber-400 font-semibold text-sm",children:"Feature Bits (9)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.features.map((i,m)=>e.jsx("span",{className:"px-2 py-1 bg-dark-700 text-dark-300 text-xs rounded",children:i},m))}),t==="features"&&e.jsx(h.p,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"text-dark-400 text-xs mt-2",children:f.features.description})]}),s.routeHints.length>0&&e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4",children:[e.jsx("span",{className:"text-orange-400 font-semibold text-sm",children:"Route Hints (r)"}),e.jsx("div",{className:"space-y-1 mt-2",children:s.routeHints.map((i,m)=>e.jsx("div",{className:"font-mono text-xs text-dark-300 bg-dark-700 rounded p-2",children:i},m))})]}),e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4",children:[e.jsx("span",{className:"text-red-400 font-semibold text-sm",children:"Signature"}),e.jsx("div",{className:"font-mono text-xs text-dark-300 mt-1 break-all",children:s.signature}),e.jsx("p",{className:"text-dark-500 text-xs mt-2",children:"65-byte signature (recovery flag + r + s) over the invoice data"})]})]})]})}),!s&&!n&&e.jsxs("div",{className:"text-center py-12 text-dark-500",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ§¾"}),e.jsx("p",{children:"Enter a Lightning invoice to decode its contents"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-500/10 border border-blue-500/20 rounded-xl",children:[e.jsx("div",{className:"text-blue-400 text-sm font-semibold mb-1",children:"ðŸ“‹ BOLT #11 Structure"}),e.jsxs("p",{className:"text-dark-300 text-sm",children:["Invoices use Bech32 encoding: ",e.jsx("code",{className:"bg-dark-800 px-1 rounded",children:"ln"})," + network + amount +",e.jsx("code",{className:"bg-dark-800 px-1 rounded",children:"1"})," + tagged fields + signature"]})]})]})}function E(){return e.jsxs(T,{sectionId:21,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BOLT #11: Invoice Encoding"}),e.jsx(S,{className:"mb-8"}),e.jsx("p",{className:"mb-4",children:"BOLT #11 defines the format for Lightning invoices (payment requests). These invoices encode all the information a payer needs to make a payment, including the payment hash, amount, and routing hints."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Invoice Structure"}),e.jsx("p",{className:"mb-4",children:"A BOLT #11 invoice consists of three main parts:"}),e.jsx(x,{title:"Invoice Components",children:e.jsxs("ol",{className:"mt-2 list-decimal list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Human-Readable Part:"})," Prefix + optional amount"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Data Part:"})," Timestamp + tagged fields"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Signature:"})," 65-byte secp256k1 signature"]})]})}),e.jsx(b,{title:"Invoice Example",children:e.jsx("div",{className:"font-mono text-xs bg-dark-800 p-3 rounded break-all",children:"lnbc2500u1pvjluezpp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqdq5xysxxatsyp3k7enxv4jsxqzpuaztrnwngzn3kdzw5hydlzf03qdgm2hdq27cqv3agm2awhz5se903vruatfhq77w3ls4evs3ch9zw97j25emudupq63nyw24cg27h2rspfj9srp"})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Human-Readable Part"}),e.jsxs(x,{title:"Prefix Format",children:["The prefix indicates the network and optionally the amount:",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"lnbc:"})," Bitcoin mainnet"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"lntb:"})," Bitcoin testnet"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"lnbcrt:"})," Bitcoin regtest"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"lnsb:"})," Bitcoin signet"]})]})]}),e.jsxs(x,{title:"Amount Encoding",children:["After the prefix, an optional amount with multiplier:",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"m:"})," milli (0.001 BTC)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"u:"})," micro (0.000001 BTC)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"n:"})," nano (0.000000001 BTC)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"p:"})," pico (0.000000000001 BTC)"]})]}),"Example: lnbc2500u = 2500 microsatoshis = 0.0025 BTC = 250,000 sats"]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Data Part"}),e.jsx("p",{className:"mb-4",children:"The data part uses bech32 encoding and contains:"}),e.jsx(b,{title:"Data Part Structure",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-2",children:"Field"}),e.jsx("th",{className:"text-left py-2",children:"Size"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"Timestamp"}),e.jsx("td",{className:"py-2",children:"35 bits (seconds since 1970)"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"Tagged fields"}),e.jsx("td",{className:"py-2",children:"Variable"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2",children:"Signature"}),e.jsx("td",{className:"py-2",children:"520 bits (104 bech32 chars)"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Tagged Fields"}),e.jsx("p",{className:"mb-4",children:"Tagged fields encode payment details using a type-length-value format:"}),e.jsx(b,{title:"Essential Tagged Fields",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-2",children:"Tag"}),e.jsx("th",{className:"text-left py-2",children:"Name"}),e.jsx("th",{className:"text-left py-2",children:"Description"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"p"}),e.jsx("td",{className:"py-2",children:"payment_hash"}),e.jsx("td",{className:"py-2",children:"32-byte payment hash (required)"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"s"}),e.jsx("td",{className:"py-2",children:"payment_secret"}),e.jsx("td",{className:"py-2",children:"32-byte secret for MPP (required)"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"d"}),e.jsx("td",{className:"py-2",children:"description"}),e.jsx("td",{className:"py-2",children:"Short UTF-8 description"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"h"}),e.jsx("td",{className:"py-2",children:"description_hash"}),e.jsx("td",{className:"py-2",children:"SHA256 of long description"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"x"}),e.jsx("td",{className:"py-2",children:"expiry"}),e.jsx("td",{className:"py-2",children:"Seconds until invoice expires"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"c"}),e.jsx("td",{className:"py-2",children:"min_final_cltv_expiry_delta"}),e.jsx("td",{className:"py-2",children:"Minimum CLTV for final hop"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"n"}),e.jsx("td",{className:"py-2",children:"payee_pubkey"}),e.jsx("td",{className:"py-2",children:"Recipient's node ID (if not in signature)"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"r"}),e.jsx("td",{className:"py-2",children:"routing_hints"}),e.jsx("td",{className:"py-2",children:"Private channel routing info"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 font-mono",children:"f"}),e.jsx("td",{className:"py-2",children:"fallback_address"}),e.jsx("td",{className:"py-2",children:"On-chain fallback address"})]})]})]})}),e.jsxs(g,{type:"info",title:"Required Fields",children:["Every invoice MUST include:",e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Exactly one payment_hash (p)"}),e.jsx("li",{children:"Exactly one payment_secret (s)"}),e.jsx("li",{children:"Either description (d) OR description_hash (h)"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Routing Hints"}),e.jsx("p",{className:"mb-4",children:"For recipients with only private channels, routing hints tell the payer how to reach them:"}),e.jsxs(x,{title:"Routing Hint Structure",children:["Each routing hint contains:",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"pubkey:"})," Node ID of the channel partner"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"short_channel_id:"})," The private channel ID"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"fee_base_msat:"})," Base routing fee"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"fee_proportional_millionths:"})," Proportional fee"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"cltv_expiry_delta:"})," Timelock delta"]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Feature Bits"}),e.jsx("p",{className:"mb-4",children:"Invoices can specify required payment features:"}),e.jsx(q,{title:"Invoice Feature Rules",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[e.jsx("li",{children:'Feature bits follow the "odd = optional, even = required" rule'}),e.jsx("li",{children:"Payers MUST reject invoices with unknown even feature bits"}),e.jsx("li",{children:"Payers MAY ignore unknown odd feature bits"}),e.jsx("li",{children:"Common features: payment_secret, basic_mpp, var_onion_optin"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Signature"}),e.jsx("p",{className:"mb-4",children:"The invoice is signed using the recipient's node key:"}),e.jsxs(x,{title:"Signature Format",children:["The 520-bit signature consists of:",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"r value:"})," 256 bits"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"s value:"})," 256 bits"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"recovery flag:"})," 8 bits (for pubkey recovery)"]})]}),"The public key can be recovered from the signature, so the n field is optional."]}),e.jsx(g,{type:"warning",title:"Invoice Security",children:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Invoices should be single-use (unique payment_hash)"}),e.jsx("li",{children:"Set reasonable expiry times (default: 1 hour)"}),e.jsx("li",{children:"Sanitize description to prevent injection attacks"}),e.jsx("li",{children:"Payment secrets prevent probing attacks"})]})})]})}export{E as default};
