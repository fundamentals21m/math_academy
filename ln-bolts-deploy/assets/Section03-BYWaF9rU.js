import{j as e}from"./vendor-animation-0o8UKZ_1.js";import"./vendor-react-Drj8qL0h.js";import"./vendor-math-p018AHG0.js";import"./index-BbBpzejs.js";import{L as a}from"./LessonLayout-Bq4tucEw.js";import{D as s,E as t,T as i,C as n}from"./Callout-BvJhqaqq.js";import"./vendor-firebase-core-BXWtuYvb.js";import"./quizMap-C4dST7Re.js";function p(){return e.jsxs(a,{sectionId:3,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BOLT #1: Message Structure"}),e.jsx("p",{className:"mb-4",children:"BOLT #1 defines the base protocol for Lightning Network messaging. All communication between nodes follows this message format, which runs on top of the encrypted transport layer defined in BOLT #8."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Message Format"}),e.jsx("p",{className:"mb-4",children:"Every Lightning message consists of a 2-byte type field followed by a variable-length payload. The maximum message size is 65,535 bytes (limited by the encrypted transport)."}),e.jsxs(s,{title:"Message Structure",children:[e.jsx("div",{className:"font-mono text-sm bg-dark-800 p-3 rounded mt-2",children:e.jsx("p",{children:"| type (2 bytes) | payload (variable) |"})}),e.jsx("p",{className:"mt-2",children:"The type field is encoded as a big-endian unsigned 16-bit integer."})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Message Type Ranges"}),e.jsx("p",{className:"mb-4",children:"Message types are organized into ranges based on their function:"}),e.jsx(t,{title:"Message Type Categories",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-2",children:"Type Range"}),e.jsx("th",{className:"text-left py-2",children:"Category"})]})}),e.jsxs("tbody",{className:"space-y-1",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"0-31"}),e.jsx("td",{className:"py-2",children:"Setup & Control"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"32-127"}),e.jsx("td",{className:"py-2",children:"Channel"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"128-255"}),e.jsx("td",{className:"py-2",children:"Commitment"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2 font-mono",children:"256-511"}),e.jsx("td",{className:"py-2",children:"Routing"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 font-mono",children:"32768-65535"}),e.jsx("td",{className:"py-2",children:"Custom/Extension"})]})]})]})}),e.jsxs(i,{title:"The 'It's OK to be Odd' Rule",children:["A fundamental rule in Lightning: messages with ",e.jsx("strong",{children:"odd"})," type numbers are optional and can be safely ignored if not understood. Messages with ",e.jsx("strong",{children:"even"}),"type numbers are mandatory and must be understood—receiving an unknown even-type message should result in connection failure."]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"TLV (Type-Length-Value) Encoding"}),e.jsx("p",{className:"mb-4",children:"Many Lightning messages use TLV streams for extensibility. TLV encoding allows adding new fields to messages without breaking backward compatibility."}),e.jsxs(s,{title:"TLV Record Format",children:[e.jsx("div",{className:"font-mono text-sm bg-dark-800 p-3 rounded mt-2",children:e.jsx("p",{children:"| type (BigSize) | length (BigSize) | value (length bytes) |"})}),e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"type:"})," Identifies the field meaning"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"length:"})," Number of bytes in value"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"value:"})," The actual field data"]})]})]}),e.jsxs(s,{title:"BigSize Encoding",children:["A variable-length unsigned integer encoding:",e.jsxs("ul",{className:"mt-2 list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"0x00-0xFC:"})," 1 byte (value as-is)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"0xFD:"})," 3 bytes total (0xFD + 2-byte value)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"0xFE:"})," 5 bytes total (0xFE + 4-byte value)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"0xFF:"})," 9 bytes total (0xFF + 8-byte value)"]})]})]}),e.jsx(n,{type:"info",title:"TLV Ordering",children:"TLV records MUST appear in strictly increasing order by type. This enables canonical encoding and efficient parsing. Duplicate types are not allowed."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Init Message"}),e.jsxs("p",{className:"mb-4",children:["The first message after the handshake is the ",e.jsx("code",{className:"bg-dark-800 px-1 rounded",children:"init"}),"message (type 16). Both peers send this to establish their capabilities."]}),e.jsx(s,{title:"Init Message Format",children:e.jsxs("div",{className:"font-mono text-sm bg-dark-800 p-3 rounded mt-2 space-y-1",children:[e.jsx("p",{children:"type: 16"}),e.jsx("p",{children:"gflen: 2 bytes (global features length)"}),e.jsx("p",{children:"globalfeatures: gflen bytes"}),e.jsx("p",{children:"flen: 2 bytes (features length)"}),e.jsx("p",{children:"features: flen bytes"}),e.jsx("p",{children:"tlvs: init_tlvs TLV stream"})]})}),e.jsx("p",{className:"mb-4 mt-4",children:"The features field is a bitmask of supported protocol features. Bits are numbered from the least significant bit (bit 0)."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Error and Warning Messages"}),e.jsxs(s,{title:"Error Message (type 17)",children:["Indicates a fatal error condition. Upon receiving an error, the connection or affected channel should be closed.",e.jsxs("div",{className:"font-mono text-sm bg-dark-800 p-3 rounded mt-2 space-y-1",children:[e.jsx("p",{children:"channel_id: 32 bytes (or all zeros for connection-level)"}),e.jsx("p",{children:"len: 2 bytes"}),e.jsx("p",{children:"data: len bytes (human-readable error message)"})]})]}),e.jsxs(s,{title:"Warning Message (type 1)",children:["A non-fatal warning that doesn't require closing the connection or channel. Allows nodes to communicate issues without terminating the relationship.",e.jsxs("div",{className:"font-mono text-sm bg-dark-800 p-3 rounded mt-2 space-y-1",children:[e.jsx("p",{children:"channel_id: 32 bytes"}),e.jsx("p",{children:"len: 2 bytes"}),e.jsx("p",{children:"data: len bytes (human-readable warning)"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Ping and Pong"}),e.jsx("p",{className:"mb-4",children:"The ping/pong mechanism serves two purposes: keeping connections alive and generating cover traffic to improve privacy."}),e.jsxs(t,{title:"Ping Message (type 18)",children:[e.jsxs("div",{className:"font-mono text-sm bg-dark-800 p-3 rounded space-y-1",children:[e.jsx("p",{children:"num_pong_bytes: 2 bytes (requested response size)"}),e.jsx("p",{children:"byteslen: 2 bytes"}),e.jsx("p",{children:"ignored: byteslen bytes (random padding)"})]}),e.jsx("p",{className:"mt-2 text-sm text-dark-300",children:"The sender can request a specific pong size (up to 65531 bytes) for bandwidth probing."})]}),e.jsxs(t,{title:"Pong Message (type 19)",children:[e.jsxs("div",{className:"font-mono text-sm bg-dark-800 p-3 rounded space-y-1",children:[e.jsx("p",{children:"byteslen: 2 bytes"}),e.jsx("p",{children:"ignored: byteslen bytes (random padding)"})]}),e.jsx("p",{className:"mt-2 text-sm text-dark-300",children:"The pong must be exactly num_pong_bytes from the ping (if ≤ 65531)."})]}),e.jsx(n,{type:"warning",title:"Ping Timeout",children:"If a pong is not received within a reasonable time (implementations typically use 30 seconds), the connection should be considered failed and closed."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Data Representation"}),e.jsx("p",{className:"mb-4",children:"All multi-byte values in Lightning messages use big-endian byte order:"}),e.jsx(t,{title:"Integer Encoding Examples",children:e.jsxs("table",{className:"w-full text-sm font-mono",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-2",children:"Type"}),e.jsx("th",{className:"text-left py-2",children:"Value"}),e.jsx("th",{className:"text-left py-2",children:"Bytes (hex)"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"u16"}),e.jsx("td",{className:"py-2",children:"256"}),e.jsx("td",{className:"py-2",children:"01 00"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"u32"}),e.jsx("td",{className:"py-2",children:"16777216"}),e.jsx("td",{className:"py-2",children:"01 00 00 00"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2",children:"u64"}),e.jsx("td",{className:"py-2",children:"1000000"}),e.jsx("td",{className:"py-2",children:"00 00 00 00 00 0f 42 40"})]})]})]})}),e.jsx(n,{type:"info",title:"Signature Format",children:'All signatures in Lightning use the 64-byte compact format (r, s) without the recovery byte. Signatures must be "low-S" normalized per BIP-0062.'})]})}export{p as default};
