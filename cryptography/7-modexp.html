<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modular Exponentiation - Magic Internet Math</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <nav>
    <div class="nav-content">
      <a href="index.html" class="logo">Magic Internet Math</a>
      <ul class="nav-links">
        <li><a href="../index.html">All Courses</a></li>
        
        <li><a href="theorems.html">Theorems</a></li>
        <li><a href="interactive.html">Interactive</a></li>
        <li><a href="12-quiz.html">Quiz</a></li>
      </ul>
    </div>
  </nav>

  <main class="container">
    <div class="progress-bar">
      <div class="progress-fill" style="width: 58%"></div>
    </div>

    <h1>Modular Exponentiation</h1>

    <p>Computing large powers modulo n is at the heart of modern cryptography. The <strong>square-and-multiply</strong> algorithm makes this fast even for huge exponents.</p>

    <div class="callout callout-info">
      <strong>The Problem:</strong> Computing 7^1000000 mod 13 naively would require a million multiplications. Square-and-multiply does it in about 20!
    </div>

    <h2>Square-and-Multiply Algorithm</h2>

    <p>The key insight: we can write any exponent in binary and use the fact that:</p>

    <div class="math-block">
      a^(2k) = (a^k)² and a^(2k+1) = a × (a^k)²
    </div>

    <div class="canvas-container">
      <canvas id="modExpCanvas" width="500" height="150"></canvas>

      <div class="controls" style="justify-content: flex-start;">
        <div class="input-group">
          <label for="expBase">Base:</label>
          <input type="number" id="expBase" value="3" min="1">
        </div>
        <div class="input-group">
          <label for="expExp">Exp:</label>
          <input type="number" id="expExp" value="13" min="0">
        </div>
        <div class="input-group">
          <label for="expMod">Mod:</label>
          <input type="number" id="expMod" value="7" min="2">
        </div>
        <button class="btn btn-primary btn-small" onclick="calculateModExp()">Calculate</button>
      </div>
    </div>

    <div id="modExpSteps" class="steps-container">
      <span class="muted">Enter values to see the algorithm in action...</span>
    </div>

    <h2>How It Works</h2>

    <p>Let's trace through 3^13 mod 7 step by step:</p>

    <div class="card">
      <h3>Example: 3^13 mod 7</h3>
      <ol style="margin-left: 1.5rem; color: var(--text-muted); line-height: 2;">
        <li>13 in binary = 1101</li>
        <li>Start with result = 1, base = 3</li>
        <li>Bit 0 = 1: result = 1 × 3 = 3, square base: 3² = 9 ≡ 2</li>
        <li>Bit 1 = 0: skip multiply, square base: 2² = 4</li>
        <li>Bit 2 = 1: result = 3 × 4 = 12 ≡ 5, square base: 4² = 16 ≡ 2</li>
        <li>Bit 3 = 1: result = 5 × 2 = 10 ≡ 3</li>
        <li>Final: 3^13 mod 7 = 3</li>
      </ol>
    </div>

    <h2>Performance Comparison</h2>

    <div class="demo-section">
      <h3>Naive vs Square-and-Multiply</h3>

      <div class="controls" style="justify-content: flex-start;">
        <div class="input-group">
          <label for="perfBase">Base:</label>
          <input type="number" id="perfBase" value="7" min="1">
        </div>
        <div class="input-group">
          <label for="perfExp">Exp:</label>
          <input type="number" id="perfExp" value="100" min="0">
        </div>
        <div class="input-group">
          <label for="perfMod">Mod:</label>
          <input type="number" id="perfMod" value="13" min="2">
        </div>
        <button class="btn btn-primary btn-small" onclick="comparePerformance()">Compare</button>
      </div>

      <div class="card-grid" style="margin-top: 1rem;">
        <div class="card">
          <h3>Naive Method</h3>
          <div id="naiveResult">
            <span class="muted">Click "Compare" to see...</span>
          </div>
        </div>
        <div class="card">
          <h3>Square-and-Multiply</h3>
          <div id="fastResult">
            <span class="muted">Click "Compare" to see...</span>
          </div>
        </div>
      </div>
    </div>

    <h2>Why This Matters</h2>

    <div class="callout callout-success">
      <strong>In RSA:</strong> Encryption computes m^e mod n and decryption computes c^d mod n. With 2048-bit keys, the exponents have about 600 digits! Square-and-multiply reduces billions of operations to a few thousand.
    </div>

    <div class="card">
      <h3>Complexity Analysis</h3>
      <table class="data-table">
        <thead>
          <tr>
            <th>Method</th>
            <th>Multiplications</th>
            <th>For exp = 1,000,000</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Naive</td>
            <td>exp</td>
            <td>1,000,000</td>
          </tr>
          <tr style="background: rgba(34, 197, 94, 0.1);">
            <td>Square-and-Multiply</td>
            <td>≤ 2 × log₂(exp)</td>
            <td>≤ 40</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="page-nav">
      <a href="6-euler.html" class="btn btn-secondary">Previous: Euler's Totient</a>
      <a href="8-discretelog.html" class="btn btn-primary">Next: Discrete Logarithms</a>
    </div>
  </main>

  <script src="scripts/main.js"></script>
  <script src="scripts/modExp.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      ModExpVisualizer.init('modExpCanvas');
      calculateModExp();
    });

    function calculateModExp() {
      const base = parseInt(document.getElementById('expBase').value) || 1;
      const exp = parseInt(document.getElementById('expExp').value) || 0;
      const mod = parseInt(document.getElementById('expMod').value) || 2;

      const result = ModExpDemo.calculate(base, exp, mod);

      ModExpVisualizer.visualize(result);

      const container = document.getElementById('modExpSteps');
      container.innerHTML = '';

      result.steps.forEach((step, i) => {
        const div = document.createElement('div');
        const isResult = step.type === 'result';
        div.className = 'step' + (isResult ? ' highlight' : '');

        const numSpan = document.createElement('span');
        numSpan.className = 'step-number';

        if (step.type === 'multiply') numSpan.textContent = '×';
        else if (step.type === 'square') numSpan.textContent = '²';
        else if (step.type === 'skip') numSpan.textContent = '−';
        else numSpan.textContent = i + 1;

        const contentSpan = document.createElement('span');
        contentSpan.innerHTML = `<strong>${step.text}</strong><br><span style="color: var(--text-muted); font-size: 0.9em;">${step.detail}</span>`;
        if (isResult) contentSpan.querySelector('strong').className = 'step-result';

        div.appendChild(numSpan);
        div.appendChild(contentSpan);
        container.appendChild(div);
      });
    }

    function comparePerformance() {
      const base = parseInt(document.getElementById('perfBase').value) || 1;
      const exp = parseInt(document.getElementById('perfExp').value) || 0;
      const mod = parseInt(document.getElementById('perfMod').value) || 2;

      // Naive
      const naiveResult = ModExpDemo.calculateNaive(base, exp, mod, 50);
      const naiveDiv = document.getElementById('naiveResult');

      if (naiveResult.truncated) {
        naiveDiv.innerHTML = `
          <p style="color: var(--warning);">Would need ${naiveResult.totalSteps} multiplications!</p>
          <p class="muted">Too many to show...</p>
        `;
      } else {
        naiveDiv.innerHTML = `
          <p class="success">Result: ${naiveResult.result}</p>
          <p class="muted">${naiveResult.steps.length} multiplications</p>
        `;
      }

      // Fast
      const fastResult = ModExpDemo.calculate(base, exp, mod);
      const fastDiv = document.getElementById('fastResult');

      const multiplies = fastResult.steps.filter(s => s.type === 'multiply').length;
      const squares = fastResult.steps.filter(s => s.type === 'square').length;

      fastDiv.innerHTML = `
        <p class="success">Result: ${fastResult.result}</p>
        <p class="muted">${multiplies} multiplications + ${squares} squarings = ${multiplies + squares} operations</p>
        <p style="color: var(--secondary);">Binary: ${fastResult.binary} (${fastResult.binary.length} bits)</p>
      `;
    }
  </script>
<script src="scripts/gamification.js"></script>
<script src="scripts/sidebar.js"></script>
</body>
</html>
