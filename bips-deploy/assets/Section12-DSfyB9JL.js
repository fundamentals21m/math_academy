import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as t,C as s,D as a,E as i}from"./Callout-Bm0ChKkk.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(t,{sectionId:12,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Eliminating Signature Malleability"}),e.jsx("p",{className:"mb-4",children:"BIP-66 requires all ECDSA signatures in Bitcoin to use strict DER encoding. This soft fork eliminated a source of transaction malleability and simplified signature validation across implementations."}),e.jsx(s,{type:"info",title:"Activated: July 2015",children:e.jsx("p",{children:"BIP-66 activated at block 363,725 via IsSuperMajority, requiring block version 3 or higher. It was the third major soft fork using this activation mechanism."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Malleability Problem"}),e.jsx("p",{className:"mb-4",children:"Before BIP-66, ECDSA signature encoding was loosely enforced. OpenSSL (which Bitcoin Core originally used) accepted various non-canonical encodings:"}),e.jsx(a,{title:"DER Encoding",children:e.jsx("p",{children:"Distinguished Encoding Rules (DER) is a strict binary encoding for ASN.1 data structures. For ECDSA signatures, it specifies exactly how the r and s values should be serialized with no ambiguity."})}),e.jsx("p",{className:"mb-4",children:"The problems with loose encoding:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mb-6 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Multiple encodings:"})," The same signature could be encoded differently"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Transaction ID changes:"})," Re-encoding changed the txid"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Malleability:"})," Third parties could modify transactions in flight"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Implementation bugs:"})," Different libraries behaved differently"]})]}),e.jsx(i,{title:"Signature Malleability Attack",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsxs("p",{children:["1. Alice broadcasts a transaction with txid ",e.jsx("code",{className:"text-amber-400",children:"abc123..."})]}),e.jsx("p",{children:"2. Attacker sees unconfirmed tx, re-encodes signature (same cryptographic validity)"}),e.jsxs("p",{children:["3. New encoding has different txid ",e.jsx("code",{className:"text-amber-400",children:"def456..."})]}),e.jsx("p",{children:`4. If attacker's version confirms, Alice's wallet shows "failed" for abc123`}),e.jsx("p",{children:"5. Alice might think payment failed and resend—double spending risk"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Strict DER Format"}),e.jsx("p",{className:"mb-4",children:"A valid DER-encoded ECDSA signature has this exact structure:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6 overflow-x-auto",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# DER Signature Structure"}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"text-purple-400",children:"0x30"})," ",e.jsx("span",{className:"text-dark-400",children:"[total_length]"})]}),e.jsxs("p",{className:"mb-1 ml-4",children:[e.jsx("span",{className:"text-blue-400",children:"0x02"})," ",e.jsx("span",{className:"text-dark-400",children:"[r_length]"})," ",e.jsx("span",{className:"text-amber-400",children:"[r_value]"})]}),e.jsxs("p",{className:"ml-4",children:[e.jsx("span",{className:"text-blue-400",children:"0x02"})," ",e.jsx("span",{className:"text-dark-400",children:"[s_length]"})," ",e.jsx("span",{className:"text-emerald-400",children:"[s_value]"})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-3",children:"0x30 = SEQUENCE tag, 0x02 = INTEGER tag"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"BIP-66 Rules"}),e.jsx("p",{className:"mb-4",children:"BIP-66 enforces these specific rules for all signatures:"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("div",{className:"bg-dark-800 rounded-lg p-4 border-l-4 border-amber-500",children:e.jsxs("p",{className:"text-dark-300",children:[e.jsx("strong",{children:"1."})," Signature must be a properly-formed DER encoding"]})}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-4 border-l-4 border-amber-500",children:e.jsxs("p",{className:"text-dark-300",children:[e.jsx("strong",{children:"2."})," r and s must be positive integers (no leading 0x00 unless high bit set)"]})}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-4 border-l-4 border-amber-500",children:e.jsxs("p",{className:"text-dark-300",children:[e.jsx("strong",{children:"3."})," r and s must use minimum-length encoding"]})}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-4 border-l-4 border-amber-500",children:e.jsxs("p",{className:"text-dark-300",children:[e.jsx("strong",{children:"4."})," Length bytes must exactly match actual content length"]})}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-4 border-l-4 border-amber-500",children:e.jsxs("p",{className:"text-dark-300",children:[e.jsx("strong",{children:"5."})," No extra bytes after the signature data"]})})]}),e.jsx(i,{title:"Valid vs Invalid Encoding",children:e.jsxs("div",{className:"space-y-4 font-mono text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-emerald-400 mb-1",children:"✓ Valid: Minimal encoding"}),e.jsx("p",{className:"text-dark-400",children:"30 44 02 20 [32-byte r] 02 20 [32-byte s]"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-rose-400 mb-1",children:"✗ Invalid: Unnecessary leading zero"}),e.jsx("p",{className:"text-dark-400",children:"30 45 02 21 00 [32-byte r] 02 20 [32-byte s]"}),e.jsx("p",{className:"text-xs text-dark-500",children:"(Extra 0x00 when r doesn't have high bit set)"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-rose-400 mb-1",children:"✗ Invalid: Wrong length byte"}),e.jsx("p",{className:"text-dark-400",children:"30 45 02 20 [32-byte r] 02 20 [32-byte s]"}),e.jsx("p",{className:"text-xs text-dark-500",children:"(Total length says 69, actual content is 68)"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The OpenSSL Complexity"}),e.jsx(s,{type:"warning",title:"Implementation Challenges",children:e.jsx("p",{children:"Bitcoin originally used OpenSSL for signature validation. OpenSSL was very permissive, accepting encodings that weren't strictly DER. After BIP-66, Bitcoin moved to libsecp256k1, a custom library with stricter, more predictable behavior. This also improved performance significantly."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Low-S Rule"}),e.jsx("p",{className:"mb-4",children:"BIP-66 addressed encoding, but there's another malleability vector: ECDSA signatures can be negated. For any valid signature (r, s), the signature (r, n-s) is also valid."}),e.jsx("p",{className:"mb-4",children:'Bitcoin Core also enforces a "low-S" rule as a standardness policy (not consensus):'}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# Low-S requirement"}),e.jsx("p",{className:"text-amber-400",children:"s ≤ n/2"}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"where n is the secp256k1 curve order"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"SegWit Connection"}),e.jsx("p",{className:"mb-4",children:"BIP-66 fixed encoding malleability but not all malleability. Full malleability fixes came with SegWit (BIP-141), which moves signatures out of the txid calculation entirely."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"BIP-66 Fixes"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"✓ Signature encoding variations"}),e.jsx("li",{children:"✓ Implementation inconsistencies"}),e.jsx("li",{children:"✗ scriptSig malleability (push ops)"}),e.jsx("li",{children:"✗ Third-party signature modification"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"SegWit Fixes"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"✓ All scriptSig malleability"}),e.jsx("li",{children:"✓ Third-party modifications"}),e.jsx("li",{children:"✓ Enables payment channels"}),e.jsx("li",{children:"✓ Clean transaction IDs"})]})]})]}),e.jsx(s,{type:"success",title:"Incremental Progress",children:e.jsx("p",{children:"BIP-66 exemplifies Bitcoin's conservative upgrade approach. Rather than attempting a complete malleability fix, it addressed a specific vector with minimal risk. SegWit later provided the complete solution, building on the cleaner signature handling that BIP-66 established."})})]})}export{p as default};
