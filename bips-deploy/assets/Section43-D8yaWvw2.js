import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as s,C as t,D as i,E as n}from"./Callout-Bm0ChKkk.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(s,{sectionId:43,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-370: PSBT Version 2"}),e.jsx("p",{className:"mb-4",children:"BIP-370 introduces PSBT version 2, a significant evolution of the Partially Signed Bitcoin Transaction format. It enables more flexible transaction construction workflows and better supports interactive protocols like coinjoin and payjoin."}),e.jsx(t,{type:"info",title:"Evolution of PSBT",children:e.jsx("p",{children:"While PSBT v0 (BIP-174) was revolutionary, it assumed a fixed transaction structure from the start. PSBT v2 allows inputs and outputs to be added incrementally, enabling new collaborative transaction-building protocols."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Key Differences from v0"}),e.jsx(i,{title:"PSBT Version 2",children:e.jsx("p",{children:"PSBT v2 moves the unsigned transaction into per-input and per-output fields, allowing the transaction to be modified during construction. The global unsigned transaction field becomes optional."})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6 mt-4",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-dark-700/50",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"PSBT v0"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Global unsigned TX required"}),e.jsx("li",{children:"Transaction structure fixed upfront"}),e.jsx("li",{children:"Inputs/outputs cannot be added later"}),e.jsx("li",{children:"Linear construction flow"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"PSBT v2"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"No global unsigned TX"}),e.jsx("li",{children:"Transaction built from fields"}),e.jsx("li",{children:"Inputs/outputs can be added anytime"}),e.jsx("li",{children:"Flexible construction flow"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"New Global Fields"}),e.jsx("p",{className:"mb-4",children:"PSBT v2 introduces new global fields for transaction-level data:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Field"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Key Type"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Description"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"PSBT_GLOBAL_TX_VERSION"}),e.jsx("td",{className:"font-mono",children:"0x02"}),e.jsx("td",{children:"Transaction version (required)"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"PSBT_GLOBAL_FALLBACK_LOCKTIME"}),e.jsx("td",{className:"font-mono",children:"0x03"}),e.jsx("td",{children:"Default locktime"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"PSBT_GLOBAL_INPUT_COUNT"}),e.jsx("td",{className:"font-mono",children:"0x04"}),e.jsx("td",{children:"Number of inputs"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"PSBT_GLOBAL_OUTPUT_COUNT"}),e.jsx("td",{className:"font-mono",children:"0x05"}),e.jsx("td",{children:"Number of outputs"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"New Input Fields"}),e.jsx("p",{className:"mb-4",children:"Each input now contains the data previously in the unsigned transaction:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Per-input fields"}),e.jsx("p",{className:"text-amber-400",children:"PSBT_IN_PREVIOUS_TXID (0x0e)"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"32-byte txid of the UTXO being spent"}),e.jsx("p",{className:"text-amber-400 mt-2",children:"PSBT_IN_OUTPUT_INDEX (0x0f)"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"Output index within the previous transaction"}),e.jsx("p",{className:"text-amber-400 mt-2",children:"PSBT_IN_SEQUENCE (0x10)"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"Sequence number for this input"}),e.jsx("p",{className:"text-amber-400 mt-2",children:"PSBT_IN_REQUIRED_TIME_LOCKTIME (0x11)"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"Minimum locktime (time-based)"}),e.jsx("p",{className:"text-amber-400 mt-2",children:"PSBT_IN_REQUIRED_HEIGHT_LOCKTIME (0x12)"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"Minimum locktime (height-based)"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"New Output Fields"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Per-output fields"}),e.jsx("p",{className:"text-amber-400",children:"PSBT_OUT_AMOUNT (0x03)"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"Output value in satoshis"}),e.jsx("p",{className:"text-amber-400 mt-2",children:"PSBT_OUT_SCRIPT (0x04)"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"ScriptPubKey for this output"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Construction Flow"}),e.jsx(n,{title:"PSBT v2 Construction",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"A flexible multi-party transaction:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Creator:"})," Initialize empty PSBT v2 with version fields"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Party A:"})," Add their input(s) with prevout data"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Party B:"})," Add their input(s) and output(s)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Coordinator:"})," Add change output, finalize structure"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"All parties:"})," Sign their respective inputs"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Finalizer:"})," Combine signatures, extract TX"]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Locktime Handling"}),e.jsx("p",{className:"mb-4",children:"PSBT v2 improves locktime handling with explicit per-input requirements:"}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:[e.jsx("p",{className:"text-dark-300 mb-3",children:"Each input can specify minimum required locktimes. The final transaction locktime must satisfy all inputs:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-400",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-amber-400",children:"REQUIRED_TIME_LOCKTIME"}),": TX locktime must be ≥ this value (if time-based)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-amber-400",children:"REQUIRED_HEIGHT_LOCKTIME"}),": TX locktime must be ≥ this value (if height-based)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-amber-400",children:"FALLBACK_LOCKTIME"}),": Used if no inputs specify requirements"]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Use Cases"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-1",children:"Coinjoin"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Multiple parties can independently add their inputs and outputs. No coordinator needs to know the full transaction upfront."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-1",children:"Payjoin (BIP-78)"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Receiver can add inputs to sender's transaction, breaking common input ownership heuristics."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-1",children:"Interactive Protocols"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Any protocol where transaction structure isn't known until all parties contribute."})]})]}),e.jsx(t,{type:"warning",title:"Conversion Between Versions",children:e.jsx("p",{children:"PSBT v0 can be converted to v2 by extracting the unsigned transaction into the new fields. Converting v2 to v0 requires the transaction structure to be complete (all inputs and outputs finalized)."})}),e.jsx(t,{type:"success",title:"Future-Ready Design",children:e.jsx("p",{children:"PSBT v2's flexible design anticipates future protocols requiring collaborative transaction construction. It maintains backward compatibility while enabling new privacy-enhancing and scaling technologies."})})]})}export{p as default};
