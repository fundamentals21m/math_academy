import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-CsKt80eB.js";import{L as r,C as s,D as a,E as t}from"./Callout-DTLGvo9K.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(r,{sectionId:44,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-371: Taproot Fields for PSBT"}),e.jsx("p",{className:"mb-4",children:"BIP-371 extends the PSBT format with new fields specifically for Taproot transactions. These additions enable hardware wallets and signing devices to properly construct and verify Taproot signatures."}),e.jsx(s,{type:"info",title:"Companion to Taproot",children:e.jsx("p",{children:"BIP-371 was developed alongside the Taproot soft fork (BIPs 340-342). It ensures that the PSBT ecosystem can fully support Taproot's key-path and script-path spending."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why New Fields?"}),e.jsx("p",{className:"mb-4",children:"Taproot introduces concepts that don't map to existing PSBT fields:"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-dark-700/50",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"Schnorr Signatures"}),e.jsx("p",{className:"text-sm text-dark-300",children:"64 bytes instead of ~72 bytes, no sighash type appended in key-path spending."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-dark-700/50",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"Tweaked Keys"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Internal keys are tweaked with the Merkle root. Signers need the internal key."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-dark-700/50",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"Script Trees"}),e.jsx("p",{className:"text-sm text-dark-300",children:"MAST structures require control blocks and leaf scripts for spending."})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"New Input Fields"}),e.jsx(a,{title:"Taproot Input Fields",children:e.jsx("p",{children:"Fields for providing Taproot-specific data needed to construct valid signatures and witnesses for spending Taproot outputs."})}),e.jsx("div",{className:"overflow-x-auto mt-4",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Field"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Type"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Description"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-xs text-amber-400",children:"PSBT_IN_TAP_KEY_SIG"}),e.jsx("td",{className:"font-mono",children:"0x13"}),e.jsx("td",{children:"Key-path Schnorr signature"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-xs text-amber-400",children:"PSBT_IN_TAP_SCRIPT_SIG"}),e.jsx("td",{className:"font-mono",children:"0x14"}),e.jsx("td",{children:"Script-path signature for leaf"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-xs text-amber-400",children:"PSBT_IN_TAP_LEAF_SCRIPT"}),e.jsx("td",{className:"font-mono",children:"0x15"}),e.jsx("td",{children:"Leaf script with version"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-xs text-amber-400",children:"PSBT_IN_TAP_BIP32_DERIVATION"}),e.jsx("td",{className:"font-mono",children:"0x16"}),e.jsx("td",{children:"BIP32 paths for Taproot keys"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-mono text-xs text-amber-400",children:"PSBT_IN_TAP_INTERNAL_KEY"}),e.jsx("td",{className:"font-mono",children:"0x17"}),e.jsx("td",{children:"Internal (untweaked) key"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-xs text-amber-400",children:"PSBT_IN_TAP_MERKLE_ROOT"}),e.jsx("td",{className:"font-mono",children:"0x18"}),e.jsx("td",{children:"Script tree Merkle root"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"New Output Fields"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Field"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Type"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Description"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-xs text-amber-400",children:"PSBT_OUT_TAP_INTERNAL_KEY"}),e.jsx("td",{className:"font-mono",children:"0x05"}),e.jsx("td",{children:"Internal key for output"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-xs text-amber-400",children:"PSBT_OUT_TAP_TREE"}),e.jsx("td",{className:"font-mono",children:"0x06"}),e.jsx("td",{children:"Serialized script tree"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-mono text-xs text-amber-400",children:"PSBT_OUT_TAP_BIP32_DERIVATION"}),e.jsx("td",{className:"font-mono",children:"0x07"}),e.jsx("td",{children:"BIP32 paths for output keys"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Key-Path Spending"}),e.jsx(t,{title:"Key-Path PSBT Flow",children:e.jsxs("div",{className:"space-y-3 font-mono text-xs",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# Creator adds input with Taproot UTXO:"}),e.jsx("p",{className:"text-dark-300",children:"PSBT_IN_WITNESS_UTXO: (P2TR output)"}),e.jsx("p",{className:"text-dark-300",children:"PSBT_IN_TAP_INTERNAL_KEY: <32-byte internal key>"}),e.jsx("p",{className:"text-dark-300",children:"PSBT_IN_TAP_MERKLE_ROOT: (empty for key-only)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# Signer produces signature:"}),e.jsx("p",{className:"text-emerald-400",children:"PSBT_IN_TAP_KEY_SIG: <64-byte Schnorr sig>"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# Final witness:"}),e.jsx("p",{className:"text-dark-300",children:"<signature>"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Script-Path Spending"}),e.jsx(t,{title:"Script-Path PSBT Flow",children:e.jsxs("div",{className:"space-y-3 font-mono text-xs",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# Input with script tree info:"}),e.jsx("p",{className:"text-dark-300",children:"PSBT_IN_TAP_INTERNAL_KEY: <internal key>"}),e.jsx("p",{className:"text-dark-300",children:"PSBT_IN_TAP_LEAF_SCRIPT: <script, leaf version>"}),e.jsx("p",{className:"text-dark-300",children:"PSBT_IN_TAP_MERKLE_ROOT: <tree root>"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# Signer produces leaf signature:"}),e.jsx("p",{className:"text-emerald-400",children:"PSBT_IN_TAP_SCRIPT_SIG:"}),e.jsx("p",{className:"text-emerald-400 ml-4",children:"key: <xonly_pubkey || leaf_hash>"}),e.jsx("p",{className:"text-emerald-400 ml-4",children:"value: <signature>"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# Final witness:"}),e.jsx("p",{className:"text-dark-300",children:"<signature(s)> <script> <control block>"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"BIP32 Derivation"}),e.jsx("p",{className:"mb-4",children:"Taproot uses a modified BIP32 derivation field format to support leaf hashes:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# PSBT_IN_TAP_BIP32_DERIVATION format:"}),e.jsx("p",{className:"text-dark-300",children:"Key: <xonly_pubkey>"}),e.jsx("p",{className:"text-dark-300 mt-2",children:"Value:"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"<number of leaf hashes>"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"<leaf hash 1> ... <leaf hash n>"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"<fingerprint>"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"<derivation path>"})]}),e.jsx(s,{type:"warning",title:"X-Only Public Keys",children:e.jsx("p",{children:"Taproot uses x-only public keys (32 bytes) instead of compressed keys (33 bytes). The y-coordinate parity is implicitly even or determined during signing. BIP-371 fields consistently use x-only format."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Script Tree Serialization"}),e.jsxs("p",{className:"mb-4",children:["The ",e.jsx("code",{className:"text-amber-400",children:"PSBT_OUT_TAP_TREE"})," field encodes the complete script tree:"]}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"Tree serialization format:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Depth:"})," 1 byte (0-128)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leaf version:"})," 1 byte"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Script length:"})," CompactSize"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Script:"})," Variable length"]})]}),e.jsx("p",{className:"text-dark-500 text-sm mt-3",children:"Repeated for each leaf in depth-first left-to-right order"})]}),e.jsx(s,{type:"success",title:"Hardware Wallet Support",children:e.jsx("p",{children:"BIP-371 enables hardware wallets to safely sign Taproot transactions. The internal key and Merkle root allow devices to verify the output address matches expectations before signing."})})]})}export{p as default};
