import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-CsKt80eB.js";import{L as t,C as s,D as r,E as l}from"./Callout-DTLGvo9K.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(t,{sectionId:69,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-157: Client Side Block Filtering"}),e.jsx("p",{className:"mb-4",children:"BIP-157 defines a protocol for lightweight clients to download compact block filters from full nodes. Unlike BIP-37 Bloom filters, the filtering happens client-side, preserving privacy while enabling efficient light client operation."}),e.jsx(s,{type:"info",title:"BIP-37 Replacement",children:e.jsx("p",{children:"BIP-157/158 are the recommended replacement for deprecated BIP-37 Bloom filters. The client downloads filters and checks them locally—no privacy leak to peers."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Key Insight"}),e.jsx("p",{className:"mb-4",children:"The fundamental difference from BIP-37:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"BIP-37 (Server-Side)"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Client sends filter to server"}),e.jsx("li",{children:"Server filters data"}),e.jsx("li",{children:"Server learns client's addresses"}),e.jsx("li",{children:"Privacy leak!"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"BIP-157 (Client-Side)"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Server creates deterministic filter"}),e.jsx("li",{children:"Client downloads filter"}),e.jsx("li",{children:"Client checks locally"}),e.jsx("li",{children:"Privacy preserved!"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Protocol Messages"}),e.jsx(r,{title:"BIP-157 Messages",children:e.jsx("p",{children:"Messages for requesting and delivering compact block filters and filter headers."})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Message"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Purpose"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"getcfilters"}),e.jsx("td",{children:"Request filters for block range"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"cfilter"}),e.jsx("td",{children:"Send a compact filter"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"getcfheaders"}),e.jsx("td",{children:"Request filter headers"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"cfheaders"}),e.jsx("td",{children:"Send filter headers"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"getcfcheckpt"}),e.jsx("td",{children:"Request filter checkpoints"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Filter Chain"}),e.jsx("p",{className:"mb-4",children:"Filters form a hash chain for verification:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Filter header chain:"}),e.jsx("p",{className:"text-dark-300",children:"filter_header[n] = hash(filter[n] || filter_header[n-1])"}),e.jsx("p",{className:"text-dark-400 mt-3 mb-2",children:"# Verification:"}),e.jsx("p",{className:"text-dark-300",children:"1. Get filter headers from multiple peers"}),e.jsx("p",{className:"text-dark-300",children:"2. Compare to detect dishonest peers"}),e.jsx("p",{className:"text-dark-300",children:"3. Download filters and verify against headers"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Client Workflow"}),e.jsx(l,{title:"Light Client Operation",children:e.jsxs("div",{className:"space-y-3 font-mono text-xs",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 1. Sync filter headers:"}),e.jsx("p",{className:"text-dark-300",children:"client → peer: getcfheaders(start, stop)"}),e.jsx("p",{className:"text-dark-300",children:"peer → client: cfheaders(...)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 2. For each new block, get filter:"}),e.jsx("p",{className:"text-dark-300",children:"client → peer: getcfilters(start, stop)"}),e.jsx("p",{className:"text-dark-300",children:"peer → client: cfilter(block_hash, filter)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 3. Check filter against wallet:"}),e.jsx("p",{className:"text-dark-300",children:"if filter.match(my_addresses):"}),e.jsx("p",{className:"text-amber-400 ml-4",children:"download full block for details"}),e.jsx("p",{className:"text-dark-300",children:"else:"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"skip block (no relevant txs)"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Filter Types"}),e.jsx("p",{className:"mb-4",children:"BIP-157 defines filter types for different use cases:"}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:[e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Basic (0x00):"})," All scriptPubKeys in outputs + prevout scriptPubKeys being spent"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Future types:"})," Can be defined for different filtering needs"]})]}),e.jsx("p",{className:"text-dark-500 text-sm mt-3",children:"Basic filter is sufficient for most wallet use cases"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Checkpoints"}),e.jsx("p",{className:"mb-4",children:"Checkpoints enable efficient initial sync:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Checkpoint interval: 1000 blocks"}),e.jsx("p",{className:"text-dark-300",children:"getcfcheckpt → filter_headers at heights 999, 1999, 2999..."}),e.jsx("p",{className:"text-dark-400 mt-3 mb-2",children:"# Benefit:"}),e.jsx("p",{className:"text-dark-300",children:"- Quick sync to recent history"}),e.jsx("p",{className:"text-dark-300",children:"- Verify intermediate headers against checkpoints"}),e.jsx("p",{className:"text-dark-300",children:"- Detect dishonest peers early"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Bandwidth Analysis"}),e.jsx(s,{type:"info",title:"Filter Sizes",children:e.jsx("p",{children:"Basic filters are typically 10-20 KB per block (vs 1-4 MB for full blocks). A full sync of all filters uses ~10-20 GB, but clients typically only need recent filters for ongoing operation."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Service Bit"}),e.jsx("p",{className:"mb-4",children:"Nodes advertise filter support:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("div",{className:"font-mono text-sm text-dark-300",children:[e.jsx("p",{className:"text-amber-400",children:"NODE_COMPACT_FILTERS = 1 << 6"}),e.jsx("p",{className:"text-dark-500 mt-2",children:"Nodes with this bit serve compact block filters via BIP-157"})]})}),e.jsx(s,{type:"success",title:"Privacy-Preserving Light Clients",children:e.jsx("p",{children:"BIP-157 enables truly private light clients. Unlike BIP-37, the server never learns which addresses the client cares about. Combined with BIP-158's efficient filter construction, it's the foundation for next-generation lightweight wallets."})})]})}export{p as default};
