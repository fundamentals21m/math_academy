import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-CsKt80eB.js";import{L as a,C as s,D as t,E as i}from"./Callout-DTLGvo9K.js";import{M as n}from"./MathBlock-fCav0pL3.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function j(){return e.jsxs(a,{sectionId:16,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Segregated Witness: The Consensus Layer"}),e.jsxs("p",{className:"mb-4",children:["BIP-141 defines ",e.jsx("strong",{children:"Segregated Witness"})," (SegWit)—one of the most significant upgrades in Bitcoin's history. By separating signature data from transaction identifiers, SegWit fixed transaction malleability, increased capacity, and enabled Layer 2 solutions like Lightning Network."]}),e.jsx(s,{type:"info",title:"Activated: August 24, 2017",children:e.jsx("p",{children:"SegWit activated at block 481,824 after a contentious 9-month signaling period. It was a soft fork that introduced new transaction types while remaining backward compatible with old nodes."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Malleability Problem"}),e.jsx("p",{className:"mb-4",children:"Before SegWit, transaction IDs (txids) were computed from the entire transaction, including signatures. This created a fundamental problem:"}),e.jsx(t,{title:"Transaction Malleability",children:e.jsx("p",{children:"The ability to change a transaction's ID without invalidating it. Since signatures could be re-encoded or modified in ways that preserve validity, third parties could change a transaction's txid while it was unconfirmed."})}),e.jsx(i,{title:"Why Malleability Breaks Things",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{children:"Malleability prevented trustless protocols:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Payment channels:"})," Can't pre-sign transactions spending from an unconfirmed funding tx if its txid might change"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Atomic swaps:"})," Hash-locked contracts break if referenced txids change"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Exchange tracking:"})," Deposit tracking fails if txids are modified"]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The SegWit Solution"}),e.jsxs("p",{className:"mb-4",children:["SegWit's key insight: ",e.jsx("strong",{children:"move signatures outside the txid calculation"}),"."]}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-5 mb-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-rose-400 font-bold mb-3",children:"Legacy Transaction"}),e.jsxs("div",{className:"font-mono text-xs space-y-1 text-dark-300",children:[e.jsx("p",{children:"┌─────────────────┐"}),e.jsx("p",{children:"│ Version         │"}),e.jsx("p",{children:"│ Inputs          │"}),e.jsx("p",{children:"│ ├─ prevout      │"}),e.jsxs("p",{children:["│ └─ ",e.jsx("span",{className:"text-rose-400",children:"scriptSig"}),"    │ ← Includes sigs"]}),e.jsx("p",{children:"│ Outputs         │"}),e.jsx("p",{children:"│ Locktime        │"}),e.jsx("p",{children:"└─────────────────┘"}),e.jsx("p",{className:"mt-2",children:"txid = hash(all of above)"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-3",children:"SegWit Transaction"}),e.jsxs("div",{className:"font-mono text-xs space-y-1 text-dark-300",children:[e.jsx("p",{children:"┌─────────────────┐"}),e.jsx("p",{children:"│ Version         │"}),e.jsxs("p",{children:["│ ",e.jsx("span",{className:"text-purple-400",children:"Marker (0x00)"}),"   │ ← New"]}),e.jsxs("p",{children:["│ ",e.jsx("span",{className:"text-purple-400",children:"Flag (0x01)"}),"     │ ← New"]}),e.jsx("p",{children:"│ Inputs          │"}),e.jsx("p",{children:"│ ├─ prevout      │"}),e.jsx("p",{children:"│ └─ scriptSig    │ ← Empty for native"}),e.jsx("p",{children:"│ Outputs         │"}),e.jsxs("p",{children:["│ ",e.jsx("span",{className:"text-emerald-400",children:"Witness"}),"         │ ← Sigs moved here"]}),e.jsx("p",{children:"│ Locktime        │"}),e.jsx("p",{children:"└─────────────────┘"}),e.jsx("p",{className:"mt-2",children:"txid = hash(excluding witness)"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Witness Programs"}),e.jsxs("p",{className:"mb-4",children:["SegWit introduces a new output script pattern: ",e.jsx("strong",{children:"witness programs"}),"."]}),e.jsxs(t,{title:"Witness Program",children:[e.jsx("p",{children:"A scriptPubKey consisting of a version byte (0-16) followed by a data push of 2-40 bytes. The version determines how the witness data is interpreted."}),e.jsxs("div",{className:"mt-3 font-mono text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-amber-400",children:"OP_0"})," <20-byte-hash> → P2WPKH (v0, pubkey hash)"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-amber-400",children:"OP_0"})," <32-byte-hash> → P2WSH (v0, script hash)"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-purple-400",children:"OP_1"})," <32-byte-key> → P2TR (v1, Taproot)"]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"SegWit v0 Output Types"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-5 border border-dark-700/50",children:[e.jsx("h4",{className:"text-lg font-semibold text-amber-400 mb-2",children:"P2WPKH (Pay to Witness Public Key Hash)"}),e.jsx("p",{className:"text-dark-300 mb-2",children:"The SegWit equivalent of P2PKH. The scriptPubKey commits to a hash of the public key; the witness contains the signature and public key."}),e.jsxs("div",{className:"font-mono text-xs",children:[e.jsx("p",{className:"text-dark-400",children:"scriptPubKey: OP_0 <20-byte-pubkey-hash>"}),e.jsx("p",{className:"text-emerald-400",children:"witness: <signature> <pubkey>"})]})]}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-5 border border-dark-700/50",children:[e.jsx("h4",{className:"text-lg font-semibold text-amber-400 mb-2",children:"P2WSH (Pay to Witness Script Hash)"}),e.jsx("p",{className:"text-dark-300 mb-2",children:"The SegWit equivalent of P2SH. Commits to a SHA256 hash of the script (not HASH160). Enables more complex scripts than P2WPKH."}),e.jsxs("div",{className:"font-mono text-xs",children:[e.jsx("p",{className:"text-dark-400",children:"scriptPubKey: OP_0 <32-byte-script-hash>"}),e.jsx("p",{className:"text-emerald-400",children:"witness: <script args> ... <witnessScript>"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Block Weight"}),e.jsxs("p",{className:"mb-4",children:["SegWit introduced ",e.jsx("strong",{children:"weight"})," instead of raw size for block limits:"]}),e.jsx(n,{children:"\\text{weight} = (\\text{non-witness data} \\times 4) + (\\text{witness data} \\times 1)"}),e.jsx("p",{className:"mb-4",children:"Maximum block weight is 4,000,000 units, equivalent to:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"~1 MB non-witness"}),e.jsx("p",{className:"text-sm text-dark-300",children:"If a block contains only legacy transactions, max size is still ~1 MB"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"~4 MB with witness"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Theoretical max with 100% witness data (impractical but possible)"})]})]}),e.jsx(s,{type:"info",title:"Why the Discount?",children:e.jsx("p",{children:"Witness data is discounted because it's less costly to validate—it doesn't affect the UTXO set and can be pruned by nodes that don't need historical signatures. The 4x multiplier for non-witness data preserves the ~1MB limit for the critical UTXO-affecting data."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Soft Fork Magic"}),e.jsx("p",{className:"mb-4",children:"SegWit achieves backward compatibility through a clever trick:"}),e.jsx(i,{title:"Old Node Perspective",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{children:"A P2WPKH output looks like this to old nodes:"}),e.jsx("div",{className:"font-mono text-sm bg-dark-800 p-3 rounded",children:e.jsx("p",{children:"scriptPubKey: OP_0 <20-bytes>"})}),e.jsx("p",{className:"mt-2",children:`Old nodes see this as an "anyone-can-spend" output (OP_0 pushes 0, 20-byte push, script succeeds). They consider SegWit transactions valid but don't understand the witness rules.`}),e.jsx("p",{className:"text-amber-400",children:"New nodes enforce the witness requirements, so only valid signatures can actually spend."})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Benefits Summary"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Fixes Malleability"}),e.jsx("p",{className:"text-sm text-dark-300",children:"txid no longer includes signatures—enables Lightning and other L2 protocols"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Increases Capacity"}),e.jsx("p",{className:"text-sm text-dark-300",children:"~2x practical capacity increase through witness discount"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Enables Script Upgrades"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Version byte allows future script versions (like Taproot's v1)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Improves Signing"}),e.jsx("p",{className:"text-sm text-dark-300",children:"BIP-143 fixes quadratic hashing in signature generation"})]})]}),e.jsx(s,{type:"success",title:"Foundation for the Future",children:e.jsx("p",{children:`SegWit didn't just fix immediate problems—it created the framework for future upgrades. Taproot (BIP-341) is "SegWit version 1," building directly on BIP-141's versioning system. The witness discount principle continues to guide Bitcoin's scaling approach.`})})]})}export{j as default};
