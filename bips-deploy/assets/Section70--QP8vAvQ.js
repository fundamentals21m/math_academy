import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as t,C as s,D as i,E as l}from"./Callout-Bm0ChKkk.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(t,{sectionId:70,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-158: Compact Block Filters"}),e.jsx("p",{className:"mb-4",children:"BIP-158 specifies the structure and encoding of compact block filters used by BIP-157. These Golomb-coded sets (GCS) efficiently represent block contents for lightweight client filtering."}),e.jsx(s,{type:"info",title:"Companion to BIP-157",children:e.jsx("p",{children:"BIP-158 defines HOW to construct filters. BIP-157 defines HOW to serve them. Together they enable privacy-preserving light clients."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Golomb-Coded Sets"}),e.jsx(i,{title:"GCS (Golomb-Coded Set)",children:e.jsx("p",{children:"A probabilistic data structure that compactly encodes a set of elements. Like Bloom filters, it has false positives but no false negatives. Unlike Bloom filters, it's more space-efficient and deterministic."})}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# GCS parameters for Bitcoin filters:"}),e.jsx("p",{className:"text-dark-300",children:"P = 19 (false positive rate = 1/2^19 ≈ 1 in 500,000)"}),e.jsx("p",{className:"text-dark-300",children:"M = 784931 (parameter derived from P)"}),e.jsx("p",{className:"text-dark-500 mt-3",children:"Very low false positive rate → minimal wasted block downloads"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Filter Construction"}),e.jsx("p",{className:"mb-4",children:"Basic (type 0) filters include specific block data:"}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"Included in Filter:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"All scriptPubKeys of outputs created in the block"}),e.jsx("li",{children:"All scriptPubKeys being spent by inputs (from prevouts)"}),e.jsx("li",{children:"Scripts are serialized without length prefix"})]}),e.jsx("p",{className:"text-dark-400 font-bold mt-4 mb-2",children:"Excluded from Filter:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"OP_RETURN outputs (not spendable)"}),e.jsx("li",{children:"Witness data (only script, not signatures)"}),e.jsx("li",{children:"Transaction structure (inputs, outputs, etc.)"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Encoding Process"}),e.jsx(l,{title:"Filter Construction Steps",children:e.jsxs("div",{className:"space-y-3 font-mono text-xs",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 1. Collect elements:"}),e.jsx("p",{className:"text-dark-300",children:"elements = [scriptPubKey₁, scriptPubKey₂, ...]"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 2. Hash each element:"}),e.jsx("p",{className:"text-dark-300",children:"key = block_hash[0:16]"}),e.jsx("p",{className:"text-dark-300",children:"hashed = [siphash(key, e) for e in elements]"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 3. Map to range and sort:"}),e.jsx("p",{className:"text-dark-300",children:"N = len(elements)"}),e.jsx("p",{className:"text-dark-300",children:"values = sorted([h % (N * M) for h in hashed])"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 4. Compute deltas:"}),e.jsx("p",{className:"text-dark-300",children:"deltas = [values[i] - values[i-1] for i in 1..N]"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 5. Golomb-Rice encode deltas:"}),e.jsx("p",{className:"text-amber-400",children:"filter = golomb_encode(deltas, P)"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Golomb-Rice Encoding"}),e.jsx("p",{className:"mb-4",children:"Each delta is encoded as quotient + remainder:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# For each delta value d:"}),e.jsx("p",{className:"text-dark-300",children:"q = d >> P          # quotient (d / 2^P)"}),e.jsx("p",{className:"text-dark-300",children:"r = d & ((1 << P) - 1)  # remainder (d mod 2^P)"}),e.jsx("p",{className:"text-dark-400 mt-3 mb-2",children:"# Encoding:"}),e.jsx("p",{className:"text-dark-300",children:"write q ones, then a zero  # unary for quotient"}),e.jsx("p",{className:"text-dark-300",children:"write r as P bits          # binary for remainder"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Filter Matching"}),e.jsx("p",{className:"mb-4",children:"Clients check if their scripts might be in the filter:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Client matching algorithm:"}),e.jsx("p",{className:"text-dark-300",children:"1. Hash client's scriptPubKey with same key"}),e.jsx("p",{className:"text-dark-300",children:"2. Map to same range: h % (N * M)"}),e.jsx("p",{className:"text-dark-300",children:"3. Decode filter's sorted values"}),e.jsx("p",{className:"text-dark-300",children:"4. Binary search for client's value"}),e.jsx("p",{className:"text-amber-400 mt-2",children:"Match found → download block for details"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Filter Size"}),e.jsxs(s,{type:"info",title:"Space Efficiency",children:[e.jsx("p",{children:"Basic filters average ~10-20 KB per block. With 2000+ elements (scriptPubKeys), this is roughly 8-10 bytes per element—much smaller than storing full scripts."}),e.jsx("p",{className:"mt-2",children:"Total chain: ~10-20 GB for all filters vs ~500+ GB for full blockchain."})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why GCS over Bloom?"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"Bloom Filters"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Fixed size regardless of set"}),e.jsx("li",{children:"Non-deterministic (depends on insertion order)"}),e.jsx("li",{children:"Larger for same false positive rate"}),e.jsx("li",{children:"Easy to construct"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Golomb-Coded Sets"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Size proportional to set"}),e.jsx("li",{children:"Deterministic (same inputs → same output)"}),e.jsx("li",{children:"~40% smaller than Bloom"}),e.jsx("li",{children:"More complex encoding"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Determinism"}),e.jsx("p",{className:"mb-4",children:"Filter determinism is crucial:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Same block → same filter:"})," All nodes produce identical filters"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Verifiable:"})," Clients can cross-check filters from multiple peers"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Header chain:"})," Filter headers form verifiable hash chain"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"No trust required:"})," Dishonest peers detected by mismatched filters"]})]})}),e.jsx(s,{type:"success",title:"Efficient and Private",children:e.jsx("p",{children:"BIP-158's compact filters enable a new generation of light clients that are both bandwidth-efficient and privacy-preserving. The deterministic construction allows trustless verification while Golomb coding minimizes storage and transfer costs."})})]})}export{p as default};
