import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-CsKt80eB.js";import{L as a,C as s,D as r,E as t}from"./Callout-DTLGvo9K.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(a,{sectionId:29,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Derivation Scheme for P2WPKH-nested-in-P2SH"}),e.jsx("p",{className:"mb-4",children:'BIP-49 defines the derivation path for "wrapped" SegWit addresses—P2WPKH scripts nested inside P2SH. These addresses start with "3" and were the first widely-adopted SegWit format, offering backward compatibility with older wallets.'}),e.jsx(s,{type:"info",title:"Transitional Format",children:e.jsx("p",{children:"BIP-49 addresses (3...) bridge old and new: they use SegWit internally for lower fees, but wrap it in P2SH so legacy wallets can send to them. This enabled SegWit adoption before native bech32 addresses became universal."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why Nested SegWit?"}),e.jsx("p",{className:"mb-4",children:"When SegWit activated in 2017, many wallets couldn't send to native bech32 addresses:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"The Problem"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Native SegWit uses bech32 encoding"}),e.jsx("li",{children:"Many exchanges/wallets only supported base58"}),e.jsx("li",{children:"Users couldn't receive from non-upgraded services"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"BIP-49 Solution"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Wraps SegWit script in P2SH"}),e.jsx("li",{children:'Uses familiar "3..." address format'}),e.jsx("li",{children:"Any wallet can send to it"}),e.jsx("li",{children:"Still gets SegWit fee discount"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Derivation Path"}),e.jsxs(r,{title:"BIP-49 Path",children:[e.jsx("div",{className:"font-mono text-lg text-amber-400 mb-4",children:"m / 49' / coin_type' / account' / change / address_index"}),e.jsx("p",{className:"text-dark-300",children:"Identical structure to BIP-44, but with purpose 49' to indicate P2SH-wrapped P2WPKH addresses."})]}),e.jsxs(t,{title:"BIP-49 vs BIP-44 Paths",children:[e.jsxs("div",{className:"space-y-3 font-mono text-sm",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# BIP-44 (legacy P2PKH → 1...)"}),e.jsx("p",{className:"text-dark-300",children:"m/44'/0'/0'/0/0"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# BIP-49 (nested SegWit → 3...)"}),e.jsx("p",{className:"text-amber-400",children:"m/49'/0'/0'/0/0"})]})]}),e.jsx("p",{className:"text-dark-500 text-sm mt-2",children:"Same seed generates different addresses based on purpose path"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Script Structure"}),e.jsx("p",{className:"mb-4",children:"BIP-49 addresses use a specific nested script construction:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Inner witness script (P2WPKH)"}),e.jsx("p",{className:"text-emerald-400 mb-3",children:"OP_0 <20-byte-key-hash>"}),e.jsx("p",{className:"text-dark-400 mb-2",children:"# Outer P2SH scriptPubKey"}),e.jsx("p",{className:"text-amber-400",children:"OP_HASH160 <20-byte-script-hash> OP_EQUAL"}),e.jsx("p",{className:"text-xs text-dark-500 mt-3",children:"The script hash is: HASH160(OP_0 || HASH160(pubkey))"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Address Derivation Steps"}),e.jsx("p",{className:"mb-4",children:"To derive a BIP-49 address from a key:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"Derive the private key at path m/49'/0'/account'/change/index"}),e.jsx("li",{children:"Compute the compressed public key (33 bytes)"}),e.jsxs("li",{children:["Create the witness program: ",e.jsx("span",{className:"font-mono text-amber-400",children:"0x0014"})," + HASH160(pubkey)"]}),e.jsx("li",{children:"Compute HASH160 of the witness program (redeemScript)"}),e.jsx("li",{children:"Encode as Base58Check with version byte 0x05 (mainnet)"})]})}),e.jsx(t,{title:"Complete Address Derivation",children:e.jsxs("div",{className:"space-y-2 font-mono text-xs break-all",children:[e.jsx("p",{className:"text-dark-400",children:"# Public key (compressed)"}),e.jsx("p",{className:"text-dark-300",children:"03a1af804ac108a8a51782198c2d034b28bf90c8803f5a53f76276fa69a4eae77f"}),e.jsx("p",{className:"text-dark-400 mt-2",children:"# Key hash (HASH160 of pubkey)"}),e.jsx("p",{className:"text-dark-300",children:"38971f73930f6c141d977ac4fd4a727c854935b3"}),e.jsx("p",{className:"text-dark-400 mt-2",children:"# Witness program (redeemScript)"}),e.jsx("p",{className:"text-emerald-400",children:"001438971f73930f6c141d977ac4fd4a727c854935b3"}),e.jsx("p",{className:"text-dark-400 mt-2",children:"# Script hash (HASH160 of redeemScript)"}),e.jsx("p",{className:"text-dark-300",children:"89ab5cb7a91c8a3f8d2c8e5e7f0c3d1a4b2c6e8f"}),e.jsx("p",{className:"text-dark-400 mt-2",children:"# Final address (Base58Check with 0x05)"}),e.jsx("p",{className:"text-amber-400",children:"3Dwz1GEhh7A4grdJkLPT4sdEb5tRPcMVNM"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Spending from BIP-49"}),e.jsx("p",{className:"mb-4",children:"To spend from a P2SH-P2WPKH output, you provide:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# ScriptSig (reveals the redeemScript)"}),e.jsxs("p",{className:"text-amber-400 mb-3",children:["<redeemScript: 0x0014","{","keyhash","}",">"]}),e.jsx("p",{className:"text-dark-400 mb-2",children:"# Witness (signature and pubkey)"}),e.jsx("p",{className:"text-emerald-400",children:"<signature> <pubkey>"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Fee Comparison"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Format"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Address"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Spending vBytes"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3",children:"Legacy P2PKH"}),e.jsx("td",{className:"font-mono text-xs",children:"1..."}),e.jsx("td",{children:"~148 vB"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 text-amber-400",children:"Nested SegWit (BIP-49)"}),e.jsx("td",{className:"font-mono text-xs",children:"3..."}),e.jsx("td",{className:"text-amber-400",children:"~91 vB"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 text-emerald-400",children:"Native SegWit (BIP-84)"}),e.jsx("td",{className:"font-mono text-xs",children:"bc1q..."}),e.jsx("td",{className:"text-emerald-400",children:"~68 vB"})]})]})]})}),e.jsx(s,{type:"warning",title:"Migration Encouraged",children:e.jsx("p",{children:"While BIP-49 addresses still work, they're less efficient than native SegWit. The scriptSig revealing the redeemScript adds overhead that native bech32 addresses avoid. Most wallets now default to BIP-84 (native SegWit) or BIP-86 (Taproot)."})}),e.jsx(s,{type:"success",title:"Historical Importance",children:e.jsx("p",{children:"BIP-49 was crucial for SegWit adoption. By providing a backward-compatible address format, it allowed users to benefit from SegWit fee savings even when receiving from legacy services. Today it serves as a stepping stone in wallet migration paths."})})]})}export{p as default};
