import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-CsKt80eB.js";import{L as t,C as s,D as i,E as a}from"./Callout-DTLGvo9K.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(t,{sectionId:55,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-78: Payjoin"}),e.jsx("p",{className:"mb-4",children:"BIP-78 specifies Payjoin (also known as Pay-to-Endpoint or P2EP), a protocol that improves privacy by having the receiver contribute inputs to a transaction. This breaks the common assumption that all inputs come from the sender."}),e.jsx(s,{type:"info",title:"Privacy Enhancement",children:e.jsx("p",{children:"Payjoin defeats chain analysis heuristics by making it ambiguous who owns which inputs. It's a practical privacy tool that doesn't require any consensus changes."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Problem"}),e.jsx("p",{className:"mb-4",children:"Standard Bitcoin transactions leak information:"}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-rose-500/30 mb-6",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"Common Input Ownership Heuristic"}),e.jsx("p",{className:"text-dark-300 mb-3",children:"Chain analysis assumes all inputs to a transaction belong to the same entity. This is usually true and enables tracking funds across the blockchain."}),e.jsxs("div",{className:"font-mono text-xs text-dark-400",children:[e.jsx("p",{children:"Input 1 (Alice) ─┐"}),e.jsx("p",{children:"Input 2 (Alice) ─┼─→ Output (Bob) + Change (Alice)"}),e.jsx("p",{children:"Input 3 (Alice) ─┘"})]}),e.jsx("p",{className:"text-dark-500 text-sm mt-2",children:"Analysts conclude: Alice controls inputs 1, 2, 3 and the change output"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Payjoin Solution"}),e.jsx(i,{title:"Payjoin",children:e.jsx("p",{children:"A transaction construction protocol where the receiver adds their own input(s) to the transaction. The resulting transaction looks like a regular payment but breaks the common input ownership assumption."})}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Payjoin transaction:"}),e.jsx("p",{className:"text-dark-300",children:"Input 1 (Alice) ─┐"}),e.jsx("p",{className:"text-amber-400",children:"Input 2 (Bob)   ─┼─→ Output (Bob) + Change (Alice)"}),e.jsx("p",{className:"text-dark-300",children:"Input 3 (Alice) ─┘"}),e.jsx("p",{className:"text-dark-500 mt-3",children:"Analysts can't distinguish this from a regular 3-input payment!"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Protocol Flow"}),e.jsx(a,{title:"BIP-78 Payjoin Flow",children:e.jsx("div",{className:"space-y-3 text-dark-300",children:e.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Sender:"})," Creates a standard transaction paying receiver"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Sender:"})," Sends unsigned PSBT to receiver's Payjoin endpoint"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Receiver:"})," Adds their input(s) to the PSBT"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Receiver:"})," Adjusts outputs (adds their input value to payment)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Receiver:"})," Signs their inputs, returns modified PSBT"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Sender:"})," Validates changes, signs their inputs"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Sender:"})," Broadcasts the combined transaction"]})]})})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"BIP-21 Integration"}),e.jsx("p",{className:"mb-4",children:'BIP-78 adds the "pj" parameter to BIP-21 URIs:'}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Payjoin-enabled URI:"}),e.jsx("p",{className:"text-dark-300 break-all",children:"bitcoin:bc1qxxx...?amount=0.01&pj=https://merchant.com/pj"}),e.jsx("p",{className:"text-dark-500 mt-3",children:"Wallets supporting Payjoin will use the endpoint; others fall back to regular payment"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Sender Verification"}),e.jsxs(s,{type:"warning",title:"Critical Checks",children:[e.jsx("p",{children:"The sender must verify the receiver's modifications are safe:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Original payment output still present (same amount or more)"}),e.jsx("li",{children:"Change output unchanged or improved for sender"}),e.jsx("li",{children:"No unexpected outputs added"}),e.jsx("li",{children:"Fee increase is reasonable"}),e.jsx("li",{children:"Receiver's inputs are valid UTXOs"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"PSBT Version 2"}),e.jsx("p",{className:"mb-4",children:"BIP-78 works best with PSBT v2 (BIP-370) which allows:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"Adding inputs without having the full transaction structure upfront"}),e.jsx("li",{children:"Modifying outputs after initial creation"}),e.jsx("li",{children:"More natural representation of collaborative construction"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Privacy Benefits"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"For Sender"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Input ownership ambiguity"}),e.jsx("li",{children:"Change output harder to identify"}),e.jsx("li",{children:"UTXOs consolidated with receiver's"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"For Receiver"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Consolidate UTXOs invisibly"}),e.jsx("li",{children:"Received amount not obvious"}),e.jsx("li",{children:"Transaction history obscured"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Network Effect"}),e.jsx("p",{className:"mb-4",children:"Payjoin benefits all Bitcoin users:"}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:[e.jsx("p",{className:"text-dark-300 mb-3",children:"Even if only 10% of transactions use Payjoin, the common input ownership heuristic becomes unreliable for ALL transactions. Analysts can never be certain if a transaction is a regular payment or a Payjoin."}),e.jsx("p",{className:"text-emerald-400 text-sm",children:"Every Payjoin transaction improves privacy for the entire network."})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Implementation"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-1",children:"BTCPay Server"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Popular merchant solution with built-in Payjoin support for receiving payments."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-1",children:"Wasabi Wallet"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Privacy-focused wallet supporting Payjoin for both sending and receiving."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-1",children:"Sparrow Wallet"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Desktop wallet with Payjoin send support when paying to compatible receivers."})]})]}),e.jsx(s,{type:"success",title:"No Consensus Required",children:e.jsx("p",{children:"Payjoin is purely a wallet-level protocol—no soft fork or consensus changes needed. Any wallet can implement it today. The resulting transactions are standard Bitcoin transactions that work with all nodes and explorers."})})]})}export{p as default};
