import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as i,C as s,D as a,E as t}from"./Callout-Bm0ChKkk.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(i,{sectionId:11,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Absolute Time Locks in Script"}),e.jsxs("p",{className:"mb-4",children:["BIP-65 introduced ",e.jsx("strong",{children:"OP_CHECKLOCKTIMEVERIFY"})," (CLTV), an opcode that enables scripts to require that funds cannot be spent until a certain block height or timestamp. This primitive enables time-locked contracts, payment channels, and escrow mechanisms."]}),e.jsx(s,{type:"info",title:"Activated: December 2015",children:e.jsx("p",{children:"BIP-65 activated at block 388,381 via IsSuperMajority (95% threshold), requiring block version 4 or higher."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Problem Before CLTV"}),e.jsxs("p",{className:"mb-4",children:["Bitcoin always had a transaction-level ",e.jsx("code",{className:"text-amber-400",children:"nLockTime"})," field that could delay when a transaction becomes valid. But this had limitations:"]}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mb-6 text-dark-300",children:[e.jsx("li",{children:"Only delays broadcasting the spending transaction"}),e.jsx("li",{children:"Recipient can spend immediately with a different transaction (nLockTime=0)"}),e.jsx("li",{children:`Can't enforce "these funds cannot move until time X" at the script level`})]}),e.jsx(a,{title:"OP_CHECKLOCKTIMEVERIFY",children:e.jsx("p",{children:"An opcode that verifies the spending transaction's nLockTime is at least as large as the value on the stack. If not, the script fails. This binds the time lock into the output script itself, making it impossible to spend early."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"How CLTV Works"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Example: Can't spend until block 800,000"}),e.jsx("p",{className:"text-amber-400 mb-4",children:"<800000> OP_CHECKLOCKTIMEVERIFY OP_DROP OP_DUP OP_HASH160 <pubKeyHash> OP_EQUALVERIFY OP_CHECKSIG"}),e.jsx("p",{className:"text-dark-400 mb-2",children:"# To spend, the transaction must have:"}),e.jsx("p",{className:"text-emerald-400",children:"nLockTime ≥ 800000"}),e.jsx("p",{className:"text-emerald-400",children:"All inputs must have nSequence < 0xffffffff"})]}),e.jsx(t,{title:"CLTV Validation Steps",children:e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"Push the lock time value onto the stack (e.g., 800000)"}),e.jsxs("li",{children:["OP_CHECKLOCKTIMEVERIFY checks:",e.jsxs("ul",{className:"list-disc list-inside ml-6 mt-1 space-y-1",children:[e.jsx("li",{children:"Is the stack value negative? → FAIL"}),e.jsx("li",{children:"Are lock time types mismatched? → FAIL"}),e.jsx("li",{children:"Is tx.nLockTime < stack value? → FAIL"}),e.jsx("li",{children:"Is tx.nSequence == 0xffffffff? → FAIL"})]})]}),e.jsx("li",{children:"If all checks pass, execution continues (value stays on stack)"}),e.jsx("li",{children:"OP_DROP removes the lock time value (standard pattern)"}),e.jsx("li",{children:"Script continues with normal P2PKH checks"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Lock Time Types"}),e.jsx("p",{className:"mb-4",children:"Bitcoin uses a clever encoding for lock times:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-blue-500/30",children:[e.jsx("p",{className:"text-blue-400 font-bold mb-2",children:"Block Height"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Values < 500,000,000 are interpreted as block heights"}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"Example: 800000 = block 800,000"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-amber-500/30",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"Unix Timestamp"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Values ≥ 500,000,000 are Unix timestamps"}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"Example: 1704067200 = Jan 1, 2024"})]})]}),e.jsx(s,{type:"warning",title:"Type Matching Required",children:e.jsx("p",{children:`The script's lock time and transaction's nLockTime must be the same type (both block heights or both timestamps). Mixing types causes the script to fail. This prevents confusion between "block 1704067200" and "timestamp 1704067200".`})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Use Cases"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-5 border border-dark-700/50",children:[e.jsx("h4",{className:"text-lg font-semibold text-amber-400 mb-2",children:"Escrow with Timeout"}),e.jsx("p",{className:"text-dark-300",children:`"Pay to Alice's signature, OR pay to Bob's signature after block 850,000." If Alice doesn't respond, Bob can recover funds after the timeout.`})]}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-5 border border-dark-700/50",children:[e.jsx("h4",{className:"text-lg font-semibold text-amber-400 mb-2",children:"Inheritance Planning"}),e.jsx("p",{className:"text-dark-300",children:`"Pay to heir's key after timestamp X, OR pay to my key anytime." If owner dies and can't spend, heir can claim after the date.`})]}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-5 border border-dark-700/50",children:[e.jsx("h4",{className:"text-lg font-semibold text-amber-400 mb-2",children:"Payment Channels"}),e.jsx("p",{className:"text-dark-300",children:"Hash Time-Locked Contracts (HTLCs) use CLTV for timeout paths. If a payment isn't claimed in time, funds return to the sender."})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Script Patterns"}),e.jsx(t,{title:"Common CLTV Scripts",children:e.jsxs("div",{className:"space-y-4 font-mono text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# Simple time-locked payment"}),e.jsx("p",{className:"text-amber-400",children:"<locktime> CLTV DROP <pubkey> CHECKSIG"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# Time-locked OR immediate with different key"}),e.jsx("p",{className:"text-amber-400",children:"IF <locktime> CLTV DROP <pubkeyA> CHECKSIG ELSE <pubkeyB> CHECKSIG ENDIF"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# HTLC pattern (simplified)"}),e.jsx("p",{className:"text-amber-400",children:"IF HASH160 <hash> EQUALVERIFY <receiverKey> CHECKSIG ELSE <timeout> CLTV DROP <senderKey> CHECKSIG ENDIF"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Relationship to nLockTime"}),e.jsx("p",{className:"mb-4",children:"CLTV doesn't replace nLockTime—it enforces it:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mb-6 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"nLockTime:"})," Transaction-level field, set by transaction creator"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"CLTV:"})," Script-level enforcement, set by output creator"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Together:"})," CLTV forces the spender to set nLockTime correctly"]})]}),e.jsx(s,{type:"success",title:"Foundation for Lightning",children:e.jsx("p",{children:"CLTV is essential for Lightning Network HTLCs. When combined with OP_CHECKSEQUENCEVERIFY (BIP-112), it enables the complex time-locked contracts that make payment channels secure. We'll explore this connection when we cover Layer 2 solutions."})})]})}export{p as default};
