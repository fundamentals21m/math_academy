import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-CsKt80eB.js";import{L as t,C as s,D as r,E as a}from"./Callout-DTLGvo9K.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(t,{sectionId:71,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-324: Version 2 P2P Transport"}),e.jsx("p",{className:"mb-4",children:"BIP-324 introduces encrypted and authenticated peer-to-peer communication for Bitcoin. V2 transport protects against passive eavesdropping and makes active man-in-the-middle attacks detectable."}),e.jsx(s,{type:"info",title:"Network Layer Privacy",children:e.jsx("p",{children:"Bitcoin's original P2P protocol is unencrypted. ISPs and network observers can see all messages. BIP-324 adds opportunistic encryption, improving privacy without requiring trust."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Problem"}),e.jsx("p",{className:"mb-4",children:"Unencrypted P2P traffic enables attacks:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-rose-500/30 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Passive surveillance:"})," Observers see all transactions/blocks"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Transaction origin:"})," First relay reveals likely source"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Network mapping:"})," Topology easily discoverable"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Traffic analysis:"})," Message patterns reveal activity"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Eclipse attacks:"})," Easier when traffic is visible"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"V2 Transport Features"}),e.jsx(r,{title:"BIP-324 Features",children:e.jsx("p",{children:"Encrypted, authenticated communication with pseudorandom byte stream that resists traffic analysis and censorship."})}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Encryption:"})," ChaCha20-Poly1305 AEAD cipher"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Key exchange:"})," Elliptic Curve Diffie-Hellman (secp256k1)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Authentication:"})," Optional session ID verification"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Byte-stream:"})," No distinguishing patterns in traffic"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Handshake"}),e.jsx(a,{title:"V2 Connection Handshake",children:e.jsxs("div",{className:"space-y-3 font-mono text-xs",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 1. Initiator sends public key:"}),e.jsx("p",{className:"text-dark-300",children:"I → R: ellswift_pubkey_i (64 bytes)"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"ElligatorSwift encoding (indistinguishable from random)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 2. Responder sends public key + encrypted garbage:"}),e.jsx("p",{className:"text-dark-300",children:"R → I: ellswift_pubkey_r || garbage_auth || garbage"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 3. Both derive shared secrets:"}),e.jsx("p",{className:"text-dark-300",children:"shared_secret = ECDH(my_privkey, their_pubkey)"}),e.jsx("p",{className:"text-amber-400",children:"encryption_keys = HKDF(shared_secret, ...)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 4. Initiator sends version packet + garbage:"}),e.jsx("p",{className:"text-dark-300",children:"I → R: encrypted(version_packet) || garbage"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 5. Encrypted communication begins"}),e.jsx("p",{className:"text-emerald-400",children:"All subsequent messages encrypted"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"ElligatorSwift"}),e.jsx("p",{className:"mb-4",children:"Public keys are encoded to look random:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Normal public key:"})," Recognizable 33-byte compressed format"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"ElligatorSwift:"})," 64 bytes, indistinguishable from random"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Benefit:"}),` Traffic doesn't reveal "this is Bitcoin"`]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Censorship resistance:"})," Harder to block Bitcoin traffic"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Packet Structure"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# V2 encrypted packet:"}),e.jsx("p",{className:"text-dark-300",children:"length: 3 bytes (encrypted)"}),e.jsx("p",{className:"text-dark-300",children:"header: 1 byte (encrypted)"}),e.jsx("p",{className:"text-dark-300",children:"contents: variable (encrypted)"}),e.jsx("p",{className:"text-amber-400",children:"tag: 16 bytes (Poly1305 MAC)"}),e.jsx("p",{className:"text-dark-500 mt-3",children:"Length field prevents traffic analysis of message sizes"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Short Message IDs"}),e.jsx("p",{className:"mb-4",children:"V2 uses 1-byte message type IDs instead of 12-byte ASCII names:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"V1 Name"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"V2 ID"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Savings"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono",children:'"inv"'}),e.jsx("td",{className:"font-mono text-amber-400",children:"0x01"}),e.jsx("td",{children:"11 bytes"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono",children:'"tx"'}),e.jsx("td",{className:"font-mono text-amber-400",children:"0x02"}),e.jsx("td",{children:"11 bytes"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono",children:'"getdata"'}),e.jsx("td",{className:"font-mono text-amber-400",children:"0x03"}),e.jsx("td",{children:"11 bytes"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-mono",children:'"block"'}),e.jsx("td",{className:"font-mono text-amber-400",children:"0x06"}),e.jsx("td",{children:"11 bytes"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Opportunistic Encryption"}),e.jsx(s,{type:"warning",title:"Not Full Authentication",children:e.jsx("p",{children:"BIP-324 provides encryption but doesn't authenticate peers by default. An active MITM can still intercept connections. Optional session ID comparison can detect this, but requires out-of-band verification."})}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"Threat model:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Passive observer:"})," ✅ Defeated (can't read traffic)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Active MITM:"})," ⚠️ Detectable via session ID, not prevented"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Traffic analysis:"})," ✅ Significantly reduced"]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Backward Compatibility"}),e.jsx("p",{className:"mb-4",children:"V2 coexists with V1 connections:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Connection negotiation:"}),e.jsx("p",{className:"text-dark-300",children:"Initiator sends V2 handshake bytes"}),e.jsx("p",{className:"text-dark-300",children:"If responder doesn't understand:"}),e.jsx("p",{className:"text-dark-500 ml-4",children:'Falls back to V1 (starts with "version" message)'}),e.jsx("p",{className:"text-dark-300",children:"If responder supports V2:"}),e.jsx("p",{className:"text-emerald-400 ml-4",children:"Continues with encrypted handshake"})]}),e.jsx(s,{type:"success",title:"Network Privacy Upgrade",children:e.jsx("p",{children:"BIP-324 is a significant privacy upgrade for Bitcoin's network layer. While not a complete solution (Tor/I2P still recommended for strong anonymity), it raises the bar for passive surveillance and makes Bitcoin traffic harder to identify and censor."})})]})}export{p as default};
