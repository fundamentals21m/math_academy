import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-CsKt80eB.js";import{L as a,C as s,D as i,E as t}from"./Callout-DTLGvo9K.js";import{M as l}from"./MathBlock-fCav0pL3.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function j(){return e.jsxs(a,{sectionId:17,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"A New Signature Algorithm"}),e.jsx("p",{className:"mb-4",children:"BIP-143 defines how signatures are computed for SegWit transactions. The new algorithm fixes serious flaws in the legacy signing process, including a quadratic hashing bug that made large transactions computationally expensive to validate."}),e.jsx(s,{type:"info",title:"Part of SegWit",children:e.jsx("p",{children:"BIP-143 activated with SegWit (BIP-141) in August 2017. It applies to all SegWit v0 spending (P2WPKH, P2WSH). Taproot (v1) uses a further improved algorithm (BIP-341)."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Legacy Problem"}),e.jsx("p",{className:"mb-4",children:"The original signature algorithm had a critical flaw: signing time grew quadratically with transaction size."}),e.jsx(i,{title:"Quadratic Hashing",children:e.jsx("p",{children:"In legacy signing, each input required hashing the entire transaction (minus the current input's scriptSig). For N inputs, this meant N full hashes. As transactions got larger, computation time grew as O(N²)—a potential DoS vector."})}),e.jsx(t,{title:"Quadratic Scaling Attack",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-dark-300",children:"Consider a transaction with N inputs:"}),e.jsx(l,{children:"\\text{Hash operations} \\approx N \\times \\text{(transaction size)} \\approx N^2"}),e.jsxs("div",{className:"mt-3 text-dark-400 text-sm",children:[e.jsx("p",{children:"100 inputs → ~10,000 hash operations"}),e.jsx("p",{children:"1000 inputs → ~1,000,000 hash operations"}),e.jsx("p",{className:"text-amber-400 mt-1",children:'Attacker could create a "poison block" taking minutes to validate!'})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"BIP-143 Solution"}),e.jsx("p",{className:"mb-4",children:"BIP-143 redesigns the signature hash (sighash) calculation to be O(N):"}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-amber-400 mb-3",children:"Key Improvements"}),e.jsxs("ul",{className:"space-y-3 text-dark-300",children:[e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-400",children:"1."}),e.jsxs("span",{children:[e.jsx("strong",{children:"Pre-computed hashes:"})," Common data (all prevouts, all sequences, all outputs) is hashed once and reused for each input"]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-400",children:"2."}),e.jsxs("span",{children:[e.jsx("strong",{children:"Input-specific data:"})," Only the current input's unique data is added per-signature"]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-400",children:"3."}),e.jsxs("span",{children:[e.jsx("strong",{children:"Committed values:"})," The input amount is included in the sighash, preventing certain attack vectors"]})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Digest Algorithm"}),e.jsx("p",{className:"mb-4",children:"BIP-143 specifies exactly what data is hashed for each signature:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-xs mb-6 overflow-x-auto",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# BIP-143 Sighash Preimage (double SHA256)"}),e.jsxs("ol",{className:"space-y-1 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("span",{className:"text-purple-400",children:"1."})," nVersion (4 bytes)"]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-purple-400",children:"2."})," hashPrevouts (32 bytes) ",e.jsx("span",{className:"text-dark-500",children:"← hash of all input outpoints"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-purple-400",children:"3."})," hashSequence (32 bytes) ",e.jsx("span",{className:"text-dark-500",children:"← hash of all input sequences"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-purple-400",children:"4."})," outpoint (36 bytes) ",e.jsx("span",{className:"text-dark-500",children:"← this input's prevout"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-purple-400",children:"5."})," scriptCode (var) ",e.jsx("span",{className:"text-dark-500",children:"← script being satisfied"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-purple-400",children:"6."})," ",e.jsx("span",{className:"text-amber-400",children:"value (8 bytes)"})," ",e.jsx("span",{className:"text-dark-500",children:"← input amount (NEW!)"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-purple-400",children:"7."})," nSequence (4 bytes) ",e.jsx("span",{className:"text-dark-500",children:"← this input's sequence"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-purple-400",children:"8."})," hashOutputs (32 bytes) ",e.jsx("span",{className:"text-dark-500",children:"← hash of all outputs"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-purple-400",children:"9."})," nLocktime (4 bytes)"]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-purple-400",children:"10."})," sighash type (4 bytes)"]})]})]}),e.jsx(t,{title:"Pre-computed Hashes",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{children:"For a transaction with 100 inputs, instead of:"}),e.jsx("p",{className:"text-rose-400 line-through",children:"100 × hash(~10KB each) = ~1MB hashed"}),e.jsx("p",{children:"BIP-143 does:"}),e.jsx("p",{className:"text-emerald-400",children:"hash(prevouts) + hash(sequences) + hash(outputs) + 100 × hash(~200B) = ~20KB hashed"}),e.jsx("p",{className:"text-dark-500 text-sm mt-2",children:"The pre-computed hashes are calculated once, then each input just adds its small unique data."})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Including the Input Value"}),e.jsx(s,{type:"success",title:"Security Improvement",children:e.jsx("p",{children:"BIP-143 requires signing the input value (amount being spent). This prevents an attack where a hardware wallet could be tricked into signing with incorrect fee calculations. The signer now commits to exactly how much is being spent, not just what's left over."})}),e.jsx("p",{className:"mb-4",children:"This is crucial for hardware wallets:"}),e.jsx(t,{title:"Why Value Commitment Matters",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{children:"Without value in sighash (legacy):"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-4",children:[e.jsx("li",{children:'Hardware wallet sees: "spend this UTXO, send 1 BTC to Alice"'}),e.jsx("li",{children:"Malware lies about UTXO value: claims it's 1.1 BTC"}),e.jsx("li",{children:"Hardware thinks fee is 0.1 BTC (reasonable)"}),e.jsx("li",{children:"Actually, UTXO is 10 BTC → fee is 9 BTC!"})]}),e.jsx("p",{className:"text-emerald-400 mt-2",children:"With BIP-143: signature commits to the actual value, so hardware wallet must know the true amount to produce a valid signature."})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Sighash Types"}),e.jsx("p",{className:"mb-4",children:"BIP-143 supports the same sighash types as legacy, with modified behavior:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Type"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Value"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Signs"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 text-amber-400",children:"SIGHASH_ALL"}),e.jsx("td",{children:"0x01"}),e.jsx("td",{children:"All inputs and outputs"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 text-amber-400",children:"SIGHASH_NONE"}),e.jsx("td",{children:"0x02"}),e.jsx("td",{children:"All inputs, no outputs"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 text-amber-400",children:"SIGHASH_SINGLE"}),e.jsx("td",{children:"0x03"}),e.jsx("td",{children:"All inputs, one output (same index)"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 text-amber-400",children:"ANYONECANPAY"}),e.jsx("td",{children:"0x80"}),e.jsx("td",{children:"Modifier: only this input"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Implementation Notes"}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:[e.jsx("p",{className:"text-dark-300 mb-3",children:"For wallet developers:"}),e.jsxs("ul",{className:"space-y-2 text-dark-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400",children:"•"}),e.jsx("span",{children:"Always use the new algorithm for SegWit inputs"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400",children:"•"}),e.jsx("span",{children:"Cache hashPrevouts, hashSequence, hashOutputs when signing multiple inputs"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400",children:"•"}),e.jsx("span",{children:"Verify you have the correct input value before signing"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400",children:"•"}),e.jsx("span",{children:"SIGHASH_SINGLE requires special handling when index exceeds outputs"})]})]})]}),e.jsx(s,{type:"note",title:"Taproot Improvements",children:e.jsx("p",{children:"BIP-341 (Taproot) further improves on BIP-143 with tagged hashes, epoch separation, and additional commitments. However, BIP-143 remains the standard for SegWit v0 transactions."})})]})}export{j as default};
