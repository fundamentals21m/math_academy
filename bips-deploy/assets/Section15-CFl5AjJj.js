import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-CsKt80eB.js";import{L as a,C as s,E as t,D as i}from"./Callout-DTLGvo9K.js";import{M as l}from"./MathBlock-fCav0pL3.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function j(){return e.jsxs(a,{sectionId:15,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Securing Time-Based Locks"}),e.jsxs("p",{className:"mb-4",children:["BIP-113 changes how Bitcoin interprets time-based locks by using ",e.jsx("strong",{children:"Median Time Past (MTP)"})," instead of the block's timestamp. This prevents miners from manipulating timelocks by setting strategic timestamps."]}),e.jsx(s,{type:"info",title:"Activated: July 2016",children:e.jsx("p",{children:"BIP-113 activated as part of the CSV soft fork alongside BIP-68 and BIP-112. It affects both nLockTime (CLTV) and nSequence (CSV) time-based locks."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Timestamp Problem"}),e.jsx("p",{className:"mb-4",children:"Bitcoin blocks include a timestamp, but it's only loosely validated:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mb-6 text-dark-300",children:[e.jsx("li",{children:"Must be greater than the median of the last 11 blocks (MTP)"}),e.jsx("li",{children:"Must be less than 2 hours in the future (network time)"}),e.jsx("li",{children:"Can vary significantly within these bounds"})]}),e.jsx(t,{title:"Timestamp Manipulation Attack",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{children:"Alice has a timelock that expires at timestamp T:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-4",children:[e.jsx("li",{children:"Current time is T - 1 hour"}),e.jsx("li",{children:"A miner sets their block's timestamp to T + 1 (1 hour ahead)"}),e.jsx("li",{children:"This is valid (within 2-hour future tolerance)"}),e.jsx("li",{children:"Alice's timelock appears satisfied in this block"}),e.jsx("li",{children:"Alice can spend earlier than intended!"})]}),e.jsx("p",{className:"text-amber-400 mt-2",children:"A malicious miner could help Alice bypass her timelock by ~2 hours."})]})}),e.jsx(i,{title:"Median Time Past (MTP)",children:e.jsx("p",{children:"The median of the timestamps of the 11 blocks preceding a given block. For block N, MTP is the median of blocks N-11 through N-1. MTP can only increase (or stay the same) as new blocks are added."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why Median of 11?"}),e.jsx("p",{className:"mb-4",children:"The choice of 11 blocks is deliberate:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"space-y-3 text-dark-300",children:[e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-400",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Odd number:"})," Guarantees a clear median (no ties)"]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-400",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Manipulation resistance:"})," Requires controlling 6+ consecutive blocks to move MTP forward significantly"]})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-400",children:"•"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Reasonable lag:"})," ~1 hour average delay is acceptable for most uses"]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"MTP Calculation"}),e.jsx(t,{title:"Computing MTP",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-dark-300",children:"Given the last 11 block timestamps:"}),e.jsxs("div",{className:"font-mono text-sm bg-dark-800 p-4 rounded-lg overflow-x-auto",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Timestamps (sorted for clarity)"}),e.jsxs("p",{className:"text-amber-400",children:["[1704060000, 1704060600, 1704061200, 1704061800, 1704062400,"," ",e.jsx("span",{className:"text-emerald-400 font-bold",children:"1704063000"}),","," ","1704063600, 1704064200, 1704064800, 1704065400, 1704066000]"]}),e.jsx("p",{className:"text-dark-500 mt-2",children:"MTP = 6th value (index 5) = 1704063000"})]}),e.jsx(l,{children:"\\text{MTP} = \\text{timestamps}\\left[\\left\\lfloor\\frac{11}{2}\\right\\rfloor\\right] = \\text{timestamps}[5]"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"BIP-113 Rule Change"}),e.jsx("p",{className:"mb-4",children:"Before BIP-113, timelocks compared against the block's timestamp. After:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"Before BIP-113"}),e.jsxs("div",{className:"text-sm text-dark-300 font-mono",children:[e.jsx("p",{children:"if (tx.nLockTime < block.timestamp)"}),e.jsx("p",{className:"ml-4",children:"valid = true"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"After BIP-113"}),e.jsxs("div",{className:"text-sm text-dark-300 font-mono",children:[e.jsx("p",{children:"if (tx.nLockTime < block.MTP)"}),e.jsx("p",{className:"ml-4",children:"valid = true"})]})]})]}),e.jsx(s,{type:"warning",title:"MTP Lag Effect",children:e.jsx("p",{children:'Because MTP is derived from past blocks, it lags real time by roughly 1 hour on average. A timelock set for "January 1, 2024 00:00 UTC" will actually become spendable approximately when MTP reaches that timestamp—which happens after the real-world time has passed.'})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Impact on CLTV and CSV"}),e.jsx("p",{className:"mb-4",children:"BIP-113 affects both absolute (CLTV) and relative (CSV) time-based locks:"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-5 border border-dark-700/50",children:[e.jsx("h4",{className:"text-lg font-semibold text-amber-400 mb-2",children:"For CLTV (nLockTime)"}),e.jsx("p",{className:"text-dark-300",children:"When nLockTime ≥ 500,000,000 (timestamp), compare against current block's MTP instead of the block's own timestamp."})]}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-5 border border-dark-700/50",children:[e.jsx("h4",{className:"text-lg font-semibold text-amber-400 mb-2",children:"For CSV (nSequence)"}),e.jsx("p",{className:"text-dark-300",children:"When nSequence has type flag set (time-based), the elapsed time is calculated as (current block MTP) - (input confirmation block MTP), not using raw timestamps."})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Practical Implications"}),e.jsx(t,{title:"Setting Time-Based Locks",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{children:"When creating a time-based lock:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Add buffer:"})," If you want funds available on Jan 1, set the lock to Dec 31, accounting for MTP lag"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Prefer blocks:"})," For precision, use block-based locks instead of time-based ones"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Consider variance:"})," Block times vary (sometimes 1 min, sometimes 1 hour)"]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Security Improvement"}),e.jsx("p",{className:"mb-4",children:"BIP-113 significantly raises the bar for timestamp manipulation:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 mb-6",children:[e.jsx("p",{className:"text-dark-300 mb-3",children:"To advance MTP by T seconds, an attacker must:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300 ml-4",children:[e.jsx("li",{children:"Control at least 6 consecutive blocks"}),e.jsx("li",{children:"Set each block's timestamp to the maximum allowed"}),e.jsx("li",{children:"Still only gain ~2 hours max (due to the 2-hour future limit)"})]}),e.jsx("p",{className:"text-amber-400 mt-3",children:"This requires sustained ~51% hashrate, making the attack impractical."})]}),e.jsx(s,{type:"success",title:"Part of a Cohesive System",children:e.jsx("p",{children:"BIP-113 completes the timelock security picture. Combined with BIP-68 (sequence semantics) and BIP-112 (CSV opcode), it provides robust time-based scripting that's resistant to miner manipulation—essential for trustless contracts."})})]})}export{j as default};
