import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as t,C as s,D as l,E as r}from"./Callout-Bm0ChKkk.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(t,{sectionId:64,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-111: NODE_BLOOM Service Bit"}),e.jsx("p",{className:"mb-4",children:"BIP-111 added the NODE_BLOOM service bit, allowing nodes to advertise whether they support BIP-37 Bloom filter messages. This enabled a graceful deprecation path as the network moved away from Bloom filters."}),e.jsx(s,{type:"info",title:"Deprecation Mechanism",children:e.jsx("p",{children:"NODE_BLOOM allowed Bloom filter support to become opt-in rather than mandatory. Nodes could disable it to avoid DoS attacks while still participating in the network."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Problem"}),e.jsx("p",{className:"mb-4",children:"Before BIP-111, all nodes were expected to process Bloom filters:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-rose-500/30 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"No way for nodes to refuse Bloom filter requests"}),e.jsx("li",{children:"SPV clients couldn't know which peers support filtering"}),e.jsx("li",{children:"DoS-vulnerable nodes had no opt-out mechanism"}),e.jsx("li",{children:"Network couldn't transition away from BIP-37"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Service Bit"}),e.jsxs(l,{title:"NODE_BLOOM",children:[e.jsx("p",{children:"A service bit in the version message indicating that a node will accept and process BIP-37 filterload, filteradd, and filterclear messages."}),e.jsx("div",{className:"font-mono text-sm text-amber-400 mt-3",children:"NODE_BLOOM = 1 << 2 = 0x04"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Service flags in version message:"}),e.jsx("p",{className:"text-dark-300",children:"services = NODE_NETWORK  // 0x01"}),e.jsx("p",{className:"text-dark-300",children:"services |= NODE_BLOOM   // 0x04"}),e.jsx("p",{className:"text-dark-300",children:"services |= NODE_WITNESS // 0x08"}),e.jsx("p",{className:"text-amber-400 mt-2",children:"Final: 0x0D (full node + bloom + segwit)"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Node Behavior"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"NODE_BLOOM Set"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Process filterload messages"}),e.jsx("li",{children:"Filter transactions/blocks per request"}),e.jsx("li",{children:"Send merkleblock messages"}),e.jsx("li",{children:"Vulnerable to DoS attacks"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"NODE_BLOOM Not Set"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Ignore filter messages"}),e.jsx("li",{children:"May disconnect filter senders"}),e.jsx("li",{children:"Protected from Bloom DoS"}),e.jsx("li",{children:"SPV clients should avoid"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"SPV Client Behavior"}),e.jsx(r,{title:"SPV Peer Selection",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"When connecting to peers:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 font-mono text-xs",children:[e.jsx("p",{className:"text-dark-300",children:"for peer in potential_peers:"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"if peer.services & NODE_BLOOM:"}),e.jsx("p",{className:"text-emerald-400 ml-8",children:"connect(peer)  # Can use Bloom filters"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"else:"}),e.jsx("p",{className:"text-rose-400 ml-8",children:"skip(peer)     # Won't process our filters"})]}),e.jsx("p",{className:"text-dark-500 text-sm mt-3",children:"Clients must check NODE_BLOOM before sending filterload"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Protocol Version"}),e.jsx("p",{className:"mb-4",children:"BIP-111 was introduced with protocol version 70011:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Before 70011:"})," Bloom filters assumed supported"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"70011+:"})," Must check NODE_BLOOM service bit"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Transition:"})," Old clients might not check the bit"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Bitcoin Core Settings"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Bitcoin Core configuration:"}),e.jsx("p",{className:"text-dark-300",children:"-peerbloomfilters=0  # Disable (default since 0.19)"}),e.jsx("p",{className:"text-dark-300",children:"-peerbloomfilters=1  # Enable for SPV clients"}),e.jsx("p",{className:"text-dark-500 mt-3",children:"When disabled, node won't advertise NODE_BLOOM"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Network Evolution"}),e.jsx("p",{className:"mb-4",children:"NODE_BLOOM enabled gradual network transition:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"BIP-111 introduced - nodes can opt out of Bloom"}),e.jsx("li",{children:"Node operators begin disabling for DoS protection"}),e.jsx("li",{children:"SPV clients learn to check service bit"}),e.jsx("li",{children:"BIP-157/158 provides better alternative"}),e.jsx("li",{children:"Default changed to off (Bloom disabled by default)"}),e.jsx("li",{children:"Most network no longer supports BIP-37"})]})}),e.jsxs(s,{type:"warning",title:"SPV Today",children:[e.jsx("p",{children:"SPV clients using Bloom filters increasingly struggle to find supporting peers. Modern light clients should use:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"BIP-157/158 compact block filters"}),e.jsx("li",{children:"Electrum protocol servers"}),e.jsx("li",{children:"Esplora or similar block explorer APIs"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Other Service Bits"}),e.jsx("p",{className:"mb-4",children:"BIP-111 followed the pattern of other service bits:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Bit"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Name"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Meaning"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono",children:"0"}),e.jsx("td",{children:"NODE_NETWORK"}),e.jsx("td",{children:"Full node, serves blocks"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"2"}),e.jsx("td",{className:"text-amber-400",children:"NODE_BLOOM"}),e.jsx("td",{className:"text-amber-400",children:"Supports Bloom filters"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono",children:"3"}),e.jsx("td",{children:"NODE_WITNESS"}),e.jsx("td",{children:"Supports SegWit"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-mono",children:"10"}),e.jsx("td",{children:"NODE_NETWORK_LIMITED"}),e.jsx("td",{children:"Pruned node"})]})]})]})}),e.jsx(s,{type:"success",title:"Graceful Deprecation",children:e.jsx("p",{children:"BIP-111 demonstrates how to deprecate features without breaking the network. By making Bloom filter support advertised rather than assumed, nodes could individually opt out while SPV clients could still find supporting peers during the transition."})})]})}export{p as default};
