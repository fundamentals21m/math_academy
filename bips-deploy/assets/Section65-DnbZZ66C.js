import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as r,C as s,D as t,E as a}from"./Callout-Bm0ChKkk.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(r,{sectionId:65,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-130: sendheaders Message"}),e.jsx("p",{className:"mb-4",children:"BIP-130 introduced the sendheaders message, allowing nodes to request direct header announcements instead of inventory-based block notification. This reduces latency in learning about new blocks."}),e.jsx(s,{type:"info",title:"Faster Block Awareness",children:e.jsx("p",{children:"With sendheaders, nodes learn about new blocks immediately when their peer receives them, without waiting for an inv/getdata round trip."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Problem"}),e.jsx("p",{className:"mb-4",children:"Traditional block announcement required multiple message round trips:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Old block announcement:"}),e.jsx("p",{className:"text-dark-300",children:"1. Peer A finds/receives new block"}),e.jsx("p",{className:"text-dark-300",children:"2. Peer A → Peer B: inv(block_hash)"}),e.jsx("p",{className:"text-dark-300",children:"3. Peer B → Peer A: getheaders()"}),e.jsx("p",{className:"text-dark-300",children:"4. Peer A → Peer B: headers()"}),e.jsx("p",{className:"text-dark-300",children:"5. Peer B → Peer A: getdata(block)"}),e.jsx("p",{className:"text-dark-300",children:"6. Peer A → Peer B: block()"}),e.jsx("p",{className:"text-rose-400 mt-2",children:"Many round trips before block data received!"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Solution"}),e.jsx(t,{title:"sendheaders Message",children:e.jsx("p",{children:'A signal message (empty payload) that tells a peer: "Please announce new blocks by sending headers directly, not via inv messages."'})}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# With sendheaders:"}),e.jsx("p",{className:"text-dark-300",children:'1. After connection: send "sendheaders"'}),e.jsx("p",{className:"text-dark-300",children:"2. Peer finds/receives new block"}),e.jsx("p",{className:"text-amber-400",children:"3. Peer → Us: headers(new_block_header)"}),e.jsx("p",{className:"text-dark-300",children:"4. Us → Peer: getdata(block)"}),e.jsx("p",{className:"text-dark-300",children:"5. Peer → Us: block()"}),e.jsx("p",{className:"text-emerald-400 mt-2",children:"Saves one round trip!"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Protocol Flow"}),e.jsx(a,{title:"sendheaders Negotiation",children:e.jsxs("div",{className:"space-y-3 font-mono text-xs",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 1. Connection established:"}),e.jsx("p",{className:"text-dark-300",children:"A ↔ B: version/verack exchange"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 2. Request headers mode:"}),e.jsx("p",{className:"text-dark-300",children:"A → B: sendheaders"}),e.jsx("p",{className:"text-dark-300",children:"B → A: sendheaders"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 3. When new block arrives at A:"}),e.jsx("p",{className:"text-amber-400",children:"A → B: headers(new block header)"}),e.jsx("p",{className:"text-dark-500",children:"Instead of: A → B: inv(block_hash)"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Header vs Inv Comparison"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"Inv-based (Old)"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"inv → getheaders → headers → getdata → block"}),e.jsx("li",{children:"4 round trips minimum"}),e.jsx("li",{children:"Higher latency"}),e.jsx("li",{children:"More messages"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Headers-based (BIP-130)"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"headers → getdata → block"}),e.jsx("li",{children:"2 round trips"}),e.jsx("li",{children:"Lower latency"}),e.jsx("li",{children:"Fewer messages"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Multiple New Blocks"}),e.jsx("p",{className:"mb-4",children:"When a peer catches up after being offline:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Single block:"})," Send one header in headers message"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Multiple blocks:"})," Send chain of headers (up to 2000)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Large gaps:"})," May require multiple headers messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Reorg:"})," Include headers back to common ancestor"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Integration with Compact Blocks"}),e.jsx("p",{className:"mb-4",children:"BIP-130 works well with BIP-152 compact blocks:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Optimal modern flow:"}),e.jsx("p",{className:"text-dark-300",children:"1. sendheaders + sendcmpct negotiated"}),e.jsx("p",{className:"text-dark-300",children:"2. New block at peer"}),e.jsx("p",{className:"text-amber-400",children:"3. Peer → Us: cmpctblock (header + short IDs)"}),e.jsx("p",{className:"text-dark-300",children:"4. Us: reconstruct block from mempool"}),e.jsx("p",{className:"text-dark-300",children:"5. If missing txs: getblocktxn → blocktxn"}),e.jsx("p",{className:"text-emerald-400 mt-2",children:"Often just 1 message for entire block!"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why It Matters"}),e.jsxs(s,{type:"info",title:"Block Propagation Speed",children:[e.jsx("p",{children:"Faster block propagation is critical for:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Reducing orphan/stale block rates"}),e.jsx("li",{children:"Improving mining fairness (less advantage for fast connections)"}),e.jsx("li",{children:"Network security (faster convergence on longest chain)"}),e.jsx("li",{children:"User experience (quicker confirmation awareness)"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Implementation"}),e.jsx(a,{title:"Node Behavior",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"After receiving sendheaders:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 font-mono text-xs",children:[e.jsx("p",{className:"text-dark-300",children:"peer.prefer_headers = true"}),e.jsx("p",{className:"text-dark-300 mt-2",children:"when new_block:"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"if peer.prefer_headers:"}),e.jsx("p",{className:"text-emerald-400 ml-8",children:"send headers(block.header)"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"else:"}),e.jsx("p",{className:"text-dark-300 ml-8",children:"send inv(block.hash)"})]})]})}),e.jsx(s,{type:"success",title:"Standard Practice",children:e.jsx("p",{children:"sendheaders is now universally used. All modern Bitcoin nodes send this message after connection, and all peers respond by announcing blocks via headers. It's a simple optimization that significantly improved block propagation network-wide."})})]})}export{p as default};
