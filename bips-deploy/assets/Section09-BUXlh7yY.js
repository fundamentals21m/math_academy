import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-CsKt80eB.js";import{L as r,C as s,D as i,E as t}from"./Callout-DTLGvo9K.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function h(){return e.jsxs(r,{sectionId:9,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Hiding Script Complexity"}),e.jsxs("p",{className:"mb-4",children:["Before BIP-16, complex spending conditions required embedding the entire script in the transaction output—making addresses long, ugly, and expensive. ",e.jsx("strong",{children:"Pay to Script Hash (P2SH)"})," revolutionized Bitcoin by allowing complex scripts to be represented by a simple, standard-length address."]}),e.jsx(s,{type:"info",title:"Activated: April 1, 2012",children:e.jsx("p",{children:"BIP-16 was one of the earliest soft forks, activating via miner voting (ISM) at block 173,805. It enabled the 3-prefix addresses still used today for multisig and wrapped SegWit."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Problem"}),e.jsx("p",{className:"mb-4",children:"In early Bitcoin, if Alice wanted to receive funds that required a 2-of-3 multisig, the sender had to include the full multisig script in the output:"}),e.jsxs("div",{className:"bg-dark-900 rounded-lg p-4 font-mono text-sm mb-6 overflow-x-auto",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Old style: scriptPubKey contains full script"}),e.jsx("p",{className:"text-amber-400",children:"OP_2 <pubkey1> <pubkey2> <pubkey3> OP_3 OP_CHECKMULTISIG"})]}),e.jsx("p",{className:"mb-4",children:"Problems with this approach:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mb-6 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Long addresses:"})," The address encoding all those pubkeys is huge"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Sender burden:"})," Sender pays fees for the recipient's complex script"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Privacy leak:"})," Everyone sees the spending conditions before they're used"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Inflexibility:"})," Hard to change script formats without changing addresses"]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The P2SH Solution"}),e.jsx(i,{title:"Pay to Script Hash (P2SH)",children:e.jsxs("p",{children:["Instead of embedding the full script, embed only a hash of it. The actual script (called the ",e.jsx("strong",{children:"redeemScript"}),') is revealed only when spending. The output just says "pay to whoever can provide a script that hashes to this value."']})}),e.jsx(t,{title:"P2SH Transaction Flow",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-l-4 border-blue-500 pl-4",children:[e.jsx("p",{className:"text-blue-400 font-semibold",children:"1. Receiver creates script"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Alice creates her multisig script (the redeemScript)"})]}),e.jsxs("div",{className:"border-l-4 border-purple-500 pl-4",children:[e.jsx("p",{className:"text-purple-400 font-semibold",children:"2. Compute hash"}),e.jsxs("p",{className:"text-sm text-dark-300",children:["Hash the script: ",e.jsx("code",{className:"text-amber-400",children:"HASH160(redeemScript)"})]})]}),e.jsxs("div",{className:"border-l-4 border-amber-500 pl-4",children:[e.jsx("p",{className:"text-amber-400 font-semibold",children:"3. Create address"}),e.jsx("p",{className:"text-sm text-dark-300",children:'Encode with version byte 0x05 → address starting with "3"'})]}),e.jsxs("div",{className:"border-l-4 border-emerald-500 pl-4",children:[e.jsx("p",{className:"text-emerald-400 font-semibold",children:"4. Sender pays to hash"}),e.jsxs("p",{className:"text-sm text-dark-300",children:["Output script: ",e.jsx("code",{className:"text-amber-400",children:"OP_HASH160 <hash> OP_EQUAL"})]})]}),e.jsxs("div",{className:"border-l-4 border-rose-500 pl-4",children:[e.jsx("p",{className:"text-rose-400 font-semibold",children:"5. Receiver spends"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Provides redeemScript + signatures satisfying it"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Script Evaluation"}),e.jsx("p",{className:"mb-4",children:"When spending a P2SH output, validation happens in two stages:"}),e.jsx("div",{className:"bg-dark-800 rounded-lg p-5 mb-6",children:e.jsxs("div",{className:"space-y-4 font-mono text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# Stage 1: Verify the hash matches"}),e.jsx("p",{className:"text-emerald-400",children:"scriptSig: <sig1> <sig2> <redeemScript>"}),e.jsx("p",{className:"text-amber-400",children:"scriptPubKey: OP_HASH160 <scriptHash> OP_EQUAL"}),e.jsx("p",{className:"text-dark-500 mt-1",children:"→ Check HASH160(redeemScript) == scriptHash"})]}),e.jsxs("div",{className:"border-t border-dark-700 pt-4",children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# Stage 2: Execute the redeemScript"}),e.jsx("p",{className:"text-emerald-400",children:"Stack: <sig1> <sig2>"}),e.jsx("p",{className:"text-amber-400",children:"Script: <redeemScript content>"}),e.jsx("p",{className:"text-dark-500 mt-1",children:"→ Run as if redeemScript was the original scriptPubKey"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Benefits Achieved"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Fixed Address Length"}),e.jsx("p",{className:"text-sm text-dark-300",children:"All P2SH addresses are 34 characters, regardless of script complexity"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Receiver Pays Fees"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Complex script only revealed when spending—receiver bears the byte cost"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Privacy Improved"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Spending conditions hidden until funds are spent"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Future Flexibility"}),e.jsx("p",{className:"text-sm text-dark-300",children:"New script types can be added without new address formats (up to a point)"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"P2SH Script Templates"}),e.jsx(t,{title:"Common P2SH Scripts",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-400 font-semibold",children:"Multisig (2-of-3)"}),e.jsx("p",{className:"text-sm text-dark-400 font-mono mt-1",children:"OP_2 <pk1> <pk2> <pk3> OP_3 OP_CHECKMULTISIG"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-400 font-semibold",children:"P2SH-P2WPKH (Wrapped SegWit)"}),e.jsx("p",{className:"text-sm text-dark-400 font-mono mt-1",children:"OP_0 <20-byte-pubkey-hash>"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-400 font-semibold",children:"Time-locked"}),e.jsx("p",{className:"text-sm text-dark-400 font-mono mt-1",children:"<time> OP_CHECKLOCKTIMEVERIFY OP_DROP OP_DUP OP_HASH160 ..."})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Limitations"}),e.jsx(s,{type:"warning",title:"P2SH Constraints",children:e.jsx("p",{children:"P2SH redeemScripts are limited to 520 bytes (the script push limit). This restricts the complexity of scripts that can be used. Additionally, the script is fully revealed when spent, which isn't ideal for privacy in some cases."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The OP_EVAL Alternative"}),e.jsx("p",{className:"mb-4",children:"Before P2SH, an alternative called OP_EVAL was proposed (BIP-12). It would evaluate scripts on the stack, providing similar functionality. It was rejected because:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mb-6 text-dark-300",children:[e.jsx("li",{children:"Turing-complete concerns: recursive script evaluation"}),e.jsx("li",{children:"DoS attack vectors: hard to bound execution time"}),e.jsx("li",{children:"Static analysis impossible: can't know script until execution"})]}),e.jsx("p",{className:"mb-4",children:"P2SH's two-stage evaluation was simpler and safer—the redeemScript is known before execution begins."}),e.jsx(s,{type:"success",title:"Lasting Impact",children:e.jsx("p",{children:`P2SH remains heavily used today. Most multisig wallets use P2SH addresses (starting with "3"). SegWit also relies on P2SH for backward-compatible wrapped addresses. The concept influenced later developments like Taproot's script commitments.`})})]})}export{h as default};
