import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as r,C as t,D as s,E as i}from"./Callout-Bm0ChKkk.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function x(){return e.jsxs(r,{sectionId:22,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"A Modern Scripting Language"}),e.jsxs("p",{className:"mb-4",children:["BIP-342 defines ",e.jsx("strong",{children:"Tapscript"}),"—the scripting rules for Taproot's script path spending. Tapscript updates Bitcoin Script with new opcodes, improved signature semantics, and hooks for future upgrades, while maintaining backward compatibility."]}),e.jsx(t,{type:"info",title:"Part of Taproot",children:e.jsx("p",{children:"BIP-342 activated with Taproot in November 2021. Tapscript applies only to scripts executed via the Taproot script path. Legacy scripts and SegWit v0 scripts are unaffected."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why Tapscript?"}),e.jsx("p",{className:"mb-4",children:"Original Bitcoin Script has accumulated technical debt. Tapscript provides a clean break:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"Legacy Script Issues"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"CHECKMULTISIG dummy bug"}),e.jsx("li",{children:"ECDSA malleability vectors"}),e.jsx("li",{children:"Disabled opcodes (wasted space)"}),e.jsx("li",{children:"No clean upgrade path"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Tapscript Solutions"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"New signature opcode (no dummy)"}),e.jsx("li",{children:"Schnorr signatures only"}),e.jsx("li",{children:"Unknown opcodes = OP_SUCCESS"}),e.jsx("li",{children:"Versioned leaf types"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Key Changes from Legacy"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx(s,{title:"Schnorr-Only Signatures",children:e.jsx("p",{children:"OP_CHECKSIG and OP_CHECKSIGVERIFY in Tapscript use 64-byte Schnorr signatures (BIP-340). ECDSA is not supported. This provides consistency and enables batch verification."})}),e.jsx(s,{title:"OP_CHECKSIGADD",children:e.jsx("p",{children:"A new opcode replacing OP_CHECKMULTISIG. Instead of checking multiple signatures at once with a dummy element, signatures are verified individually and a counter is incremented. Cleaner, more flexible, no dummy bug."})}),e.jsx(s,{title:"OP_SUCCESS",children:e.jsx("p",{children:'Previously disabled/invalid opcodes (OP_RESERVED, etc.) become "OP_SUCCESS"—they cause the script to immediately succeed. This allows future soft forks to give them new meanings without breaking old scripts.'})})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"OP_CHECKSIGADD"}),e.jsx("p",{className:"mb-4",children:"The replacement for OP_CHECKMULTISIG works incrementally:"}),e.jsx(i,{title:"Threshold Signatures with CHECKSIGADD",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-dark-300 mb-2",children:"2-of-3 multisig in Tapscript:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 font-mono text-sm overflow-x-auto",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Script"}),e.jsx("p",{className:"text-amber-400",children:"<pk1> CHECKSIG <pk2> CHECKSIGADD <pk3> CHECKSIGADD 2 EQUAL"}),e.jsx("p",{className:"text-dark-400 mt-3 mb-2",children:"# Witness (for signing with pk1 and pk3)"}),e.jsx("p",{className:"text-emerald-400",children:"<sig3> <sig1> <>"})]}),e.jsxs("div",{className:"text-dark-500 text-sm mt-2",children:[e.jsx("p",{children:"Stack evolution:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Check sig1 vs pk1 → push 1 (valid)"}),e.jsx("li",{children:"CHECKSIGADD: check sig (empty) vs pk2, add to counter → 1 + 0 = 1"}),e.jsx("li",{children:"CHECKSIGADD: check sig3 vs pk3, add → 1 + 1 = 2"}),e.jsx("li",{children:"2 EQUAL → success"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Signature Hash Improvements"}),e.jsx("p",{className:"mb-4",children:"BIP-342 extends the BIP-341 sighash to include additional commitments:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-xs mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Tapscript sighash additions"}),e.jsxs("ul",{className:"space-y-1 text-dark-300",children:[e.jsx("li",{children:"• tapleaf_hash (commits to the script being executed)"}),e.jsx("li",{children:"• key_version (0x00 for current BIP-342)"}),e.jsx("li",{children:"• codeseparator_position (if OP_CODESEPARATOR used)"})]}),e.jsx("p",{className:"text-dark-500 mt-3",children:"These prevent signatures from being valid in different script contexts."})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Resource Limits"}),e.jsx("p",{className:"mb-4",children:"Tapscript updates script limits for the witness discount era:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Limit"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Legacy"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Tapscript"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3",children:"Script size"}),e.jsx("td",{children:"10,000 bytes"}),e.jsx("td",{className:"text-emerald-400",children:"No limit*"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3",children:"Stack elements"}),e.jsx("td",{children:"1,000"}),e.jsx("td",{className:"text-emerald-400",children:"1,000"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3",children:"Element size"}),e.jsx("td",{children:"520 bytes"}),e.jsx("td",{className:"text-emerald-400",children:"520 bytes"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3",children:"Signature ops"}),e.jsx("td",{children:"Complex formula"}),e.jsx("td",{className:"text-emerald-400",children:"Per-byte budget"})]})]})]})}),e.jsx("p",{className:"text-dark-500 text-sm mb-6",children:"* Script size is limited by the overall block weight, not a fixed byte limit"}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Signature Operation Budget"}),e.jsx(s,{title:"SigOps Budget",children:e.jsx("p",{children:"Each Tapscript starts with a signature operation budget of 50 + (witness size / 50). Each CHECKSIG* consumes 1 sigop (or 0 if the signature is empty). This replaces legacy's complex sigop counting with a simpler, more predictable system."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Future Upgrades: OP_SUCCESS"}),e.jsx(t,{type:"success",title:"Soft Fork Ready",children:e.jsx("p",{children:"The OP_SUCCESS mechanism is clever: any currently-undefined opcode causes immediate success. This means a future soft fork can give that opcode real semantics—old nodes will still see the script as valid (it succeeds), while new nodes enforce the new rules."})}),e.jsx(i,{title:"Example Future Opcode",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{children:"Suppose we want to add OP_CTV (covenant opcode):"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-4",children:[e.jsx("li",{children:"Today: OP_NOP4 is OP_SUCCESS in Tapscript → script succeeds"}),e.jsx("li",{children:"Soft fork: Redefine OP_NOP4 as OP_CTV with covenant rules"}),e.jsx("li",{children:"Old nodes: Still see OP_SUCCESS → valid"}),e.jsx("li",{children:"New nodes: Enforce covenant semantics"})]}),e.jsx("p",{className:"text-amber-400 mt-2",children:"Clean upgrade path without breaking existing scripts!"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Leaf Versions"}),e.jsx("p",{className:"mb-4",children:"The control block includes a leaf version, allowing different script semantics:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Current leaf versions"}),e.jsx("p",{className:"text-amber-400",children:"0xc0 (even) / 0xc1 (odd parity): Tapscript (BIP-342)"}),e.jsx("p",{className:"text-dark-500",children:"Other versions: OP_SUCCESS (reserved for future)"})]}),e.jsx("p",{className:"text-dark-400 mb-6",children:"Future soft forks could define new leaf versions with entirely different scripting rules (e.g., Simplicity, CAT+, etc.) while keeping Tapscript unchanged."}),e.jsx(t,{type:"note",title:"Completing the Trilogy",children:e.jsx("p",{children:"BIP-340 (Schnorr), BIP-341 (Taproot), and BIP-342 (Tapscript) form a cohesive upgrade. Schnorr provides the signature scheme, Taproot the output structure, and Tapscript the execution rules. Together, they represent the most significant advancement in Bitcoin scripting since P2SH."})})]})}export{x as default};
