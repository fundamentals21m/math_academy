import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-CsKt80eB.js";import{L as t,C as s,D as a,E as i}from"./Callout-DTLGvo9K.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(t,{sectionId:10,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Preventing Duplicate Coinbase Transactions"}),e.jsx("p",{className:"mb-4",children:"BIP-34 solved a subtle but critical issue: without unique identifiers, two blocks could theoretically contain identical coinbase transactions. This soft fork requires the block height to be included in the coinbase, ensuring uniqueness."}),e.jsx(s,{type:"info",title:"Activated: March 2013",children:e.jsx("p",{children:"BIP-34 activated at block 227,835 via the IsSuperMajority mechanism, making it one of the earliest consensus-layer soft forks after P2SH."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Duplicate Transaction Problem"}),e.jsx("p",{className:"mb-4",children:"Each Bitcoin transaction has a unique identifier (txid) computed as the hash of its contents. But what about coinbase transactions?"}),e.jsx(a,{title:"Coinbase Transaction",children:e.jsx("p",{children:`The first transaction in every block, created by the miner. It has no inputs (or rather, a special "null" input) and outputs the block reward plus transaction fees. The miner can include arbitrary data in the coinbase's scriptSig.`})}),e.jsx("p",{className:"mb-4",children:"Before BIP-34, if two miners chose:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mb-6 text-dark-300",children:[e.jsx("li",{children:"The same coinbase scriptSig content (or none)"}),e.jsx("li",{children:"The same output addresses and amounts"}),e.jsx("li",{children:"Different blocks at different heights"})]}),e.jsxs("p",{className:"mb-4",children:["...their coinbase transactions would have ",e.jsx("strong",{children:"identical txids"}),". This created problems:"]}),e.jsx(i,{title:"The Duplicate Txid Problem",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{children:"Consider blocks at heights 91,842 and 91,880:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[e.jsxs("li",{children:["Both have coinbase transactions with txid ",e.jsx("code",{className:"text-amber-400",children:"d5d27987..."})]}),e.jsx("li",{children:"Block 91,880's coinbase overwrites 91,842's in the UTXO set"}),e.jsx("li",{children:"The 50 BTC from block 91,842 becomes unspendable!"})]}),e.jsx("p",{className:"text-amber-400 mt-2",children:"This actually happened—twice—before BIP-34."})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The BIP-34 Solution"}),e.jsx("p",{className:"mb-4",children:"BIP-34 requires the block height to be the first item in the coinbase scriptSig:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Coinbase scriptSig must begin with:"}),e.jsx("p",{className:"text-amber-400",children:"<block_height>"}),e.jsx("p",{className:"text-dark-500 mt-2",children:"Serialized as a minimally-encoded Script number (push opcode + little-endian bytes)"})]}),e.jsx("p",{className:"mb-4",children:"Since block heights are unique and increasing, this guarantees each coinbase transaction has a unique txid."}),e.jsx(i,{title:"Coinbase ScriptSig Example",children:e.jsxs("div",{className:"font-mono text-sm space-y-2",children:[e.jsx("p",{className:"text-dark-400",children:"# Block 710,000"}),e.jsxs("p",{children:[e.jsx("span",{className:"text-purple-400",children:"03"}),e.jsx("span",{className:"text-amber-400",children:"70d60a"}),e.jsx("span",{className:"text-dark-400",children:"..."})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"03 = push 3 bytes, 70d60a = 710,000 in little-endian"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Block Version 2"}),e.jsx("p",{className:"mb-4",children:"BIP-34 also introduced block version 2. Blocks with version ≥ 2 must include the height in their coinbase:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-gray-400 font-bold mb-2",children:"Version 1"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Original block format. Height in coinbase optional."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"Version 2+"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Must include height in coinbase. Required after BIP-34 activation."})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Activation via IsSuperMajority"}),e.jsx("p",{className:"mb-4",children:"BIP-34 used the original activation mechanism:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"space-y-3 text-dark-300",children:[e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-400 font-bold",children:"Phase 1:"}),e.jsx("span",{children:"750 of last 1000 blocks are v2 → v2 blocks must have height in coinbase"})]}),e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-400 font-bold",children:"Phase 2:"}),e.jsx("span",{children:"950 of last 1000 blocks are v2 → v1 blocks become invalid"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Connection to BIP-30"}),e.jsx(s,{type:"info",title:"BIP-30 Relationship",children:e.jsx("p",{children:"BIP-30 (2012) explicitly prohibited duplicate txids in the UTXO set. BIP-34 makes duplicate txids impossible for coinbase transactions going forward, providing a stronger guarantee. However, BIP-30 checks are still needed for the two historical duplicate transactions that predated BIP-34."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Practical Implications"}),e.jsx("p",{className:"mb-4",children:"For miners and pool operators:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mb-6 text-dark-300",children:[e.jsx("li",{children:"Must include height as first item in coinbase scriptSig"}),e.jsx("li",{children:"Height must be minimally encoded (no extra padding)"}),e.jsx("li",{children:"Additional data (pool tags, nonces) can follow the height"}),e.jsx("li",{children:"Total scriptSig limited to 100 bytes"})]}),e.jsx(i,{title:"Modern Coinbase Data",children:e.jsxs("div",{className:"space-y-2 text-dark-300",children:[e.jsx("p",{children:"A typical coinbase scriptSig contains:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Block height"})," (required by BIP-34)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Extra nonce"})," (for hash variance)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Pool identifier"}),' (e.g., "/Foundry USA/")']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Optional messages"})," (like Satoshi's famous Times headline)"]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why Not Just Use Timestamps?"}),e.jsx("p",{className:"mb-4",children:"Block timestamps aren't unique enough:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mb-6 text-dark-300",children:[e.jsx("li",{children:"Timestamps have ~2 hour tolerance for network time"}),e.jsx("li",{children:"Timestamps can move backward (within limits)"}),e.jsx("li",{children:"Multiple blocks could have the same timestamp"}),e.jsx("li",{children:"Block height is strictly monotonic—perfect uniqueness guarantee"})]}),e.jsx(s,{type:"success",title:"Foundation for Future BIPs",children:e.jsx("p",{children:"BIP-34's versioning system paved the way for later soft forks (BIP-66, BIP-65) that used increasing version numbers, eventually leading to BIP-9's version bits system. The height requirement also enabled relative timelocks (BIP-68) which reference block heights."})})]})}export{p as default};
