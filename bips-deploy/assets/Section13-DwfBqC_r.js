import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as a,C as s,D as i,E as t}from"./Callout-Bm0ChKkk.js";import{M as l}from"./MathBlock-fCav0pL3.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function u(){return e.jsxs(a,{sectionId:13,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Time Locks Relative to Confirmation"}),e.jsxs("p",{className:"mb-4",children:['While BIP-65 (CLTV) enables absolute time locks ("not before block 800,000"), BIP-68 enables ',e.jsx("strong",{children:"relative time locks"}),': "not until 100 blocks after this input was confirmed." This primitive is essential for bidirectional payment channels.']}),e.jsx(s,{type:"info",title:"Activated: July 2016",children:e.jsx("p",{children:"BIP-68 activated alongside BIP-112 (CSV) and BIP-113 (MTP) via BIP-9 version bits signaling—the first soft fork to use this modern activation mechanism."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why Relative Time Locks?"}),e.jsx("p",{className:"mb-4",children:"Absolute time locks have a limitation: you must know in advance when you want the lock to expire. But for payment channels, you need:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 mb-6",children:[e.jsx("p",{className:"text-dark-300 italic",children:'"If the channel is closed, wait 144 blocks before this refund transaction is valid."'}),e.jsx("p",{className:"text-dark-500 text-sm mt-2",children:"The 144-block delay starts from whenever the close happens—not a predetermined time."})]}),e.jsx(i,{title:"Relative Lock-Time",children:e.jsx("p",{children:'A lock expressed as "N blocks/seconds after the referenced output was confirmed." The lock period begins when the input being spent is mined, not at a fixed point in time.'})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The nSequence Field"}),e.jsxs("p",{className:"mb-4",children:["BIP-68 repurposes the ",e.jsx("code",{className:"text-amber-400",children:"nSequence"})," field of transaction inputs. Originally intended for transaction replacement (never fully implemented), it was mostly unused."]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# nSequence bit layout (32 bits)"}),e.jsxs("p",{className:"mb-2",children:[e.jsx("span",{className:"text-rose-400",children:"[bit 31: disable]"})," ",e.jsx("span",{className:"text-purple-400",children:"[bit 22: type]"})," ",e.jsx("span",{className:"text-dark-500",children:"[bits 23-30: unused]"})," ",e.jsx("span",{className:"text-amber-400",children:"[bits 0-15: value]"})]}),e.jsxs("div",{className:"text-xs text-dark-500 mt-3 space-y-1",children:[e.jsx("p",{children:"Bit 31 = 1: Disable relative lock-time (use legacy behavior)"}),e.jsx("p",{children:"Bit 31 = 0: Enable BIP-68 interpretation"}),e.jsx("p",{children:"Bit 22 = 0: Value is blocks"}),e.jsx("p",{children:"Bit 22 = 1: Value is 512-second intervals"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Lock Types"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-blue-500/30",children:[e.jsx("p",{className:"text-blue-400 font-bold mb-2",children:"Block-Based Lock"}),e.jsx("p",{className:"text-sm text-dark-300 mb-2",children:"Type flag = 0. Value is number of blocks."}),e.jsx("p",{className:"text-xs text-dark-500",children:"Maximum: 65,535 blocks (~455 days)"}),e.jsxs("div",{className:"mt-3 font-mono text-xs",children:[e.jsx("p",{className:"text-dark-400",children:"Example: 144 blocks"}),e.jsx("p",{className:"text-amber-400",children:"nSequence = 0x00000090"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-amber-500/30",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"Time-Based Lock"}),e.jsx("p",{className:"text-sm text-dark-300 mb-2",children:"Type flag = 1. Value is 512-second units."}),e.jsx("p",{className:"text-xs text-dark-500",children:"Maximum: 65,535 × 512s (~388 days)"}),e.jsxs("div",{className:"mt-3 font-mono text-xs",children:[e.jsx("p",{className:"text-dark-400",children:"Example: 1 day = 169 units"}),e.jsx("p",{className:"text-amber-400",children:"nSequence = 0x004000a9"})]})]})]}),e.jsx(t,{title:"Calculating Relative Lock",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-dark-300",children:"For a 1-day relative lock using time:"}),e.jsx(l,{children:"\\text{units} = \\left\\lceil \\frac{86400}{512} \\right\\rceil = 169"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"nSequence = 0x00400000 (type flag) | 169 = 0x004000a9"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Consensus Rule"}),e.jsx("p",{className:"mb-4",children:"BIP-68 adds a consensus rule: a transaction is invalid if any input has an nSequence indicating a relative lock-time that hasn't been satisfied."}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:[e.jsx("p",{className:"text-dark-300 mb-3",children:"For each input with BIP-68 enabled (bit 31 = 0):"}),e.jsxs("ul",{className:"space-y-2 text-dark-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400",children:"•"}),e.jsx("span",{children:"If type = blocks: current height - input confirmation height ≥ value"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-400",children:"•"}),e.jsx("span",{children:"If type = time: current MTP - input MTP ≥ value × 512"})]})]})]}),e.jsx(s,{type:"info",title:"What is MTP?",children:e.jsx("p",{children:"Median Time Past (BIP-113) is the median of the last 11 block timestamps. Using MTP instead of the current block's timestamp prevents miners from manipulating time-based locks by setting future timestamps."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Transaction-Level vs Script-Level"}),e.jsxs("p",{className:"mb-4",children:["BIP-68 enforces relative locks at the ",e.jsx("strong",{children:"transaction level"}),". To enforce them at the script level (so the output creator controls the lock), you need BIP-112's OP_CHECKSEQUENCEVERIFY—covered in the next section."]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-blue-400 font-bold mb-2",children:"BIP-68 (This BIP)"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Consensus interpretation of nSequence. Transaction creator sets the lock."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-purple-400 font-bold mb-2",children:"BIP-112 (CSV)"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Script opcode that verifies nSequence. Output creator enforces the lock."})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Use Cases"}),e.jsxs(t,{title:"Lightning Channel Penalty",children:[e.jsx("p",{className:"text-dark-300 mb-3",children:"In Lightning, if Alice tries to close a channel with an old state:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"Alice broadcasts outdated commitment transaction"}),e.jsx("li",{children:"Bob has a penalty transaction that spends Alice's output"}),e.jsx("li",{children:"Alice's output has a relative timelock (e.g., 144 blocks)"}),e.jsx("li",{children:"During this delay, Bob can broadcast the penalty and claim all funds"})]}),e.jsx("p",{className:"text-amber-400 mt-3 text-sm",children:"The relative lock gives Bob time to react without knowing when Alice will cheat."})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Backwards Compatibility"}),e.jsx("p",{className:"mb-4",children:"Transactions created before BIP-68 activation are unaffected because:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 mb-6 text-dark-300",children:[e.jsx("li",{children:"nSequence = 0xffffffff (common default) has bit 31 set → disabled"}),e.jsx("li",{children:"BIP-68 only applies to transaction version ≥ 2"}),e.jsx("li",{children:"Existing UTXOs aren't constrained—only new spending patterns"})]}),e.jsx(s,{type:"success",title:"The CSV Trilogy",children:e.jsx("p",{children:`BIP-68, BIP-112, and BIP-113 activated together as the "CSV soft fork"—the first coordinated deployment of multiple related BIPs. This package enabled the relative time locks essential for Lightning Network's trustless operation.`})})]})}export{u as default};
