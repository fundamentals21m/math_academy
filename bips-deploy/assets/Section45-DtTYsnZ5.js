import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-CsKt80eB.js";import{L as t,C as s,D as a,E as l}from"./Callout-DTLGvo9K.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(t,{sectionId:45,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-118: SIGHASH_ANYPREVOUT"}),e.jsx("p",{className:"mb-4",children:"BIP-118 proposes two new signature hash flags for Taproot: SIGHASH_ANYPREVOUT and SIGHASH_ANYPREVOUTANYSCRIPT. These enable signatures that can be rebound to different inputs, enabling simplified Lightning channel state management (Eltoo)."}),e.jsx(s,{type:"warning",title:"Proposal Status",children:e.jsx("p",{children:"BIP-118 is still a proposal and has not been activated. It requires a soft fork to implement. The concept was previously called SIGHASH_NOINPUT."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Problem"}),e.jsx("p",{className:"mb-4",children:"Current Lightning channels use penalty-based state updates:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-rose-500/30 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"Each state update creates new commitment transactions"}),e.jsx("li",{children:"Old states must be invalidated with revocation keys"}),e.jsx("li",{children:"If a party broadcasts old state, counterparty can take all funds"}),e.jsx("li",{children:"Requires storing every past state for potential penalties"}),e.jsx("li",{children:"Complex watchtower requirements"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Solution"}),e.jsxs(a,{title:"SIGHASH_ANYPREVOUT (APO)",children:[e.jsx("p",{children:"A signature that doesn't commit to the specific input being spent (the prevout). The same signature can be valid for multiple different UTXOs with the same script."}),e.jsxs("p",{className:"mt-2 text-dark-400",children:["Flag value: ",e.jsx("code",{className:"text-amber-400",children:"0x41"})," (ANYONECANPAY | 0x40)"]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Sighash Flag Comparison"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Flag"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Commits to"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Doesn't commit to"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono",children:"SIGHASH_ALL"}),e.jsx("td",{children:"All inputs, all outputs"}),e.jsx("td",{children:"—"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono",children:"ANYONECANPAY"}),e.jsx("td",{children:"One input, outputs"}),e.jsx("td",{children:"Other inputs"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"ANYPREVOUT"}),e.jsx("td",{children:"scriptPubKey, outputs"}),e.jsx("td",{children:"Input txid/vout"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"ANYPREVOUTANYSCRIPT"}),e.jsx("td",{children:"Outputs only"}),e.jsx("td",{children:"Input txid/vout, scriptPubKey"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Enabling Eltoo"}),e.jsx("p",{className:"mb-4",children:"ANYPREVOUT enables the Eltoo channel update mechanism:"}),e.jsx(l,{title:"Eltoo Channel Updates",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"Instead of penalty-based updates:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"State 0:"})," Funding TX creates channel output"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"State 1:"})," Update TX spends state 0 → state 1 output"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"State 2:"})," Update TX spends state 1 → state 2 output"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"..."})," Each state can spend any previous state"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Settlement:"})," After timeout, final state distributes funds"]})]}),e.jsx("p",{className:"text-dark-500 text-sm mt-3",children:"APO signatures let any update TX spend any prior state—the latest always wins"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why This Works"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Traditional signature commits to:"}),e.jsx("p",{className:"text-dark-300",children:"txid:vout → specific UTXO"}),e.jsx("p",{className:"text-rose-400 mt-1",children:"Can only spend ONE specific output"}),e.jsx("p",{className:"text-dark-400 mt-4 mb-2",children:"# ANYPREVOUT signature commits to:"}),e.jsx("p",{className:"text-dark-300",children:"scriptPubKey pattern → any matching UTXO"}),e.jsx("p",{className:"text-emerald-400 mt-1",children:"Can spend ANY output with same script"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Eltoo Benefits"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"LN-Penalty (Current)"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Store all past states"}),e.jsx("li",{children:"Complex revocation keys"}),e.jsx("li",{children:"Watchtowers need full history"}),e.jsx("li",{children:"Risk of losing revocation data"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Eltoo (with APO)"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Only store latest state"}),e.jsx("li",{children:"No revocation complexity"}),e.jsx("li",{children:"Watchtowers only need update TX"}),e.jsx("li",{children:"Symmetric protocol (simpler)"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Security Considerations"}),e.jsxs(s,{type:"warning",title:"Rebinding Risk",children:[e.jsx("p",{children:'APO signatures can be "rebound" to different UTXOs with the same script. This is intentional for Eltoo but dangerous if misused:'}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Never use APO for regular payments"}),e.jsx("li",{children:"Only use with carefully designed protocols"}),e.jsx("li",{children:"Outputs must be unique or intentionally rebindable"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Other Applications"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-1",children:"Channel Factories"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Multi-party channel constructions benefit from simplified state management."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-1",children:"Vaults"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Pre-signed recovery transactions that work regardless of which vault UTXO is being recovered."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-1",children:"Covenants"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Combined with other features, enables more flexible spending constraints."})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Implementation Details"}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-3",children:"BIP-118 specifies:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"Only valid for Taproot key-path and script-path spends"}),e.jsx("li",{children:"Requires new public key prefix byte (0x01) to opt-in"}),e.jsx("li",{children:"Combines with existing sighash flags (ALL, NONE, SINGLE)"}),e.jsx("li",{children:"ANYPREVOUTANYSCRIPT also skips the scriptPubKey commitment"})]})]}),e.jsx(s,{type:"success",title:"The Future of Lightning",children:e.jsx("p",{children:"SIGHASH_ANYPREVOUT would significantly simplify Lightning Network implementations and enable new Layer 2 protocols. While still a proposal, it represents one of the most anticipated potential upgrades to Bitcoin's scripting capabilities."})})]})}export{p as default};
