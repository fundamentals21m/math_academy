import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as i,C as s,D as t,E as l}from"./Callout-Bm0ChKkk.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(i,{sectionId:39,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Dealing with Malleability"}),e.jsx("p",{className:"mb-4",children:"BIP-62 was an ambitious attempt to eliminate transaction malleability in Bitcoin. While never fully activated, it cataloged the malleability vectors and influenced SegWit's design, which ultimately solved the problem more completely."}),e.jsx(s,{type:"warning",title:"Superseded by SegWit",children:e.jsx("p",{children:"BIP-62 was withdrawn. SegWit (BIP-141) addresses malleability more comprehensively by moving signatures outside the transaction hash. However, BIP-62's analysis remains valuable for understanding the problem space."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"What is Malleability?"}),e.jsx(t,{title:"Transaction Malleability",children:e.jsx("p",{children:'A transaction is "malleable" if its txid can be changed without invalidating the transaction. This happens when components not covered by signatures (like the signatures themselves) can be modified while keeping the transaction valid.'})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why It Matters"}),e.jsx("p",{className:"mb-4",children:"Malleability causes serious problems:"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"Chained Transaction Breakage"}),e.jsx("p",{className:"text-sm text-dark-300",children:"If TX_A is malleated before confirmation, any TX_B spending TX_A's output becomes invalid—TX_B references the wrong txid."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"Lightning/Payment Channels"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Pre-signed refund transactions reference specific txids. If the funding transaction is malleated, the refunds become useless."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"Exchange Fraud"}),e.jsx("p",{className:"text-sm text-dark-300",children:'Attackers claimed withdrawals "failed" after malleating them. The exchange paid twice because they tracked by txid.'})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Malleability Vectors"}),e.jsx("p",{className:"mb-4",children:"BIP-62 identified numerous malleability sources:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Vector"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Description"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Fix"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3",children:"Non-DER signatures"}),e.jsx("td",{children:"Multiple valid encodings for same sig"}),e.jsx("td",{children:"BIP-66 strict DER"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3",children:"High-S signatures"}),e.jsx("td",{children:"Both S and -S are valid"}),e.jsx("td",{children:"Low-S requirement"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3",children:"ScriptSig push sizes"}),e.jsx("td",{children:"Multiple ways to push same data"}),e.jsx("td",{children:"Minimal push encoding"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3",children:"CHECKMULTISIG dummy"}),e.jsx("td",{children:"Dummy element can be any value"}),e.jsx("td",{children:"BIP-147 NULLDUMMY"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3",children:"Sighash flags"}),e.jsx("td",{children:"Non-signing parties can modify"}),e.jsx("td",{children:"SegWit"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"BIP-62 Proposals"}),e.jsx(l,{title:"Proposed Rules",children:e.jsxs("div",{className:"space-y-2 text-dark-300",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"BIP-62 proposed these standardness rules:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Non-push operations in scriptSig forbidden"}),e.jsx("li",{children:"Push operations must use minimal encoding"}),e.jsx("li",{children:"Signature encoding must be strict DER"}),e.jsx("li",{children:"Signature S values must be low (≤ n/2)"}),e.jsx("li",{children:"CHECKMULTISIG dummy must be empty"}),e.jsx("li",{children:"OP_IF/NOTIF arguments must be minimal"}),e.jsx("li",{children:"No unnecessary stack elements"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why BIP-62 Failed"}),e.jsx("p",{className:"mb-4",children:"BIP-62 was ultimately withdrawn for several reasons:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Incomplete:"})," Third-party malleability couldn't be fully eliminated without protocol changes"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Complexity:"})," Many rules, each addressing one vector—easy to miss some"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"ANYONECANPAY:"})," Signatures using this flag can't prevent scriptSig modifications"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"SegWit superior:"})," Moving signatures out of txid calculation solved the root problem elegantly"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"SegWit's Solution"}),e.jsx("p",{className:"mb-4",children:"SegWit eliminated malleability by fundamental redesign:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"Legacy (Malleable)"}),e.jsxs("div",{className:"text-sm text-dark-300 font-mono",children:[e.jsx("p",{children:"txid = hash(version + inputs + outputs + locktime)"}),e.jsx("p",{className:"text-dark-500 mt-1",children:"inputs include signatures!"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"SegWit (Non-malleable)"}),e.jsxs("div",{className:"text-sm text-dark-300 font-mono",children:[e.jsx("p",{children:"txid = hash(version + inputs + outputs + locktime)"}),e.jsx("p",{className:"text-emerald-400 mt-1",children:"inputs have empty scriptSigs!"})]})]})]}),e.jsxs(s,{type:"info",title:"Partial Adoption",children:[e.jsx("p",{children:"Several BIP-62 rules were adopted independently:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"BIP-66:"})," Strict DER signature encoding"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"BIP-147:"})," NULLDUMMY for SegWit scripts"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Policy:"})," Low-S signatures required for relay"]})]})]}),e.jsx(s,{type:"success",title:"Historical Significance",children:e.jsx("p",{children:"While BIP-62 itself was never activated, its thorough analysis of malleability vectors was essential. It demonstrated why a comprehensive solution like SegWit was needed and influenced Bitcoin's security improvements for years."})})]})}export{p as default};
