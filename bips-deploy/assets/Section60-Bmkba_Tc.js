import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as t,C as s,D as i,E as n}from"./Callout-Bm0ChKkk.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function h(){return e.jsxs(t,{sectionId:60,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-31: Pong Message"}),e.jsx("p",{className:"mb-4",children:"BIP-31 introduced the pong message as a response to ping, enabling nodes to test connection liveness and measure latency. This simple addition significantly improved network reliability and peer management."}),e.jsx(s,{type:"info",title:"Connection Health",children:e.jsx("p",{children:"Before BIP-31, nodes had no reliable way to test if a peer was responsive. Connections could become stale without detection, wasting resources."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Problem"}),e.jsx("p",{className:"mb-4",children:"Without pong messages:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-rose-500/30 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"No way to measure connection latency"}),e.jsx("li",{children:"Stale connections not detected until data transfer fails"}),e.jsx("li",{children:"Resources wasted on unresponsive peers"}),e.jsx("li",{children:"Difficulty distinguishing slow from dead connections"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Ping/Pong Protocol"}),e.jsx(i,{title:"Ping/Pong Messages",children:e.jsx("p",{children:"A ping message contains a random nonce. The peer responds with a pong containing the same nonce. Matching nonces prove the response is for that specific ping."})}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Ping message:"}),e.jsx("p",{className:"text-dark-300",children:'command: "ping"'}),e.jsx("p",{className:"text-amber-400",children:"nonce: 0x0102030405060708 (random 8 bytes)"}),e.jsx("p",{className:"text-dark-400 mt-4 mb-2",children:"# Pong response:"}),e.jsx("p",{className:"text-dark-300",children:'command: "pong"'}),e.jsx("p",{className:"text-amber-400",children:"nonce: 0x0102030405060708 (same as ping)"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Message Flow"}),e.jsx(n,{title:"Ping/Pong Exchange",children:e.jsxs("div",{className:"space-y-3 font-mono text-xs",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Time: 0ms"}),e.jsx("p",{className:"text-dark-300",children:"Node A → Node B: ping(nonce=12345)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Time: 50ms"}),e.jsx("p",{className:"text-dark-300",children:"Node B → Node A: pong(nonce=12345)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Result:"}),e.jsx("p",{className:"text-emerald-400",children:"Round-trip latency: 50ms"}),e.jsx("p",{className:"text-emerald-400",children:"Connection: alive"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Latency Measurement"}),e.jsx("p",{className:"mb-4",children:"Ping/pong enables accurate latency measurement:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Round-trip time:"})," Measure time from ping sent to pong received"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Network distance:"})," Estimate peer geographic/network proximity"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Congestion detection:"})," Monitor latency changes over time"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Peer selection:"})," Prefer lower-latency peers for time-sensitive data"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Timeout Handling"}),e.jsx("p",{className:"mb-4",children:"Nodes disconnect peers that don't respond to pings:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Bitcoin Core default behavior:"}),e.jsx("p",{className:"text-dark-300",children:"Send ping every ~2 minutes (quiet periods)"}),e.jsx("p",{className:"text-dark-300",children:"Timeout: 20 minutes without any message"}),e.jsx("p",{className:"text-dark-300",children:"If pong not received for 20+ minutes → disconnect"}),e.jsx("p",{className:"text-dark-500 mt-3",children:"Ensures connections are actually usable"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why the Nonce?"}),e.jsxs(s,{type:"info",title:"Nonce Purpose",children:[e.jsx("p",{children:"The nonce ensures you're measuring the right response:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Multiple pings can be in-flight simultaneously"}),e.jsx("li",{children:"Match pong to specific ping for accurate timing"}),e.jsx("li",{children:"Detect if peer responds to wrong ping (implementation bug)"}),e.jsx("li",{children:"Prevent replay attacks in latency measurements"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Protocol Version"}),e.jsx("p",{className:"mb-4",children:"BIP-31 added pong in protocol version 60001:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"Before 60001"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Ping message existed (empty)"}),e.jsx("li",{children:"No response expected"}),e.jsx("li",{children:"Limited utility"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"Protocol 60001+"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Ping includes nonce"}),e.jsx("li",{children:"Pong response with same nonce"}),e.jsx("li",{children:"Full liveness testing"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Implementation"}),e.jsx(n,{title:"Simple Ping/Pong Logic",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"Node behavior:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 font-mono text-xs",children:[e.jsx("p",{className:"text-emerald-400",children:"# On receiving ping:"}),e.jsx("p",{className:"text-dark-300",children:'if msg.command == "ping":'}),e.jsx("p",{className:"text-dark-500 ml-4",children:"send pong(nonce=msg.nonce)"}),e.jsx("p",{className:"text-emerald-400 mt-2",children:"# On sending ping:"}),e.jsx("p",{className:"text-dark-300",children:"nonce = random_bytes(8)"}),e.jsx("p",{className:"text-dark-300",children:"ping_sent_time[nonce] = now()"}),e.jsx("p",{className:"text-dark-300",children:"send ping(nonce)"}),e.jsx("p",{className:"text-emerald-400 mt-2",children:"# On receiving pong:"}),e.jsx("p",{className:"text-dark-300",children:"latency = now() - ping_sent_time[msg.nonce]"})]})]})}),e.jsx(s,{type:"success",title:"Simple but Essential",children:e.jsx("p",{children:"BIP-31 is one of the simplest BIPs—just adding a response message—but it's essential for network health. Every modern Bitcoin implementation uses ping/pong for connection management, making the network more robust and efficient."})})]})}export{h as default};
