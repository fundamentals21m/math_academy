import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as i,C as s,D as n,E as t}from"./Callout-Bm0ChKkk.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(i,{sectionId:46,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-119: OP_CHECKTEMPLATEVERIFY"}),e.jsx("p",{className:"mb-4",children:"BIP-119 proposes OP_CHECKTEMPLATEVERIFY (CTV), a new opcode that constrains how an output can be spent by committing to a hash of the spending transaction's template. This enables covenants—outputs that restrict their own future spending conditions."}),e.jsx(s,{type:"warning",title:"Proposal Status",children:e.jsx("p",{children:"CTV is still a proposal and has not been activated. It's one of the most discussed covenant proposals due to its simplicity and powerful applications."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"What is a Covenant?"}),e.jsxs(n,{title:"Covenant",children:[e.jsx("p",{children:"A covenant is a spending condition that restricts not just WHO can spend an output, but HOW it can be spent—constraining the outputs of the spending transaction itself."}),e.jsx("p",{className:"mt-2 text-dark-400",children:'Think of it as: "This UTXO can only be spent if the spending TX looks exactly like this."'})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"How CTV Works"}),e.jsx("p",{className:"mb-4",children:"CTV commits to a hash of the transaction template (outputs, locktime, etc.):"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Script using CTV:"}),e.jsx("p",{className:"text-amber-400",children:"<template_hash> OP_CHECKTEMPLATEVERIFY"}),e.jsx("p",{className:"text-dark-500 mt-3",children:"Only succeeds if spending TX matches the committed template"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Template Hash Computation"}),e.jsx("p",{className:"mb-4",children:"The template hash commits to specific transaction fields:"}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-3",children:"DefaultCheckTemplateVerifyHash includes:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"nVersion:"})," Transaction version"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"nLockTime:"})," Transaction locktime"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"scriptSig hash:"})," Hash of all scriptSigs (usually empty)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"input count:"})," Number of inputs"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"sequences hash:"})," Hash of all input sequences"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"output count:"})," Number of outputs"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"outputs hash:"})," Hash of all outputs"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"input index:"})," Which input is being spent"]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Key Properties"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"What CTV Commits To"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Output amounts and scripts"}),e.jsx("li",{children:"Number of inputs/outputs"}),e.jsx("li",{children:"Transaction locktime"}),e.jsx("li",{children:"Input sequence numbers"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"What CTV Doesn't Commit To"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Input txids (which UTXOs)"}),e.jsx("li",{children:"Input amounts"}),e.jsx("li",{children:"Witness data"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Application: Vaults"}),e.jsx(t,{title:"CTV Vault Construction",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"A secure custody solution with spending delays:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Cold UTXO:"})," Contains CTV committing to unvaulting TX"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unvault:"})," Spending creates time-locked output (24-hour delay)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Wait period:"})," Owner can cancel to recovery address if compromised"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Complete:"})," After delay, funds move to hot wallet"]})]})]})}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-xs mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Vault flow:"}),e.jsx("p",{className:"text-dark-300",children:"Cold Storage"}),e.jsx("p",{className:"text-dark-500",children:"  └─ CTV: must create [hot_output + timelock_recovery]"}),e.jsx("p",{className:"text-dark-300 mt-2",children:"Unvaulting TX"}),e.jsx("p",{className:"text-dark-500",children:"  ├─ Hot wallet (spendable after 144 blocks)"}),e.jsx("p",{className:"text-dark-500",children:"  └─ Recovery (spendable immediately with backup key)"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Application: Congestion Control"}),e.jsx(t,{title:"Payment Batching with CTV",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{children:"During high-fee periods, commit to future transactions without broadcasting them:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 mt-3 font-mono text-xs",children:[e.jsx("p",{className:"text-dark-400 mb-1",children:"# Single on-chain TX:"}),e.jsx("p",{className:"text-dark-300",children:"Output: CTV committing to 100 individual payments"}),e.jsx("p",{className:"text-dark-400 mt-2 mb-1",children:"# Later, when fees are lower:"}),e.jsx("p",{className:"text-dark-300",children:"Expand into 100 actual payment outputs"})]}),e.jsx("p",{className:"text-dark-500 text-sm mt-2",children:"Recipients have cryptographic proof their payment is committed"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Application: Non-Interactive Channels"}),e.jsx("p",{className:"mb-4",children:"CTV enables creating Lightning channel funding outputs without both parties online:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"Sender creates CTV output committing to channel structure"}),e.jsx("li",{children:"Receiver can claim at any time, no interactive signing needed"}),e.jsx("li",{children:'Enables "just-in-time" channel creation'}),e.jsx("li",{children:"Simplifies Lightning onboarding"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why CTV is Controversial"}),e.jsxs(s,{type:"warning",title:"Covenant Concerns",children:[e.jsx("p",{children:"Some argue covenants could enable:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:'"Tainted" coins that can only be spent to approved addresses'}),e.jsx("li",{children:"Government-mandated spending restrictions"}),e.jsx("li",{children:"Reduced fungibility of Bitcoin"})]}),e.jsx("p",{className:"mt-2",children:"CTV proponents note these concerns apply to multisig too, and CTV's constraints are opt-in and limited in scope."})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"CTV vs Other Covenants"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Proposal"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Flexibility"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Complexity"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"CTV (BIP-119)"}),e.jsx("td",{children:"Fixed template only"}),e.jsx("td",{children:"Simple, well-understood"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono",children:"APO (BIP-118)"}),e.jsx("td",{children:"Rebindable signatures"}),e.jsx("td",{children:"Moderate"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono",children:"OP_VAULT"}),e.jsx("td",{children:"Vault-specific"}),e.jsx("td",{children:"Purpose-built"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-mono",children:"CAT + CHECKSIGFROMSTACK"}),e.jsx("td",{children:"General covenants"}),e.jsx("td",{children:"Very flexible, complex"})]})]})]})}),e.jsx(s,{type:"success",title:"Simple But Powerful",children:e.jsx("p",{children:"CTV's strength is its simplicity: one opcode, one hash, clear semantics. While not as flexible as general covenant proposals, it enables important use cases like vaults, congestion control, and channel factories with minimal complexity."})})]})}export{p as default};
