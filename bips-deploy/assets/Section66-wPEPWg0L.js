import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as i,C as s,D as l,E as t}from"./Callout-Bm0ChKkk.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function p(){return e.jsxs(i,{sectionId:66,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-133: feefilter Message"}),e.jsx("p",{className:"mb-4",children:"BIP-133 introduced the feefilter message, allowing nodes to tell peers the minimum fee rate for transactions they want to receive. This reduces bandwidth waste by preventing announcement of transactions that will just be rejected."}),e.jsx(s,{type:"info",title:"Bandwidth Optimization",children:e.jsx("p",{children:"Without feefilter, nodes receive inv messages for low-fee transactions they'll reject anyway. feefilter lets nodes proactively communicate their fee floor."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Problem"}),e.jsx("p",{className:"mb-4",children:"Without fee filtering, bandwidth is wasted:"}),e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-rose-500/30 mb-6",children:[e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"Node A relays low-fee transaction inv to Node B"}),e.jsx("li",{children:"Node B requests the transaction with getdata"}),e.jsx("li",{children:"Node A sends the full transaction"}),e.jsx("li",{children:"Node B rejects it (below mempool min fee)"}),e.jsx("li",{children:"Bandwidth wasted on both sides"})]}),e.jsx("p",{className:"text-rose-400 text-sm mt-3",children:"During high-fee periods, this happens constantly!"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The feefilter Message"}),e.jsxs(l,{title:"feefilter",children:[e.jsx("p",{children:"A message containing a single value: the minimum fee rate (in satoshis per kilobyte) that a node wants to receive transaction announcements for."}),e.jsx("div",{className:"font-mono text-sm text-amber-400 mt-3",children:"feefilter: 1000 (= 1 sat/vbyte minimum)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Message format:"}),e.jsx("p",{className:"text-dark-300",children:'command: "feefilter"'}),e.jsx("p",{className:"text-amber-400",children:"feerate: uint64 (satoshis per 1000 bytes)"}),e.jsx("p",{className:"text-dark-500 mt-3",children:"1000 sat/kvB = 1 sat/vB (common minimum relay fee)"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Protocol Flow"}),e.jsx(t,{title:"feefilter in Action",children:e.jsxs("div",{className:"space-y-3 font-mono text-xs",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 1. Node B's mempool is filling up:"}),e.jsx("p",{className:"text-dark-300",children:"min_mempool_fee = 5000 sat/kvB (5 sat/vB)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 2. Node B tells Node A:"}),e.jsx("p",{className:"text-amber-400",children:"B → A: feefilter(5000)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 3. Node A gets 2 sat/vB transaction:"}),e.jsx("p",{className:"text-emerald-400",children:"A: Skip inv to B (below B's filter)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 4. Node A gets 10 sat/vB transaction:"}),e.jsx("p",{className:"text-dark-300",children:"A → B: inv(txid)"}),e.jsx("p",{className:"text-dark-500",children:"Above filter, announce normally"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Dynamic Updates"}),e.jsx("p",{className:"mb-4",children:"The feefilter value changes as mempool conditions change:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Mempool fills:"})," Raise feefilter to minimum accepted fee"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Block mined:"})," May lower feefilter as mempool empties"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mempool clears:"})," Reset to static minimum relay fee"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Periodic updates:"})," Sent when threshold changes significantly"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Implementation Details"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Bitcoin Core behavior:"}),e.jsx("p",{className:"text-dark-300",children:"- Send feefilter after version/verack"}),e.jsx("p",{className:"text-dark-300",children:"- Update when mempool min fee changes > 10%"}),e.jsx("p",{className:"text-dark-300",children:"- Add random delay to updates (privacy)"}),e.jsx("p",{className:"text-dark-300",children:"- Poisson-distributed timing between updates"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Privacy Considerations"}),e.jsxs(s,{type:"warning",title:"Fingerprinting Risk",children:[e.jsx("p",{children:"Exact feefilter values could fingerprint nodes (reveal mempool size/config). Mitigations include:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Randomized update timing"}),e.jsx("li",{children:"Not sending for small changes"}),e.jsx("li",{children:"Quantizing to reduce precision"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Bandwidth Savings"}),e.jsx("p",{className:"mb-4",children:"feefilter significantly reduces unnecessary traffic:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"Without feefilter"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Receive all tx invs"}),e.jsx("li",{children:"Request txs blindly"}),e.jsx("li",{children:"Reject after download"}),e.jsx("li",{children:"Wasted bandwidth"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"With feefilter"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Only relevant invs"}),e.jsx("li",{children:"Request useful txs only"}),e.jsx("li",{children:"Minimal rejection"}),e.jsx("li",{children:"Efficient bandwidth"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Sender Behavior"}),e.jsx(t,{title:"Respecting feefilter",children:e.jsxs("div",{className:"space-y-3 text-dark-300",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"When relaying transactions:"}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 font-mono text-xs",children:[e.jsx("p",{className:"text-dark-300",children:"for peer in peers:"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"if tx.feerate >= peer.feefilter:"}),e.jsx("p",{className:"text-emerald-400 ml-8",children:"send inv(tx) to peer"}),e.jsx("p",{className:"text-dark-500 ml-4",children:"else:"}),e.jsx("p",{className:"text-rose-400 ml-8",children:"skip  # Below their threshold"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Related BIPs"}),e.jsx("p",{className:"mb-4",children:"feefilter works alongside other transaction relay optimizations:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"BIP-130 (sendheaders):"})," Efficient block announcements"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"BIP-152 (compact blocks):"})," Efficient block transfer"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"BIP-330 (Erlay):"})," Efficient tx announcement reconciliation"]})]})}),e.jsx(s,{type:"success",title:"Essential Optimization",children:e.jsx("p",{children:"feefilter is especially valuable during high-fee periods when mempools fill. It prevents a cascade of useless traffic as nodes announce transactions that peers can't accept. Simple in concept, highly effective in practice."})})]})}export{p as default};
