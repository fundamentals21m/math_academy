import{j as e}from"./vendor-animation-CmxkKU9r.js";import"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-BjhgI7Zp.js";import{L as t,C as s,D as r,E as l}from"./Callout-Bm0ChKkk.js";import"./vendor-firebase-functions-DDqfDrvm.js";import"./vendor-firebase-core-CzRQL6VN.js";import"./vendor-firebase-auth-C4l3lITM.js";import"./quizMap-C7tZlcUA.js";function b(){return e.jsxs(t,{sectionId:62,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"BIP-37: Bloom Filtering (Deprecated)"}),e.jsx("p",{className:"mb-4",children:"BIP-37 introduced Bloom filters for lightweight clients to request transactions matching specific patterns without downloading all transactions. While innovative, it was deprecated due to privacy and denial-of-service concerns."}),e.jsx(s,{type:"warning",title:"Deprecated Standard",children:e.jsx("p",{children:"BIP-37 is deprecated. Most full nodes disable it by default (NODE_BLOOM service bit off). BIP-157/158 compact block filters are the recommended alternative."})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Goal"}),e.jsx("p",{className:"mb-4",children:"BIP-37 aimed to help SPV (lightweight) clients efficiently find relevant transactions:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsx("li",{children:"Download only transactions affecting user's addresses"}),e.jsx("li",{children:"Avoid downloading full blocks"}),e.jsx("li",{children:"Reduce bandwidth for mobile/constrained devices"}),e.jsx("li",{children:"Still validate transactions with SPV proof"})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Bloom Filter Basics"}),e.jsx(r,{title:"Bloom Filter",children:e.jsx("p",{children:"A probabilistic data structure that can test whether an element is in a set. It may produce false positives (saying something matches when it doesn't) but never false negatives (missing actual matches)."})}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-5 font-mono text-sm mb-6",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# Bloom filter properties:"}),e.jsx("p",{className:"text-dark-300",children:"• Compact representation of a set"}),e.jsx("p",{className:"text-dark-300",children:"• False positives possible (tunable rate)"}),e.jsx("p",{className:"text-dark-300",children:"• No false negatives (guaranteed matches)"}),e.jsx("p",{className:"text-dark-300",children:"• Cannot remove elements"}),e.jsx("p",{className:"text-dark-500 mt-3",children:"Trade-off: Smaller filter = more false positives"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Protocol Messages"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Message"}),e.jsx("th",{className:"text-left py-3 text-dark-300",children:"Purpose"})]})}),e.jsxs("tbody",{className:"text-dark-400",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"filterload"}),e.jsx("td",{children:"Set the Bloom filter for this connection"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"filteradd"}),e.jsx("td",{children:"Add elements to existing filter"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"filterclear"}),e.jsx("td",{children:"Remove filter, receive all transactions"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3 font-mono text-amber-400",children:"merkleblock"}),e.jsx("td",{children:"Block header + Merkle proof for matching txs"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"How It Worked"}),e.jsx(l,{title:"BIP-37 SPV Flow",children:e.jsxs("div",{className:"space-y-3 font-mono text-xs",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 1. Client creates filter with addresses:"}),e.jsx("p",{className:"text-dark-300",children:"filter = bloom_filter(addr1, addr2, addr3)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 2. Send filter to peer:"}),e.jsx("p",{className:"text-dark-300",children:"client → server: filterload(filter)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 3. Request blocks:"}),e.jsx("p",{className:"text-dark-300",children:"client → server: getdata(block_hash)"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 mb-2",children:"# 4. Server sends filtered response:"}),e.jsx("p",{className:"text-dark-300",children:"server → client: merkleblock(header + proof)"}),e.jsx("p",{className:"text-dark-300",children:"server → client: tx(matching transactions)"})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Why It Was Deprecated"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"Privacy Leak"}),e.jsx("p",{className:"text-sm text-dark-300",children:"The filter reveals which addresses the client cares about. A malicious peer can analyze the filter to determine the client's addresses with high accuracy."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"DoS Vector"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Clients can send filters requiring expensive computation. A node must test every transaction against every connected client's filter—easily abused."})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-bold mb-2",children:"Asymmetric Cost"}),e.jsx("p",{className:"text-sm text-dark-300",children:"The server does most of the work (filtering), while the client just sends a small filter. This inverts the normal cost model."})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"NODE_BLOOM Service Bit"}),e.jsx("p",{className:"mb-4",children:"BIP-111 added a service bit so nodes can advertise Bloom filter support:"}),e.jsx("div",{className:"bg-dark-800/50 rounded-xl p-6 border border-dark-700/50 mb-6",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-dark-300",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"NODE_BLOOM (1 << 2):"})," Node will process Bloom filter messages"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Default off:"})," Most nodes don't advertise this anymore"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"-peerbloomfilters:"})," Bitcoin Core option to enable/disable"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Modern Alternatives"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4 border border-emerald-500/30",children:[e.jsx("p",{className:"text-emerald-400 font-bold mb-2",children:"BIP-157/158 (Recommended)"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Server creates deterministic filters"}),e.jsx("li",{children:"Client downloads and checks locally"}),e.jsx("li",{children:"No privacy leak to server"}),e.jsx("li",{children:"Server cost bounded"})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-amber-400 font-bold mb-2",children:"Electrum Protocol"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"Query by address/script hash"}),e.jsx("li",{children:"Trusted server model"}),e.jsx("li",{children:"Simple implementation"}),e.jsx("li",{children:"Privacy depends on server"})]})]})]}),e.jsx(s,{type:"success",title:"Lessons Learned",children:e.jsx("p",{children:"BIP-37's failure taught important lessons: protocols should minimize what clients reveal to servers, and computation costs should be borne by the party making requests. BIP-157/158's design explicitly addresses these issues by having the server create filters and the client do the filtering work locally."})})]})}export{b as default};
