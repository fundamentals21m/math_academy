import{j as e}from"./vendor-animation-CmxkKU9r.js";import{r as p}from"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-kiSjkdV0.js";import{L as $}from"./LessonLayout-CHKUuuLC.js";import{I as x,M as w}from"./MathBlock-fCav0pL3.js";import{D as y,E as q}from"./ContentBlocks-DZ6IdIC2.js";import{C as T}from"./Callout-CP2-VZ-C.js";import"./quizMap-DVBi0JFt.js";const g=[10,50,100,500,1e3],N={good:.02,marginal:.05};function z(t,j){let i=0;for(let b=0;b<t;b++)Math.random()<j&&i++;return i}function D(t){const j=t.length;if(j===0)return{mean:0,stdDev:0,cv:0};const i=t.reduce((n,f)=>n+f,0)/j,b=t.reduce((n,f)=>n+Math.pow(f-i,2),0)/j,d=Math.sqrt(b),v=i>0?d/i:0;return{mean:i,stdDev:d,cv:v}}function F(t){return t<N.good?{bg:"bg-emerald-500/20",text:"text-emerald-400",label:"Stable"}:t<N.marginal?{bg:"bg-yellow-500/20",text:"text-yellow-400",label:"Marginal"}:{bg:"bg-red-500/20",text:"text-red-400",label:"Volatile"}}function V(t){return t<N.good?{text:"Yes",color:"text-emerald-400"}:t<N.marginal?{text:"Marginal",color:"text-yellow-400"}:{text:"No",color:"text-red-400"}}function E(){const[t,j]=p.useState(100),[i,b]=p.useState(500),[d,v]=p.useState(.02),[n,f]=p.useState(null),[M,P]=p.useState(!1),R=p.useCallback(()=>{P(!0),setTimeout(()=>{const a=[];for(let r=0;r<i;r++){const u=z(t,d),m=t-u,k=m>0?100*(t/m):0;a.push(k)}const o=D(a);f({payouts:a,mean:o.mean,stdDev:o.stdDev,cv:o.cv}),P(!1)},10)},[t,i,d]),c=p.useMemo(()=>{if(!n)return null;const{payouts:s}=n,a=Math.min(...s),o=Math.max(...s),r=20,u=(o-a)/r||1,m=[];for(let h=0;h<r;h++)m.push({start:a+h*u,end:a+(h+1)*u,count:0});s.forEach(h=>{const S=Math.min(Math.floor((h-a)/u),r-1);S>=0&&S<r&&m[S].count++});const k=Math.max(...m.map(h=>h.count));return{bins:m,maxCount:k,min:a,max:o}},[n]),C=p.useCallback((s,a)=>Math.sqrt(a)/Math.sqrt(s),[]),l=n?F(n.cv):null;return e.jsxs("div",{className:"rounded-2xl bg-dark-800/50 border border-dark-700/50 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-100 mb-4",children:"Pool Size vs Payment Volatility"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-dark-400 mb-2",children:["Pool Size (N): ",e.jsx("span",{className:"text-emerald-400 font-mono",children:t})]}),e.jsx("input",{type:"range",min:"0",max:g.length-1,value:g.indexOf(t),onChange:s=>j(g[parseInt(s.target.value)]),className:"w-full h-2 bg-dark-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),e.jsx("div",{className:"flex justify-between text-xs text-dark-500 mt-1",children:g.map(s=>e.jsx("span",{children:s},s))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-dark-400 mb-2",children:["Simulations: ",e.jsx("span",{className:"text-emerald-400 font-mono",children:i})]}),e.jsx("input",{type:"range",min:"100",max:"1000",step:"100",value:i,onChange:s=>b(parseInt(s.target.value)),className:"w-full h-2 bg-dark-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),e.jsxs("div",{className:"flex justify-between text-xs text-dark-500 mt-1",children:[e.jsx("span",{children:"100"}),e.jsx("span",{children:"500"}),e.jsx("span",{children:"1000"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-dark-400 mb-2",children:["Mortality Rate (q): ",e.jsxs("span",{className:"text-emerald-400 font-mono",children:[(d*100).toFixed(1),"%"]})]}),e.jsx("input",{type:"range",min:"0.005",max:"0.05",step:"0.005",value:d,onChange:s=>v(parseFloat(s.target.value)),className:"w-full h-2 bg-dark-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),e.jsxs("div",{className:"flex justify-between text-xs text-dark-500 mt-1",children:[e.jsx("span",{children:"0.5%"}),e.jsx("span",{children:"2.5%"}),e.jsx("span",{children:"5%"})]})]})]}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("button",{onClick:R,disabled:M,className:"px-6 py-2.5 bg-emerald-600 hover:bg-emerald-500 disabled:bg-dark-600 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors",children:M?"Running...":"Run Simulation"})}),n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-dark-700/50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-sm text-dark-400 mb-1",children:"Mean Payout"}),e.jsx("div",{className:"text-xl font-mono text-dark-100",children:n.mean.toFixed(2)})]}),e.jsxs("div",{className:"bg-dark-700/50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-sm text-dark-400 mb-1",children:"Std Deviation"}),e.jsx("div",{className:"text-xl font-mono text-dark-100",children:n.stdDev.toFixed(2)})]}),e.jsxs("div",{className:`${l==null?void 0:l.bg} rounded-lg p-4 text-center`,children:[e.jsx("div",{className:"text-sm text-dark-400 mb-1",children:"CV (Volatility)"}),e.jsxs("div",{className:`text-xl font-mono ${l==null?void 0:l.text}`,children:[(n.cv*100).toFixed(2),"%"]})]}),e.jsxs("div",{className:`${l==null?void 0:l.bg} rounded-lg p-4 text-center`,children:[e.jsx("div",{className:"text-sm text-dark-400 mb-1",children:"Stability"}),e.jsx("div",{className:`text-xl font-semibold ${l==null?void 0:l.text}`,children:l==null?void 0:l.label})]})]}),e.jsxs("div",{className:"bg-dark-700/30 border border-dark-600/50 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-dark-400 mb-2",children:"Rule of Thumb"}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("span",{className:"font-mono text-emerald-400 text-lg",children:["CV = sqrt(q) / sqrt(N) = sqrt(",(d*100).toFixed(1),"%) / sqrt(",t,") = ",(C(t,d)*100).toFixed(2),"%"]}),e.jsxs("span",{className:"text-dark-400 text-sm",children:["(Simulated: ",(n.cv*100).toFixed(2),"%)"]})]})]}),c&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-dark-400 mb-3",children:"Payout Distribution"}),e.jsx("div",{className:"bg-dark-700/30 rounded-lg p-4",children:e.jsxs("svg",{viewBox:"0 0 400 200",className:"w-full h-48",preserveAspectRatio:"xMidYMid meet",children:[e.jsx("line",{x1:"40",y1:"10",x2:"40",y2:"170",stroke:"#475569",strokeWidth:"1"}),e.jsx("line",{x1:"40",y1:"170",x2:"390",y2:"170",stroke:"#475569",strokeWidth:"1"}),e.jsx("text",{x:"15",y:"90",fill:"#94a3b8",fontSize:"10",transform:"rotate(-90, 15, 90)",children:"Frequency"}),e.jsx("text",{x:"215",y:"195",fill:"#94a3b8",fontSize:"10",textAnchor:"middle",children:"Payout"}),c.bins.map((s,a)=>{const o=350/c.bins.length-2,r=s.count/c.maxCount*150,u=42+a*(350/c.bins.length),m=170-r;return e.jsx("rect",{x:u,y:m,width:o,height:r,fill:"#10b981",opacity:.7,rx:"2"},a)}),e.jsx("text",{x:"45",y:"185",fill:"#94a3b8",fontSize:"9",children:c.min.toFixed(0)}),e.jsx("text",{x:"385",y:"185",fill:"#94a3b8",fontSize:"9",textAnchor:"end",children:c.max.toFixed(0)}),(()=>{const s=42+(n.mean-c.min)/(c.max-c.min)*345;return e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:s,y1:"10",x2:s,y2:"170",stroke:"#fbbf24",strokeWidth:"2",strokeDasharray:"4"}),e.jsx("text",{x:s,y:"8",fill:"#fbbf24",fontSize:"9",textAnchor:"middle",children:"Mean"})]})})()]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-dark-400 mb-3",children:["Pool Size Comparison (at q = ",(d*100).toFixed(1),"%)"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-2 px-3 text-dark-400 font-medium",children:"Pool Size"}),e.jsx("th",{className:"text-left py-2 px-3 text-dark-400 font-medium",children:"Expected CV"}),e.jsx("th",{className:"text-left py-2 px-3 text-dark-400 font-medium",children:"Recommended?"})]})}),e.jsx("tbody",{children:g.map(s=>{const a=C(s,d),o=V(a),r=s===t;return e.jsxs("tr",{className:`border-b border-dark-700/50 ${r?"bg-emerald-500/10":""}`,children:[e.jsxs("td",{className:"py-2 px-3 font-mono text-dark-200",children:[s,r&&e.jsx("span",{className:"ml-2 text-emerald-400 text-xs",children:"(selected)"})]}),e.jsxs("td",{className:"py-2 px-3 font-mono text-dark-200",children:["~",(a*100).toFixed(1),"%"]}),e.jsx("td",{className:`py-2 px-3 font-medium ${o.color}`,children:o.text})]},s)})})]})})]})]}),!n&&e.jsxs("div",{className:"text-center py-12 text-dark-400",children:[e.jsx("p",{className:"mb-2",children:'Configure the parameters above and click "Run Simulation"'}),e.jsx("p",{className:"text-sm",children:"to see how pool size affects payment volatility"})]})]})}function Y(){return e.jsxs($,{sectionId:39,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Minimum Pool Size"}),e.jsxs("p",{className:"mb-4",children:["One of the most important practical questions for tontine design is: ",e.jsx("em",{children:"how many members do we need?"})," Too few, and random variation dominates. Too many, and administrative costs can outweigh benefits."]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Law of Large Numbers"}),e.jsx("p",{className:"mb-4",children:"In a small pool, the number of deaths in any year can vary wildly from expectations. This creates payment volatility that undermines the tontine's core promise. As pools grow larger, the law of large numbers kicks in: actual deaths converge to expected deaths."}),e.jsxs(y,{title:"Standard Deviation of Deaths",children:[e.jsxs("p",{children:["For a pool of ",e.jsx(x,{children:"n"})," members with mortality rate"," ",e.jsx(x,{children:"q"}),", the standard deviation of deaths is:"]}),e.jsx(w,{children:"\\sigma_D = \\sqrt{n \\cdot q \\cdot (1-q)} \\approx \\sqrt{n \\cdot q}"}),e.jsx("p",{className:"mt-2",children:"The coefficient of variation (relative volatility) is:"}),e.jsx(w,{children:"CV = \\frac{\\sigma_D}{E[D]} = \\frac{\\sqrt{n \\cdot q}}{n \\cdot q} = \\frac{1}{\\sqrt{n \\cdot q}}"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Simulation: 10 Members"}),e.jsxs("p",{className:"mb-4",children:["Consider a tontine with 10 members, each age 65 with mortality rate"," ",e.jsx(x,{children:"q = 1\\%"}),". The pool has $60,000 to distribute annually."]}),e.jsx(q,{title:"Small Pool Volatility (n=10)",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Expected deaths:"})," ",e.jsx(x,{children:"10 \\times 0.01 = 0.1"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Actual deaths in simulation:"})," 0, 1, 2, or even 3 (highly variable)"]}),e.jsx("p",{children:e.jsx("strong",{children:"Payment per survivor:"})}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"0 deaths: $60k / 10 = $6,000/person"}),e.jsx("li",{children:"1 death: $60k / 9 = $6,667/person"}),e.jsx("li",{children:"2 deaths: $60k / 8 = $7,500/person"}),e.jsx("li",{children:"3 deaths: $60k / 7 = $8,571/person"})]}),e.jsxs("p",{className:"mt-3 text-amber-400",children:[e.jsx("strong",{children:"Range:"})," $6,000 - $8,571 (43% variation!)"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Simulation: 100 Members"}),e.jsx(q,{title:"Medium Pool (n=100)",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Expected deaths:"})," ",e.jsx(x,{children:"100 \\times 0.01 = 1"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Std deviation:"})," ",e.jsx(x,{children:"\\sqrt{100 \\times 0.01} = 1"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Typical range:"})," 0-3 deaths (within 2 std dev)"]}),e.jsx("p",{children:e.jsx("strong",{children:"Payment per survivor ($600k pool):"})}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"0 deaths: $6,000/person"}),e.jsx("li",{children:"1 death: $6,061/person"}),e.jsx("li",{children:"2 deaths: $6,122/person"}),e.jsx("li",{children:"3 deaths: $6,186/person"})]}),e.jsxs("p",{className:"mt-3 text-emerald-400",children:[e.jsx("strong",{children:"Range:"})," 3% variation"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Simulation: 1,000 Members"}),e.jsx(q,{title:"Large Pool (n=1,000)",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Expected deaths:"})," ",e.jsx(x,{children:"1000 \\times 0.01 = 10"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Std deviation:"})," ",e.jsx(x,{children:"\\sqrt{1000 \\times 0.01} \\approx 3.16"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Typical range:"})," 4-16 deaths (within 2 std dev)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment volatility:"})," approximately 2%"]}),e.jsxs("p",{className:"mt-3 text-emerald-400",children:[e.jsx("strong",{children:"Result:"})," Payments predictably converge to expectations"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Stability Rule"}),e.jsxs(T,{type:"success",title:"Pool Size Guideline",children:[e.jsx("p",{children:"For payment volatility of 5% or less, you need:"}),e.jsx(w,{children:"n > \\frac{1}{(0.05)^2 \\cdot q} = \\frac{400}{q}"}),e.jsxs("p",{className:"mt-2",children:["At age 65 (",e.jsx(x,{children:"q \\approx 0.01"}),"), this means"," ",e.jsxs(x,{children:["n ",">"," 40,000"]})," for strict 5% stability."]}),e.jsxs("p",{className:"mt-2",children:[e.jsx("strong",{children:"Practical recommendation:"})," 500-1,000 members provides acceptable stability (10-15% volatility) at reasonable administrative cost."]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Solutions for Small Pools"}),e.jsx("p",{className:"mb-4",children:"What if you can't reach 500 members? Three approaches can smooth volatility:"}),e.jsxs(y,{title:"1. Reinsurance",children:[e.jsx("p",{children:"An insurance company guarantees to cover deaths exceeding expectations (or refund when deaths are lower). The tontine pays a premium, typically 1-2% of assets annually."}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Pros:"})," Smooth, predictable payments"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Cons:"})," Cost reduces returns; reintroduces insurer dependency"]})]})]}),e.jsxs(y,{title:"2. Smoothing Rules",children:[e.jsx("p",{children:"The tontine maintains a buffer account. In years with few deaths, excess funds go to the buffer. In years with many deaths, the buffer supplements payouts."}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Pros:"})," Self-insured; no external party needed"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Cons:"})," Buffer ties up capital; smoothing isn't perfect"]})]})]}),e.jsxs(y,{title:"3. Cohort Aggregation",children:[e.jsx("p",{children:"Multiple small tontines pool their mortality risk while keeping separate accounts. A platform operator runs many tontines and nets volatility across them."}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Pros:"})," Scale benefits without merging pools"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Cons:"})," Requires platform; regulatory complexity"]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Summary"}),e.jsxs("table",{className:"w-full text-sm mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b border-dark-700",children:[e.jsx("th",{className:"pb-2",children:"Pool Size"}),e.jsx("th",{className:"pb-2",children:"Payment Volatility"}),e.jsx("th",{className:"pb-2",children:"Assessment"})]})}),e.jsxs("tbody",{className:"text-dark-300",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"10"}),e.jsx("td",{className:"py-2 text-red-400",children:"40%+"}),e.jsx("td",{className:"py-2",children:"Too small - requires reinsurance"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"100"}),e.jsx("td",{className:"py-2 text-amber-400",children:"15-20%"}),e.jsx("td",{className:"py-2",children:"Marginal - smoothing recommended"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"500"}),e.jsx("td",{className:"py-2 text-emerald-400",children:"5-10%"}),e.jsx("td",{className:"py-2",children:"Good - acceptable for most uses"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2",children:"1,000+"}),e.jsxs("td",{className:"py-2 text-emerald-400",children:["<","5%"]}),e.jsx("td",{className:"py-2",children:"Excellent - law of large numbers"})]})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Interactive Volatility Simulator"}),e.jsx("p",{className:"mb-4",children:"Run Monte Carlo simulations to see how pool size affects payment volatility. Adjust the number of members and see the distribution of outcomes."}),e.jsx(E,{}),e.jsx("p",{className:"text-dark-400 italic mt-8",children:"Pool size determines statistical stability. But even a well-sized pool faces another challenge: navigating the regulatory landscape. That's our next topic."})]})}export{Y as default};
