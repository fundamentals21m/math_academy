import{j as e}from"./vendor-animation-CmxkKU9r.js";import{r as h}from"./vendor-react-DamxDR2H.js";import"./vendor-math-p018AHG0.js";import"./index-kiSjkdV0.js";import{L as J}from"./LessonLayout-CHKUuuLC.js";import{M as k,I as G}from"./MathBlock-fCav0pL3.js";import{E as O}from"./ContentBlocks-DZ6IdIC2.js";import{C as Q}from"./Callout-CP2-VZ-C.js";import"./quizMap-DVBi0JFt.js";const H=2e-5,L=.085;function W(r){const o=H/L*Math.exp(L*r)*(Math.exp(L)-1);return 1-Math.exp(-o)}function B(r,o){let n=0;for(let u=0;u<r;u++)Math.random()<o&&n++;return n}function F({label:r,value:o,min:n,max:u,step:b,onChange:j,formatValue:c}){const C=c?c(o):o.toString();return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-sm font-medium text-dark-300",children:r}),e.jsx("span",{className:"text-sm font-mono text-emerald-400",children:C})]}),e.jsx("input",{type:"range",min:n,max:u,step:b,value:o,onChange:l=>j(parseFloat(l.target.value)),className:`w-full h-2 bg-dark-700 rounded-lg appearance-none cursor-pointer
                   [&::-webkit-slider-thumb]:appearance-none
                   [&::-webkit-slider-thumb]:w-4
                   [&::-webkit-slider-thumb]:h-4
                   [&::-webkit-slider-thumb]:rounded-full
                   [&::-webkit-slider-thumb]:bg-emerald-500
                   [&::-webkit-slider-thumb]:cursor-pointer
                   [&::-webkit-slider-thumb]:transition-all
                   [&::-webkit-slider-thumb]:hover:bg-emerald-400
                   [&::-webkit-slider-thumb]:hover:scale-110
                   [&::-moz-range-thumb]:w-4
                   [&::-moz-range-thumb]:h-4
                   [&::-moz-range-thumb]:rounded-full
                   [&::-moz-range-thumb]:bg-emerald-500
                   [&::-moz-range-thumb]:border-0
                   [&::-moz-range-thumb]:cursor-pointer`}),e.jsxs("div",{className:"flex justify-between text-xs text-dark-500",children:[e.jsx("span",{children:c?c(n):n}),e.jsx("span",{children:c?c(u):u})]})]})}function _({data:r,dataKey:o,label:n,color:u,formatY:b,height:j=150}){if(r.length===0)return null;const c=r.map(m=>m[o]),C=Math.max(...c),l=Math.min(...c),y=C-l||1,M=400,t={top:20,right:40,bottom:30,left:60},f=M-t.left-t.right,i=j-t.top-t.bottom,w=r.map((m,d)=>{const g=t.left+d/Math.max(r.length-1,1)*f,Y=t.top+i-(m[o]-l)/y*i;return`${g},${Y}`}).join(" "),v=`${t.left},${t.top+i} ${w} ${t.left+f},${t.top+i}`;return e.jsxs("div",{className:"bg-dark-800/30 rounded-xl p-4 border border-dark-700/50",children:[e.jsx("h4",{className:"text-sm font-medium text-dark-300 mb-3",children:n}),e.jsxs("svg",{viewBox:`0 0 ${M} ${j}`,className:"w-full",children:[[0,.25,.5,.75,1].map((m,d)=>e.jsxs("g",{children:[e.jsx("line",{x1:t.left,y1:t.top+i*(1-m),x2:M-t.right,y2:t.top+i*(1-m),stroke:"rgb(51, 65, 85)",strokeWidth:"0.5",strokeDasharray:"4,4"}),e.jsx("text",{x:t.left-8,y:t.top+i*(1-m)+4,textAnchor:"end",className:"fill-dark-500 text-[10px]",children:b?b(l+y*m):Math.round(l+y*m)})]},d)),e.jsx("polygon",{points:v,fill:`url(#gradient-${o})`,opacity:"0.3"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:`gradient-${o}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:u,stopOpacity:"0.6"}),e.jsx("stop",{offset:"100%",stopColor:u,stopOpacity:"0"})]})}),e.jsx("polyline",{points:w,fill:"none",stroke:u,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),r.map((m,d)=>{const g=t.left+d/Math.max(r.length-1,1)*f,Y=t.top+i-(m[o]-l)/y*i;return e.jsx("circle",{cx:g,cy:Y,r:"3",fill:u,className:"opacity-0 hover:opacity-100 transition-opacity"},d)}),r.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("text",{x:t.left,y:j-8,textAnchor:"start",className:"fill-dark-500 text-[10px]",children:"Year 0"}),e.jsxs("text",{x:M-t.right,y:j-8,textAnchor:"end",className:"fill-dark-500 text-[10px]",children:["Year ",r.length-1]})]})]})]})}function E({label:r,value:o,subValue:n}){return e.jsxs("div",{className:"bg-dark-800/50 rounded-xl p-4 border border-dark-700/50",children:[e.jsx("p",{className:"text-xs font-medium text-dark-400 uppercase tracking-wider mb-1",children:r}),e.jsx("p",{className:"text-xl font-bold text-emerald-400",children:o}),n&&e.jsx("p",{className:"text-xs text-dark-500 mt-1",children:n})]})}function U(){const[r,o]=h.useState(100),[n,u]=h.useState(1e5),[b,j]=h.useState(.05),[c,C]=h.useState(65),[l,y]=h.useState([]),[M,t]=h.useState(0),[f,i]=h.useState(!1),[w,v]=h.useState(!1),m=h.useMemo(()=>r*n,[r,n]),d=h.useCallback(s=>s>=1e6?`$${(s/1e6).toFixed(2)}M`:s>=1e3?`$${(s/1e3).toFixed(0)}K`:`$${s.toFixed(0)}`,[]),g=h.useCallback(s=>`${(s*100).toFixed(1)}%`,[]),Y=h.useCallback(()=>{const s={year:0,age:c,survivors:r,deaths:0,poolValue:m,payoutPerSurvivor:n,investmentReturn:0,mortalityCredit:0,mortalityCreditPercent:0,qx:W(c)};y([s]),t(0),v(!1),i(!1)},[r,n,c,m]),Z=h.useCallback(()=>{y(s=>{if(s.length===0)return s;const x=s[s.length-1];if(x.survivors<=1)return v(!0),i(!1),s;const p=x.age+1,R=W(p),A=B(x.survivors,R),P=Math.max(x.survivors-A,1),$=x.poolValue*b,S=x.poolValue+$,N=S/P,V=S/x.survivors,I=N-V,z=I/N,T={year:x.year+1,age:p,survivors:P,deaths:A,poolValue:S,payoutPerSurvivor:N,investmentReturn:$,mortalityCredit:I,mortalityCreditPercent:z,qx:R};return t(T.year),P<=1&&(v(!0),i(!1)),[...s,T]})},[b]),K=h.useCallback(()=>{i(!0);const s=()=>{y(x=>{if(x.length===0)return i(!1),x;const p=x[x.length-1];if(p.survivors<=1||p.year>=50)return v(!0),i(!1),x;const R=p.age+1,A=W(R),P=B(p.survivors,A),$=Math.max(p.survivors-P,1),S=p.poolValue*b,N=p.poolValue+S,V=N/$,I=N/p.survivors,z=V-I,T=z/V,q={year:p.year+1,age:R,survivors:$,deaths:P,poolValue:N,payoutPerSurvivor:V,investmentReturn:S,mortalityCredit:z,mortalityCreditPercent:T,qx:A};return t(q.year),$<=1||q.year>=50?(v(!0),i(!1)):setTimeout(s,100),[...x,q]})};s()},[b]),a=h.useMemo(()=>l.length===0?null:l[l.length-1],[l]);return e.jsxs("div",{className:"bg-dark-900/50 rounded-2xl border border-dark-700/50 p-6 space-y-6",children:[e.jsxs("div",{className:"border-b border-dark-700/50 pb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-dark-100",children:"Tontine Pool Simulator"}),e.jsx("p",{className:"text-sm text-dark-400 mt-1",children:"Simulate a tontine pool year-by-year using Gompertz mortality"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(F,{label:"Pool Size (N)",value:r,min:10,max:1e3,step:10,onChange:o,formatValue:s=>`${s} members`}),e.jsx(F,{label:"Contribution per Member (C)",value:n,min:1e4,max:5e5,step:1e4,onChange:u,formatValue:d}),e.jsx(F,{label:"Investment Return Rate (r)",value:b,min:.02,max:.08,step:.005,onChange:j,formatValue:g}),e.jsx(F,{label:"Starting Age",value:c,min:60,max:80,step:1,onChange:C,formatValue:s=>`${s} years old`})]}),e.jsx("div",{className:"bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-4",children:e.jsxs("p",{className:"text-sm text-emerald-300",children:["Initial Pool Value: ",e.jsx("span",{className:"font-bold text-emerald-400",children:d(m)}),e.jsxs("span",{className:"text-dark-400 ml-2",children:["(",r," members x ",d(n),")"]})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:Y,className:"px-4 py-2 bg-dark-700 hover:bg-dark-600 text-dark-200 rounded-lg font-medium transition-colors",children:l.length===0?"Initialize":"Reset"}),e.jsx("button",{onClick:Z,disabled:l.length===0||w||f,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 disabled:bg-dark-700 disabled:text-dark-500 text-white rounded-lg font-medium transition-colors",children:"Step Year"}),e.jsx("button",{onClick:K,disabled:l.length===0||w||f,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 disabled:bg-dark-700 disabled:text-dark-500 text-white rounded-lg font-medium transition-colors",children:f?"Running...":"Run to Completion"})]}),a&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(E,{label:"Year / Age",value:`${a.year} / ${a.age}`,subValue:`Started at age ${c}`}),e.jsx(E,{label:"Survivors",value:a.survivors.toString(),subValue:`${a.deaths} died this year`}),e.jsx(E,{label:"Pool Value",value:d(a.poolValue),subValue:`+${d(a.investmentReturn)} returns`}),e.jsx(E,{label:"Payout / Survivor",value:d(a.payoutPerSurvivor),subValue:`${g(a.mortalityCreditPercent)} from mortality credit`})]}),l.length>1&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(_,{data:l,dataKey:"poolValue",label:"Pool Value Over Time",color:"#10b981",formatY:d}),e.jsx(_,{data:l,dataKey:"survivors",label:"Number of Survivors",color:"#f59e0b",formatY:s=>Math.round(s).toString()}),e.jsx(_,{data:l,dataKey:"payoutPerSurvivor",label:"Payout per Survivor",color:"#06b6d4",formatY:d}),e.jsx(_,{data:l,dataKey:"mortalityCreditPercent",label:"Mortality Credit (% of Payout)",color:"#ec4899",formatY:g})]}),w&&e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/20 rounded-xl p-4 text-center",children:[e.jsxs("p",{className:"text-amber-300 font-medium",children:["Simulation Complete! ",(a==null?void 0:a.survivors)===1?"Only 1 survivor remains.":`${a==null?void 0:a.survivors} survivors after 50 years.`]}),a&&e.jsxs("p",{className:"text-dark-400 text-sm mt-2",children:["Final payout: ",d(a.payoutPerSurvivor)," per survivor (initial contribution: ",d(n),")"]})]}),l.length>0&&e.jsxs("div",{className:"bg-dark-800/30 rounded-xl p-4 border border-dark-700/50",children:[e.jsx("h4",{className:"text-sm font-medium text-dark-300 mb-2",children:"Gompertz Mortality Reference"}),e.jsxs("p",{className:"text-xs text-dark-500",children:["Current mortality rate (q",e.jsx("sub",{children:a==null?void 0:a.age}),"): ",g((a==null?void 0:a.qx)||0)]}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:["Formula: q",e.jsx("sub",{children:"x"})," = 1 - exp(-integral of mu(t) from x to x+1), where mu(t) = alpha * exp(beta * t)"]}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:["Parameters: alpha = ",H,", beta = ",L]})]})]})}function oe(){return e.jsxs(J,{sectionId:9,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"Year-by-Year Calculation"}),e.jsx("p",{className:"mb-4",children:"Let's trace through our tontine example step by step, calculating exactly how payouts evolve as members die."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Year 1 Calculation"}),e.jsxs(O,{title:"Year 1: Age 65 → 66",children:[e.jsx("p",{className:"mb-3",children:e.jsx("strong",{children:"Step 1: Investment Returns"})}),e.jsx(k,{children:"\\text{Investment income} = P \\times r = \\$10,000,000 \\times 0.04 = \\$400,000"}),e.jsx("p",{className:"mt-4 mb-3",children:e.jsx("strong",{children:"Step 2: Mortality"})}),e.jsxs("p",{className:"mb-2",children:["Expected deaths at age 65: ",e.jsx(G,{children:"q_{65} \\approx 1.2\\%"})]}),e.jsx("p",{className:"mb-2",children:"Actual deaths (example): 1 person"}),e.jsxs("p",{children:["Survivors: ",e.jsx(G,{children:"n_1 = 99"})," people"]}),e.jsx("p",{className:"mt-4 mb-3",children:e.jsx("strong",{children:"Step 3: Payout"})}),e.jsx(k,{children:"D_1 = \\frac{\\$400,000}{99} = \\$4,040 \\text{ per person}"}),e.jsxs("p",{className:"mt-2",children:["As percentage of contribution: ",e.jsx(G,{children:"4.04\\%"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Year 5 Calculation"}),e.jsxs(O,{title:"Year 5: Age 69 → 70",children:[e.jsx("p",{className:"mb-3",children:"Assume 95 survivors (5 have died over 5 years)"}),e.jsx("p",{className:"mb-2",children:"Pool has grown from dead members' capital remaining:"}),e.jsx(k,{children:"P_5 \\approx \\$10,505,000"}),e.jsx("p",{className:"mt-4 mb-3",children:e.jsx("strong",{children:"Payout calculation:"})}),e.jsx(k,{children:"\\text{Investment income} = \\$10,505,000 \\times 0.04 = \\$420,200"}),e.jsx("p",{className:"mt-2",children:"With 2 more deaths this year (93 survivors):"}),e.jsx(k,{children:"D_5 = \\frac{\\$420,200}{93} = \\$4,518 \\text{ per person}"}),e.jsx("p",{className:"mt-2 text-emerald-400",children:"Payout increased 11.8% from Year 1!"})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Year 20: The Acceleration"}),e.jsxs(O,{title:"Year 20: Age 84 → 85",children:[e.jsx("p",{className:"mb-3",children:"Survivors: ~50 people (half the original group)"}),e.jsx("p",{className:"mb-3",children:"Pool has grown significantly from accumulated mortality credits:"}),e.jsx(k,{children:"P_{20} \\approx \\$15,875,000"}),e.jsx(k,{children:"D_{20} = \\frac{\\$15,875,000 \\times 0.04}{50} = \\$12,700 \\text{ per person}"}),e.jsx("p",{className:"mt-2 text-emerald-400",children:"Payout has tripled from the start!"})]}),e.jsxs(Q,{type:"warning",title:"The Growth Pattern",children:[e.jsx("p",{children:"Payouts grow for two reasons:"}),e.jsxs("ol",{className:"list-decimal list-inside mt-2",children:[e.jsx("li",{children:"Fewer survivors to share with (100 → 50)"}),e.jsx("li",{children:"Pool grows from deceased members' capital remaining"})]}),e.jsx("p",{className:"mt-2",children:"This creates exponentially growing payouts—a feature and a problem we'll address."})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Summary Table"}),e.jsx("div",{className:"overflow-x-auto mb-6",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b border-dark-700",children:[e.jsx("th",{className:"pb-2",children:"Year"}),e.jsx("th",{className:"pb-2",children:"Age"}),e.jsx("th",{className:"pb-2",children:"Survivors"}),e.jsx("th",{className:"pb-2",children:"Pool"}),e.jsx("th",{className:"pb-2",children:"Payout"}),e.jsx("th",{className:"pb-2",children:"Yield"})]})}),e.jsxs("tbody",{className:"text-dark-300",children:[e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"1"}),e.jsx("td",{className:"py-2",children:"66"}),e.jsx("td",{className:"py-2",children:"99"}),e.jsx("td",{className:"py-2",children:"$10.1M"}),e.jsx("td",{className:"py-2",children:"$4,040"}),e.jsx("td",{className:"py-2",children:"4.0%"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"5"}),e.jsx("td",{className:"py-2",children:"70"}),e.jsx("td",{className:"py-2",children:"93"}),e.jsx("td",{className:"py-2",children:"$10.7M"}),e.jsx("td",{className:"py-2",children:"$4,518"}),e.jsx("td",{className:"py-2",children:"4.5%"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"10"}),e.jsx("td",{className:"py-2",children:"75"}),e.jsx("td",{className:"py-2",children:"82"}),e.jsx("td",{className:"py-2",children:"$12.4M"}),e.jsx("td",{className:"py-2",children:"$5,982"}),e.jsx("td",{className:"py-2",children:"6.0%"})]}),e.jsxs("tr",{className:"border-b border-dark-800",children:[e.jsx("td",{className:"py-2",children:"20"}),e.jsx("td",{className:"py-2",children:"85"}),e.jsx("td",{className:"py-2",children:"50"}),e.jsx("td",{className:"py-2",children:"$15.9M"}),e.jsx("td",{className:"py-2",children:"$12,700"}),e.jsx("td",{className:"py-2",children:"12.7%"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-2",children:"30"}),e.jsx("td",{className:"py-2",children:"95"}),e.jsx("td",{className:"py-2",children:"12"}),e.jsx("td",{className:"py-2",children:"$14.4M"}),e.jsx("td",{className:"py-2",children:"$48,000"}),e.jsx("td",{className:"py-2",children:"48.0%"})]})]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Interactive Simulator"}),e.jsx("p",{className:"mb-4",children:"Run your own tontine simulation. Watch how survivors decrease, pool value changes, and payouts grow with mortality credits."}),e.jsx(U,{}),e.jsx("p",{className:"text-dark-400 italic mt-8",children:`Where does this extra yield come from? It's called the "mortality credit"—and understanding it is key to tontine mathematics.`})]})}export{oe as default};
