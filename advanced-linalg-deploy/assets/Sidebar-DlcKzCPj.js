import{j as e,A as v,m as N}from"./vendor-animation-0o8UKZ_1.js";import{r as g,L as u,N as j}from"./vendor-react-Drj8qL0h.js";import{g as C,a as L,e as M,i as P,u as B,s as E,b as w,c as $,C as S,H as I,S as R,X as W,F as c,d as y,f as F}from"./index-CyJixDPD.js";import"./vendor-math-p018AHG0.js";function H({level:r,showLabel:i=!1}){const{label:l,color:t,symbol:a}=C(r);return r==="none"||!a?null:e.jsxs("div",{className:`flex items-center gap-1.5 ${t}`,children:[e.jsx("span",{className:"text-base font-bold",children:a}),i&&e.jsx("span",{className:"text-xs",children:l})]})}function U({onImportSuccess:r}){const[i,l]=g.useState(!1),[t,a]=g.useState(null),[d,x]=g.useState(!1),m=g.useRef(null),s=L(),o=()=>{M(),a({type:"success",text:"Progress exported! Check your downloads folder."}),setTimeout(()=>a(null),3e3)},n=()=>{var h;(h=m.current)==null||h.click()},f=async h=>{var b;const p=(b=h.target.files)==null?void 0:b[0];if(!p)return;x(!0),a(null);const k=await P(p);x(!1),a({type:k.success?"success":"error",text:k.message}),k.success&&(r==null||r(),setTimeout(()=>{window.location.reload()},1500)),m.current&&(m.current.value="")};return e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>l(!i),className:"p-2 rounded-lg hover:bg-dark-800 transition-colors","aria-label":"Backup & restore progress",title:"Backup & restore progress",children:e.jsx("svg",{className:"w-5 h-5 text-dark-400 hover:text-dark-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>l(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-72 bg-dark-800 rounded-lg shadow-xl border border-dark-700 z-50 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-dark-100 mb-3",children:"Progress Backup"}),s&&e.jsxs("div",{className:"mb-4 p-3 bg-dark-900 rounded-lg",children:[e.jsx("div",{className:"text-xs text-dark-400 mb-1",children:"Current Progress"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-accent-400 font-semibold",children:[s.totalXP," XP"]}),e.jsxs("span",{className:"text-dark-300",children:["Level ",s.level]}),e.jsxs("span",{className:"text-dark-400",children:[s.sectionsCompleted," sections"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:o,disabled:!s,className:"w-full flex items-center gap-2 px-3 py-2 bg-dark-700 hover:bg-dark-600 rounded-lg text-sm text-dark-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export Progress"]}),e.jsxs("button",{onClick:n,disabled:d,className:"w-full flex items-center gap-2 px-3 py-2 bg-dark-700 hover:bg-dark-600 rounded-lg text-sm text-dark-100 transition-colors disabled:opacity-50",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),d?"Importing...":"Import Backup"]}),e.jsx("input",{ref:m,type:"file",accept:".json",onChange:f,className:"hidden"})]}),t&&e.jsx("div",{className:`mt-3 p-2 rounded text-xs ${t.type==="success"?"bg-green-900/50 text-green-300 border border-green-700":"bg-red-900/50 text-red-300 border border-red-700"}`,children:t.text}),e.jsx("p",{className:"mt-3 text-xs text-dark-500",children:"Export your progress regularly to avoid losing your XP. Import to restore from a backup file."})]})]})]})}function z({className:r="",showDisplayName:i=!0}){var h,p;const{isAuthenticated:l,isConnecting:t,npub:a,displayName:d,hasExtension:x,extensionChecked:m,error:s,connect:o,disconnect:n,clearError:f}=B();return m?l?e.jsxs("div",{className:`flex items-center gap-3 ${r}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary-500 to-purple-500 flex items-center justify-center text-white text-xs font-bold",children:((h=d==null?void 0:d[0])==null?void 0:h.toUpperCase())||((p=a==null?void 0:a[5])==null?void 0:p.toUpperCase())||"?"}),e.jsxs("div",{className:"flex flex-col",children:[i&&d&&e.jsx("span",{className:"text-sm font-medium text-dark-100",children:d}),e.jsx("span",{className:"text-xs text-dark-400 font-mono",children:a?E(a,6):"..."})]})]}),e.jsx("button",{onClick:n,className:"p-1.5 rounded-lg text-dark-400 hover:text-dark-200 hover:bg-dark-700/50 transition-colors",title:"Disconnect",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]}):e.jsxs("div",{className:`flex flex-col items-center gap-2 ${r}`,children:[e.jsx("button",{onClick:()=>{o()},disabled:t||!x,className:`
            flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm
            transition-all duration-200
            ${x?t?"bg-primary-600 text-white opacity-70 cursor-wait":"bg-primary-600 hover:bg-primary-500 text-white shadow-lg shadow-primary-600/25":"bg-dark-700 text-dark-400 cursor-not-allowed"}
          `,children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),"Connect with Nostr"]})}),!x&&e.jsxs("p",{className:"text-xs text-dark-400 text-center max-w-xs",children:["Install a Nostr extension like"," ",e.jsx("a",{href:"https://github.com/nickytonline/nos2x",target:"_blank",rel:"noopener noreferrer",className:"text-primary-400 hover:underline",children:"nos2x"})," ","or"," ",e.jsx("a",{href:"https://getalby.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary-400 hover:underline",children:"Alby"})," ","to connect"]}),s&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-red-400",children:[e.jsx("span",{children:s}),e.jsx("button",{onClick:f,className:"text-dark-400 hover:text-dark-200",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}):e.jsxs("div",{className:`flex items-center gap-2 ${r}`,children:[e.jsx("div",{className:"w-4 h-4 border-2 border-dark-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-dark-400 text-sm",children:"Checking..."})]})}function T({onToggleSidebar:r,sidebarOpen:i}){const l=w(),t=c.gamification?l:null;return e.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 bg-dark-900/95 backdrop-blur-sm border-b border-dark-800",children:e.jsxs("div",{className:"flex items-center justify-between h-16 px-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-dark-800 transition-colors","aria-label":i?"Close sidebar":"Open sidebar",children:e.jsx("svg",{className:"w-6 h-6 text-dark-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsxs(u,{to:"/",className:"flex items-center gap-3 hover:opacity-80 transition-opacity",children:[e.jsx("span",{className:"text-2xl",children:$}),e.jsx("h1",{className:"text-lg font-semibold text-dark-100 hidden sm:block",children:S})]})]}),e.jsxs("nav",{className:"hidden md:flex items-center gap-6",children:[e.jsx("a",{href:I,className:"text-dark-400 hover:text-dark-100 transition-colors text-sm font-medium",children:"Hub"}),e.jsx(u,{to:"/",className:"text-dark-400 hover:text-dark-100 transition-colors text-sm font-medium",children:"Home"}),c.theoremIndex&&e.jsx(u,{to:"/theorems",className:"text-dark-400 hover:text-dark-100 transition-colors text-sm font-medium",children:"Theorems"}),c.interactiveModules&&e.jsx(u,{to:"/interactive",className:"text-dark-400 hover:text-dark-100 transition-colors text-sm font-medium",children:"Interactive"}),c.leaderboard&&e.jsx(u,{to:"/leaderboard",className:"text-dark-400 hover:text-dark-100 transition-colors text-sm font-medium",children:"Leaderboard"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[c.gamification&&t&&e.jsxs(e.Fragment,{children:[e.jsx(R,{streak:t.state.streak.currentStreak}),e.jsx(W,{xp:t.state.user.totalXP,level:t.state.user.level})]}),c.gamification&&e.jsx(U,{}),c.leaderboard&&e.jsx(z,{showDisplayName:!1})]})]})})}function D({isOpen:r,onClose:i}){const[l,t]=g.useState(()=>new Set(y.map(s=>s.id))),a=w(),d=c.gamification?a:null,x=s=>{t(o=>{const n=new Set(o);return n.has(s)?n.delete(s):n.add(s),n})},m=s=>{var n;if(!d)return"none";const o=`${F}:${s}`;return((n=d.state.sections[o])==null?void 0:n.masteryLevel)??"none"};return e.jsxs(e.Fragment,{children:[e.jsx(v,{children:r&&e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,className:"fixed inset-0 bg-black/50 z-40 lg:hidden"})}),e.jsx("aside",{className:`
          fixed top-16 left-0 bottom-0 z-40
          w-72 bg-dark-900 border-r border-dark-800
          transform transition-transform duration-300 ease-in-out
          ${r?"translate-x-0":"-translate-x-full"}
          lg:translate-x-0
          overflow-y-auto
        `,children:e.jsxs("nav",{className:"p-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-lg bg-gradient-to-br from-amber-500/20 to-orange-500/10 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-amber-400",children:"â˜…"})}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-dark-500",children:"Reference"})]}),e.jsxs("ul",{className:"space-y-0.5",children:[c.theoremIndex&&e.jsx("li",{children:e.jsxs(j,{to:"/theorems",className:({isActive:s})=>`flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors ${s?"bg-primary-500/10 text-primary-400":"text-dark-300 hover:bg-dark-800 hover:text-dark-100"}`,children:[e.jsx("span",{className:"text-lg",children:"ðŸ“œ"}),"Theorems"]})}),c.interactiveModules&&e.jsx("li",{children:e.jsxs(j,{to:"/interactive",className:({isActive:s})=>`flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors ${s?"bg-primary-500/10 text-primary-400":"text-dark-300 hover:bg-dark-800 hover:text-dark-100"}`,children:[e.jsx("span",{className:"text-lg",children:"ðŸŽ®"}),"Interactive Modules"]})})]})]}),e.jsx("div",{className:"space-y-2",children:y.map(s=>e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>x(s.id),className:"w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-dark-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-lg bg-gradient-to-br from-primary-500/20 to-primary-600/10 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-primary-400",children:s.id})}),e.jsx("span",{className:"text-sm font-medium text-dark-200",children:s.title})]}),e.jsx("svg",{className:`w-4 h-4 text-dark-500 transition-transform ${l.has(s.id)?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e.jsx(v,{children:l.has(s.id)&&e.jsx(N.ul,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"ml-4 mt-1 space-y-0.5 overflow-hidden",children:s.sections.map(o=>e.jsx("li",{children:e.jsxs(j,{to:`/section/${o.id}`,onClick:()=>{window.innerWidth<1024&&i()},className:({isActive:n})=>`flex items-center justify-between px-3 py-2 rounded-lg text-sm transition-colors ${n?"bg-primary-500/10 text-primary-400":"text-dark-400 hover:bg-dark-800 hover:text-dark-200"}`,children:[e.jsx("span",{className:"truncate",children:o.title}),c.gamification&&e.jsx(H,{level:m(o.id)})]})},o.id))})})]},s.id))})]})})]})}export{T as H,D as S};
