import{j as e}from"./vendor-animation-0o8UKZ_1.js";import"./vendor-react-Drj8qL0h.js";import"./vendor-math-p018AHG0.js";import"./index-Dk3obfp0.js";import{L as i,D as n,C as t,E as s}from"./Callout-CtxvUU9J.js";import"./vendor-firebase-core-BXWtuYvb.js";import"./quizMap-C21tOVc_.js";function h(){return e.jsxs(i,{sectionId:11,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"TTL & Payment Lifecycle"}),e.jsx("p",{className:"mb-4",children:"Time-to-live (TTL) is a critical concept in Branta's payment registration system. It determines how long a payment address remains verifiable and ensures that stale registrations don't persist indefinitely."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Understanding TTL"}),e.jsx(n,{title:"Time-to-Live (TTL)",children:"The duration in seconds that a payment registration remains active in Branta's system. After the TTL expires, the registration is automatically removed and verification queries will return 404 Not Found."}),e.jsx("p",{className:"mb-4",children:"TTL serves several important purposes:"}),e.jsxs("ul",{className:"list-disc list-inside mb-6 space-y-2 text-dark-200",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Security"})," - Expired invoices shouldn't remain verifiable"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Data hygiene"})," - Prevents accumulation of stale registrations"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Resource management"})," - Keeps the verification database efficient"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Business alignment"})," - Matches payment windows with verification windows"]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"TTL Limits"}),e.jsx("div",{className:"bg-dark-800 p-4 rounded mb-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400",children:"Minimum TTL"}),e.jsx("p",{className:"font-mono text-lg",children:"30 seconds"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400",children:"Maximum TTL"}),e.jsx("p",{className:"font-mono text-lg",children:"31,536,000 seconds (1 year)"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400",children:"Default (invalid values)"}),e.jsx("p",{className:"font-mono text-lg",children:"604,800 seconds (7 days)"})]})]})}),e.jsx(t,{type:"info",title:"Invalid TTL Handling",children:"If you provide a TTL outside the valid range (less than 30 seconds or greater than 1 year), Branta will automatically set it to 7 days. This prevents both accidentally short registrations and indefinite ones."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Payment Lifecycle"}),e.jsx("p",{className:"mb-4",children:"A registered payment goes through the following lifecycle:"}),e.jsxs("ol",{className:"list-decimal list-inside mb-6 space-y-2 text-dark-200",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Registration"})," - Merchant calls POST /v1/payments with address and TTL"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Active Period"})," - Payment is verifiable via GET /v1/payments/","{address}"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Expiration"})," - TTL elapses from registration time"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Removal"})," - Registration is deleted, verification returns 404"]})]}),e.jsx(s,{title:"Lifecycle Timeline",children:e.jsxs("div",{className:"font-mono text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-dark-400",children:"T+0:"})," POST /v1/payments (ttl: 3600)"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-dark-400",children:"T+0 to T+3600:"})," GET returns 200 (verified)"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-dark-400",children:"T+3600+:"})," GET returns 404 (expired)"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Choosing the Right TTL"}),e.jsx("p",{className:"mb-4",children:"The optimal TTL depends on your use case:"}),e.jsxs(s,{title:"E-commerce Checkout (15-60 minutes)",children:[e.jsx("p",{className:"mb-2",children:"For typical online checkout flows, use a TTL that matches your cart timeout. This ensures the payment can be verified while the checkout is active but expires when the session ends."}),e.jsx("pre",{className:"font-mono text-sm bg-dark-800 p-4 rounded mt-2",children:`{
  "payment": {
    "payment": "bc1q...",
    "ttl": "3600"  // 1 hour
  }
}`})]}),e.jsxs(s,{title:"Invoice Payments (1-7 days)",children:[e.jsx("p",{className:"mb-2",children:"For invoice-based payments where customers have more time to pay, use a longer TTL that matches your invoice terms."}),e.jsx("pre",{className:"font-mono text-sm bg-dark-800 p-4 rounded mt-2",children:`{
  "payment": {
    "payment": "bc1q...",
    "ttl": "604800"  // 7 days
  }
}`})]}),e.jsxs(s,{title:"Donation Addresses (30 days - 1 year)",children:[e.jsx("p",{className:"mb-2",children:"For persistent donation addresses or long-term payment destinations, use the maximum TTL and re-register periodically."}),e.jsx("pre",{className:"font-mono text-sm bg-dark-800 p-4 rounded mt-2",children:`{
  "payment": {
    "payment": "bc1q...",
    "ttl": "31536000"  // 1 year
  }
}`})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Re-registration"}),e.jsx("p",{className:"mb-4",children:"For payments that need to remain verifiable longer than the TTL allows, or to extend an existing registration, simply re-register the address:"}),e.jsx(t,{type:"success",title:"Extending Registration",children:"You can re-register an address at any time, even before it expires. The new registration replaces the old one with a fresh TTL starting from the new registration time."}),e.jsx(s,{title:"Automated Re-registration",children:e.jsx("pre",{className:"font-mono text-sm bg-dark-800 p-4 rounded overflow-x-auto",children:`// Re-register donation addresses weekly
async function maintainDonationAddress(address: string) {
  const TTL_DAYS = 30;
  const RENEW_DAYS_BEFORE = 7;

  // Check if needs renewal (pseudo-code)
  const registration = await getRegistration(address);
  const expiresIn = registration.expiresAt - Date.now();

  if (expiresIn < RENEW_DAYS_BEFORE * 24 * 60 * 60 * 1000) {
    await registerPayment(address, TTL_DAYS * 24 * 60 * 60);
    console.log('Registration renewed');
  }
}

// Run daily via cron
setInterval(() => maintainDonationAddress(DONATION_ADDRESS), 86400000);`})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"TTL Best Practices"}),e.jsxs("ul",{className:"list-disc list-inside mb-6 space-y-2 text-dark-200",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Match business logic"})," - TTL should align with payment deadlines"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Add buffer time"})," - Account for timezone differences and processing delays"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Don't over-extend"})," - Expired invoices shouldn't remain verifiable"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Automate renewal"})," - For persistent addresses, set up automated re-registration"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Log expiration"})," - Track when registrations expire for debugging"]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Handling Expiration"}),e.jsx("p",{className:"mb-4",children:"When a customer tries to verify an expired registration:"}),e.jsxs("ul",{className:"list-disc list-inside mb-6 space-y-2 text-dark-200",children:[e.jsx("li",{children:"They receive a 404 response"}),e.jsx("li",{children:'Your application should interpret this as "unverifiable"'}),e.jsx("li",{children:'Consider displaying: "This payment link may have expired. Contact the merchant for a new one."'})]}),e.jsx(t,{type:"warning",title:"Expired vs. Never Registered",children:"The API returns 404 for both expired and never-registered payments. Your application cannot distinguish between these cases from the API response alone. If context matters, track registrations on your side."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"TTL and Security"}),e.jsx("p",{className:"mb-4",children:"TTL is also a security feature. By ensuring registrations expire:"}),e.jsxs("ul",{className:"list-disc list-inside mb-6 space-y-2 text-dark-200",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Reduces attack window"})," - Compromised addresses can't stay registered forever"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Limits damage"})," - Old, potentially-insecure addresses auto-expire"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Forces fresh registration"})," - Encourages regular security review"]})]})]})}export{h as default};
