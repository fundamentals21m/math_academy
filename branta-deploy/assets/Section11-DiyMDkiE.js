import{j as e}from"./vendor-animation-0o8UKZ_1.js";import{r as i}from"./vendor-react-Drj8qL0h.js";import"./vendor-math-p018AHG0.js";import"./index-B8OzST0h.js";import{L as S,D as E,C as b,E as c}from"./Callout-B5e-uczc.js";import"./vendor-firebase-core-BXWtuYvb.js";import"./quizMap-D6hrknZo.js";function R(){const[t,f]=i.useState(3600),[r,k]=i.useState(new Date),[l,T]=i.useState(new Date),[d,v]=i.useState(!1),[m,w]=i.useState(60);i.useEffect(()=>{if(!d)return;const s=setInterval(()=>{T(a=>new Date(a.getTime()+m*1e3))},1e3);return()=>clearInterval(s)},[d,m]);const u=i.useMemo(()=>new Date(r.getTime()+t*1e3),[r,t]),g=i.useMemo(()=>{const s=u.getTime()-l.getTime();return Math.max(0,s)},[u,l]),x=i.useMemo(()=>{const s=l.getTime()-r.getTime(),a=t*1e3;return Math.min(100,Math.max(0,s/a*100))},[l,r,t]),n=g<=0,y=s=>{const a=Math.floor(s/1e3),o=Math.floor(a/60),h=Math.floor(o/60),N=Math.floor(h/24);return N>0?`${N}d ${h%24}h ${o%60}m`:h>0?`${h}h ${o%60}m ${a%60}s`:o>0?`${o}m ${a%60}s`:`${a}s`},p=s=>s.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),L=[{label:"15 min",value:900},{label:"1 hour",value:3600},{label:"24 hours",value:86400},{label:"7 days",value:604800},{label:"30 days",value:2592e3}],j=()=>{const s=new Date;k(s),T(s),v(!1)};return e.jsxs("div",{className:"demo-container",children:[e.jsx("h3",{className:"text-lg font-semibold text-dark-200 mb-4",children:"TTL Timeline Visualizer"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-dark-400 mb-2",children:["Time-To-Live (TTL): ",y(t*1e3)]}),e.jsx("input",{type:"range",min:"300",max:"2592000",step:"300",value:t,onChange:s=>{f(parseInt(s.target.value)),j()},className:"w-full accent-amber-500"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:L.map(s=>e.jsx("button",{onClick:()=>{f(s.value),j()},className:`px-3 py-1 rounded text-sm ${t===s.value?"bg-amber-600 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-dark-400 mb-2",children:["Simulation Speed: ",m,"x"]}),e.jsx("input",{type:"range",min:"1",max:"3600",step:"1",value:m,onChange:s=>w(parseInt(s.target.value)),className:"w-full accent-amber-500"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>v(!d),className:`px-4 py-2 rounded font-medium ${d?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"}`,children:d?"⏸ Pause":"▶ Simulate Time"}),e.jsx("button",{onClick:j,className:"px-4 py-2 rounded bg-dark-700 text-dark-200 font-medium hover:bg-dark-600",children:"↺ Reset"})]})]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-xl p-6",children:[e.jsxs("div",{className:"relative h-8 bg-dark-700 rounded-full overflow-hidden mb-4",children:[e.jsx("div",{className:`absolute inset-y-0 left-0 transition-all duration-1000 ${n?"bg-red-600":x>75?"bg-yellow-600":"bg-green-600"}`,style:{width:`${x}%`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-sm font-medium text-white",children:n?"EXPIRED":`${x.toFixed(1)}% elapsed`})]}),e.jsxs("div",{className:"relative h-16 mb-4",children:[e.jsx("div",{className:"absolute inset-x-0 top-1/2 h-1 bg-dark-600 -translate-y-1/2"}),e.jsxs("div",{className:"absolute left-0 top-0 flex flex-col items-center",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 border-2 border-green-300"}),e.jsx("span",{className:"text-xs text-dark-400 mt-1",children:"Registered"}),e.jsx("span",{className:"text-xs text-dark-500",children:p(r)})]}),e.jsxs("div",{className:"absolute top-0 flex flex-col items-center transition-all duration-1000",style:{left:`${Math.min(95,x)}%`},children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${n?"bg-red-500 border-red-300":"bg-amber-500 border-amber-300"}`}),e.jsx("span",{className:"text-xs text-dark-400 mt-1",children:"Now"}),e.jsx("span",{className:"text-xs text-dark-500",children:p(l)})]}),e.jsxs("div",{className:"absolute right-0 top-0 flex flex-col items-center",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500 border-2 border-red-300"}),e.jsx("span",{className:"text-xs text-dark-400 mt-1",children:"Expires"}),e.jsx("span",{className:"text-xs text-dark-500",children:p(u)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-dark-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 text-sm",children:"Time Remaining"}),e.jsx("p",{className:`text-2xl font-mono font-bold ${n?"text-red-400":g<t*250?"text-yellow-400":"text-green-400"}`,children:n?"0s":y(g)})]}),e.jsxs("div",{className:"bg-dark-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 text-sm",children:"Verification Status"}),e.jsx("p",{className:`text-2xl font-bold ${n?"text-red-400":"text-green-400"}`,children:n?"❌ Invalid":"✓ Valid"})]}),e.jsxs("div",{className:"bg-dark-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-dark-400 text-sm",children:"TTL in Seconds"}),e.jsx("p",{className:"text-2xl font-mono font-bold text-amber-400",children:t.toLocaleString()})]})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-dark-800 rounded-lg",children:[e.jsx("p",{className:"text-dark-300 text-sm font-semibold mb-2",children:"TTL Recommendations:"}),e.jsxs("ul",{className:"text-dark-400 text-sm space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Lightning invoices:"})," 15 min - 1 hour (match invoice expiry)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"E-commerce checkout:"})," 1-24 hours (session-based)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Recurring payments:"})," 7-30 days (known merchant)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Permanent registration:"})," No TTL (verified entities)"]})]})]})]})}function F(){return e.jsxs(S,{sectionId:11,children:[e.jsx("h2",{className:"text-2xl font-bold text-dark-100 mb-6",children:"TTL & Payment Lifecycle"}),e.jsx("p",{className:"mb-4",children:"Time-to-live (TTL) is a critical concept in Branta's payment registration system. It determines how long a payment address remains verifiable and ensures that stale registrations don't persist indefinitely."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Understanding TTL"}),e.jsx(E,{title:"Time-to-Live (TTL)",children:"The duration in seconds that a payment registration remains active in Branta's system. After the TTL expires, the registration is automatically removed and verification queries will return 404 Not Found."}),e.jsx("p",{className:"mb-4",children:"TTL serves several important purposes:"}),e.jsxs("ul",{className:"list-disc list-inside mb-6 space-y-2 text-dark-200",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Security"})," - Expired invoices shouldn't remain verifiable"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Data hygiene"})," - Prevents accumulation of stale registrations"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Resource management"})," - Keeps the verification database efficient"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Business alignment"})," - Matches payment windows with verification windows"]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"TTL Limits"}),e.jsx("div",{className:"bg-dark-800 p-4 rounded mb-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400",children:"Minimum TTL"}),e.jsx("p",{className:"font-mono text-lg",children:"30 seconds"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400",children:"Maximum TTL"}),e.jsx("p",{className:"font-mono text-lg",children:"31,536,000 seconds (1 year)"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-dark-400",children:"Default (invalid values)"}),e.jsx("p",{className:"font-mono text-lg",children:"604,800 seconds (7 days)"})]})]})}),e.jsx(b,{type:"info",title:"Invalid TTL Handling",children:"If you provide a TTL outside the valid range (less than 30 seconds or greater than 1 year), Branta will automatically set it to 7 days. This prevents both accidentally short registrations and indefinite ones."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"The Payment Lifecycle"}),e.jsx("p",{className:"mb-4",children:"A registered payment goes through the following lifecycle:"}),e.jsxs("ol",{className:"list-decimal list-inside mb-6 space-y-2 text-dark-200",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Registration"})," - Merchant calls POST /v1/payments with address and TTL"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Active Period"})," - Payment is verifiable via GET /v1/payments/","{address}"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Expiration"})," - TTL elapses from registration time"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Removal"})," - Registration is deleted, verification returns 404"]})]}),e.jsx(c,{title:"Lifecycle Timeline",children:e.jsxs("div",{className:"font-mono text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-dark-400",children:"T+0:"})," POST /v1/payments (ttl: 3600)"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-dark-400",children:"T+0 to T+3600:"})," GET returns 200 (verified)"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-dark-400",children:"T+3600+:"})," GET returns 404 (expired)"]})]})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Choosing the Right TTL"}),e.jsx("p",{className:"mb-4",children:"The optimal TTL depends on your use case:"}),e.jsxs(c,{title:"E-commerce Checkout (15-60 minutes)",children:[e.jsx("p",{className:"mb-2",children:"For typical online checkout flows, use a TTL that matches your cart timeout. This ensures the payment can be verified while the checkout is active but expires when the session ends."}),e.jsx("pre",{className:"font-mono text-sm bg-dark-800 p-4 rounded mt-2",children:`{
  "payment": {
    "payment": "bc1q...",
    "ttl": "3600"  // 1 hour
  }
}`})]}),e.jsxs(c,{title:"Invoice Payments (1-7 days)",children:[e.jsx("p",{className:"mb-2",children:"For invoice-based payments where customers have more time to pay, use a longer TTL that matches your invoice terms."}),e.jsx("pre",{className:"font-mono text-sm bg-dark-800 p-4 rounded mt-2",children:`{
  "payment": {
    "payment": "bc1q...",
    "ttl": "604800"  // 7 days
  }
}`})]}),e.jsxs(c,{title:"Donation Addresses (30 days - 1 year)",children:[e.jsx("p",{className:"mb-2",children:"For persistent donation addresses or long-term payment destinations, use the maximum TTL and re-register periodically."}),e.jsx("pre",{className:"font-mono text-sm bg-dark-800 p-4 rounded mt-2",children:`{
  "payment": {
    "payment": "bc1q...",
    "ttl": "31536000"  // 1 year
  }
}`})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Re-registration"}),e.jsx("p",{className:"mb-4",children:"For payments that need to remain verifiable longer than the TTL allows, or to extend an existing registration, simply re-register the address:"}),e.jsx(b,{type:"success",title:"Extending Registration",children:"You can re-register an address at any time, even before it expires. The new registration replaces the old one with a fresh TTL starting from the new registration time."}),e.jsx(c,{title:"Automated Re-registration",children:e.jsx("pre",{className:"font-mono text-sm bg-dark-800 p-4 rounded overflow-x-auto",children:`// Re-register donation addresses weekly
async function maintainDonationAddress(address: string) {
  const TTL_DAYS = 30;
  const RENEW_DAYS_BEFORE = 7;

  // Check if needs renewal (pseudo-code)
  const registration = await getRegistration(address);
  const expiresIn = registration.expiresAt - Date.now();

  if (expiresIn < RENEW_DAYS_BEFORE * 24 * 60 * 60 * 1000) {
    await registerPayment(address, TTL_DAYS * 24 * 60 * 60);
    console.log('Registration renewed');
  }
}

// Run daily via cron
setInterval(() => maintainDonationAddress(DONATION_ADDRESS), 86400000);`})}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"TTL Best Practices"}),e.jsxs("ul",{className:"list-disc list-inside mb-6 space-y-2 text-dark-200",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Match business logic"})," - TTL should align with payment deadlines"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Add buffer time"})," - Account for timezone differences and processing delays"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Don't over-extend"})," - Expired invoices shouldn't remain verifiable"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Automate renewal"})," - For persistent addresses, set up automated re-registration"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Log expiration"})," - Track when registrations expire for debugging"]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Handling Expiration"}),e.jsx("p",{className:"mb-4",children:"When a customer tries to verify an expired registration:"}),e.jsxs("ul",{className:"list-disc list-inside mb-6 space-y-2 text-dark-200",children:[e.jsx("li",{children:"They receive a 404 response"}),e.jsx("li",{children:'Your application should interpret this as "unverifiable"'}),e.jsx("li",{children:'Consider displaying: "This payment link may have expired. Contact the merchant for a new one."'})]}),e.jsx(b,{type:"warning",title:"Expired vs. Never Registered",children:"The API returns 404 for both expired and never-registered payments. Your application cannot distinguish between these cases from the API response alone. If context matters, track registrations on your side."}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"TTL and Security"}),e.jsx("p",{className:"mb-4",children:"TTL is also a security feature. By ensuring registrations expire:"}),e.jsxs("ul",{className:"list-disc list-inside mb-6 space-y-2 text-dark-200",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Reduces attack window"})," - Compromised addresses can't stay registered forever"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Limits damage"})," - Old, potentially-insecure addresses auto-expire"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Forces fresh registration"})," - Encourages regular security review"]})]}),e.jsx("h3",{className:"text-xl font-semibold text-dark-100 mt-8 mb-4",children:"Interactive: TTL Timeline"}),e.jsx("p",{className:"mb-4",children:"Visualize how TTL affects registration lifecycle with time simulation:"}),e.jsx(R,{})]})}export{F as default};
